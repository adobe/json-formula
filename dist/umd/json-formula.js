!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var r=t();for(var n in r)("object"==typeof exports?exports:e)[n]=r[n]}}(self,(function(){return(()=>{"use strict";var e={d:(t,r)=>{for(var n in r)e.o(r,n)&&!e.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:r[n]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};e.r(t),e.d(t,{jsonFormula:()=>O});function r(e,t,r,n){return{and:{_func:function(e){return!!t(e[0])&&!!t(e[1])},_signature:[{types:[1]},{types:[1]}]},or:{_func:function(e){return!!t(e[0])||!!t(e[1])},_signature:[{types:[1]},{types:[1]}]},not:{_func:function(e){return!t(e[0])},_signature:[{types:[1]}]},true:{_func:function(){return!0},_signature:[]},false:{_func:function(){return!1},_signature:[]},if:{_func:function(r,n){var i=r[0],u=r[1],s=r[2],a=e.visit(i,n);return t(a)?e.visit(u,n):e.visit(s,n)},_signature:[{types:[1]},{types:[1]},{types:[1]}]},substitute:{_func:function(e){var t=r(e[0]),i=r(e[1]),u=r(e[2]);if(e.length<=3)return t.replace(new RegExp(i,"g"),u);for(var s=n(e[3]),a=-1,o=0;o<s;o+=1){a+=1;var c=t.slice(a).indexOf(i);if(-1===c)return t;a+=c}return t.slice(0,a)+t.slice(a).replace(i,u)},_signature:[{types:[2]},{types:[2]},{types:[2]},{types:[0],optional:!0}]},value:{_func:function(e){var t=(e[0]||{})[e[1]];return void 0===t?null:t},_signature:[{types:[4,3,7]},{types:[2,0]}]},lower:{_func:function(e){return r(e[0]).toLowerCase()},_signature:[{types:[2]}]},upper:{_func:function(e){return r(e[0]).toUpperCase()},_signature:[{types:[2]}]},exp:{_func:function(e){var t=n(e[0]);return Math.exp(t)},_signature:[{types:[0]}]},power:{_func:function(e){var t=n(e[0]),r=n(e[1]);return Math.pow(t,r)},_signature:[{types:[0]},{types:[0]}]},find:{_func:function(e){var t=r(e[0]),i=r(e[1]),u=e.length>2?n(e[2]):0,s=i.indexOf(t,u);return-1===s?null:s},_signature:[{types:[2]},{types:[2]},{types:[0],optional:!0}]},left:{_func:function(e){var t=r(e[0]),i=e.length>1?n(e[1]):1;return i<0?null:t.substr(0,i)},_signature:[{types:[2]},{types:[0],optional:!0}]},right:{_func:function(e){var t=r(e[0]),i=e.length>1?n(e[1]):1;if(i<0)return null;var u=t.length-i;return t.substr(u,i)},_signature:[{types:[2]},{types:[0],optional:!0}]},mid:{_func:function(e){var t=r(e[0]),i=n(e[1]);if(i<0)return null;var u=n(e[2]);return t.substr(i,u)},_signature:[{types:[2]},{types:[0]},{types:[0]}]},proper:{_func:function(e){return r(e[0]).split(" ").map((function(e){return e.charAt(0).toUpperCase()+e.slice(1).toLowerCase()})).join(" ")},_signature:[{types:[2]}]},rept:{_func:function(e){var t=r(e[0]),i=n(e[1]);return i<0?null:t.repeat(i)},_signature:[{types:[2]},{types:[0]}]},replace:{_func:function(e){var t=r(e[0]),i=n(e[1]),u=n(e[2]),s=r(e[3]);return i<0?null:t.substr(0,i)+s+t.substr(i+u)},_signature:[{types:[2]},{types:[0]},{types:[0]},{types:[2]}]},round:{_func:function(e){var t=n(e[0]),r=n(e[1]);return Math.round(t*Math.pow(10,r))/Math.pow(10,r)},_signature:[{types:[0]},{types:[0]}]},sqrt:{_func:function(e){var t=Math.sqrt(n(e[0]));return Number.isNaN(t)?null:t},_signature:[{types:[0]}]},stdevp:{_func:function(e){var t=e[0]||[];if(0===t.length)return null;var r=t.map((function(e){return n(e)})),i=r.reduce((function(e,t){return e+t}),0)/t.length,u=r.reduce((function(e,t){return e+t*t}),0)/t.length,s=Math.sqrt(u-i*i);return Number.isNaN(s)?null:s},_signature:[{types:[8]}]},stdev:{_func:function(e){var t=e[0]||[];if(t.length<=1)return null;var r=t.map((function(e){return n(e)})),i=r.reduce((function(e,t){return e+t}),0)/t.length,u=r.reduce((function(e,t){return e+t*t}),0),s=Math.sqrt((u-t.length*i*i)/(t.length-1));return Number.isNaN(s)?null:s},_signature:[{types:[8]}]},trim:{_func:function(e){return r(e[0]).split(" ").filter((function(e){return e})).join(" ")},_signature:[{types:[2]}]},trunc:{_func:function(e){var t=n(e[0]),r=e.length>1?n(e[1]):0;return(t>=0?Math.floor:Math.ceil)(t*Math.pow(10,r))/Math.pow(10,r)},_signature:[{types:[0]},{types:[0],optional:!0}]},charCode:{_func:function(e){var t=n(e[0]);return Number.isInteger(t)?String.fromCharCode(t):null},_signature:[{types:[0]}]},codePoint:{_func:function(e){var t=r(e[0]);return 0===t.length?null:t.codePointAt(0)},_signature:[{types:[2]}]}}}function n(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=e&&("undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"]);if(null!=r){var n,i,u=[],s=!0,a=!1;try{for(r=r.call(e);!(s=(n=r.next()).done)&&(u.push(n.value),!t||u.length!==t);s=!0);}catch(e){a=!0,i=e}finally{try{s||null==r.return||r.return()}finally{if(a)throw i}}return u}}(e,t)||function(e,t){if(e){if("string"==typeof e)return i(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?i(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function i(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function u(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function s(e,t,r,i,s,a,o){var c=0,l=2;function h(t,r){return function(n){var i=e.visit(t,n);if(r.indexOf(s(i))<0){var u="TypeError: expected one of ".concat(r,", received ").concat(s(i));throw new Error(u)}return i}}return{abs:{_func:function(e){return Math.abs(e[0])},_signature:[{types:[c]}]},avg:{_func:function(e){for(var t=0,r=e[0],n=0;n<r.length;n+=1)t+=r[n];return t/r.length},_signature:[{types:[8]}]},ceil:{_func:function(e){return Math.ceil(e[0])},_signature:[{types:[c]}]},contains:{_func:function(e){return a(e[0]).indexOf(a(e[1]))>=0},_signature:[{types:[l,3]},{types:[1]}]},endsWith:{_func:function(e){var t=a(e[0]),r=a(e[1]);return-1!==t.indexOf(r,t.length-r.length)},_signature:[{types:[l]},{types:[l]}]},floor:{_func:function(e){return Math.floor(e[0])},_signature:[{types:[c]}]},length:{_func:function(e){var n=a(e[0]);return t(n)?Object.keys(n).length:r(n)?n.length:o(n).length},_signature:[{types:[l,3,4]}]},map:{_func:function(t){for(var r=[],n=t[0],i=t[1],u=0;u<i.length;u+=1)r.push(e.visit(n,i[u]));return r},_signature:[{types:[6]},{types:[3]}]},max:{_func:function(e){return e[0].length>0?s(e[0][0])===c?e[0].reduce((function(e,t){return i(e)>=i(t)?e:t}),e[0][0]):e[0].reduce((function(e,t){return o(t).localeCompare(o(e))<0?e:t}),e[0][0]):null},_signature:[{types:[3,8,9]}]},merge:{_func:function(e){for(var t={},r=function(r){var n=e[r];Object.keys(n).forEach((function(e){t[e]=n[e]}))},n=0;n<e.length;n+=1)r(n);return t},_signature:[{types:[4],variadic:!0}]},maxBy:{_func:function(e){for(var t,r,n=e[1],i=e[0],u=h(n,[c,l]),s=-1/0,a=0;a<i.length;a+=1)(r=u(i[a]))>s&&(s=r,t=i[a]);return t},_signature:[{types:[3]},{types:[6]}]},sum:{_func:function(e){for(var t=0,r=e[0],n=0;n<r.length;n+=1)t+=1*r[n];return t},_signature:[{types:[8]}]},startsWith:{_func:function(e){return 0===a(e[0]).lastIndexOf(a(e[1]))},_signature:[{types:[l]},{types:[l]}]},min:{_func:function(e){if(e[0].length>0){if(s(e[0][0])===c)return e[0].reduce((function(e,t){return i(e)<=i(t)?e:t}),e[0][0]);for(var t=e[0],r=t[0],n=1;n<t.length;n+=1)o(t[n]).localeCompare(o(r))<0&&(r=t[n]);return r}return null},_signature:[{types:[3,8,9]}]},minBy:{_func:function(e){for(var t,r,n=e[1],i=e[0],u=h(n,[c,l]),s=1/0,a=0;a<i.length;a+=1)(r=u(i[a]))<s&&(s=r,t=i[a]);return t},_signature:[{types:[3]},{types:[6]}]},type:{_func:function(e){var t;return(t={},u(t,c,"number"),u(t,l,"string"),u(t,3,"array"),u(t,4,"object"),u(t,5,"boolean"),u(t,6,"expref"),u(t,7,"null"),t)[s(e[0])]},_signature:[{types:[1]}]},keys:{_func:function(e){return Object.keys(e[0])},_signature:[{types:[1]}]},values:{_func:function(e){return Object.values(e[0])},_signature:[{types:[1]}]},sort:{_func:function(e){var t=e[0].slice(0);if(t.length>0){var r=s(e[0][0])===c?i:o;t.sort((function(e,t){var n=r(e),i=r(t);return n<i?-1:n>i?1:0}))}return t},_signature:[{types:[3,9,8]}]},sortBy:{_func:function(t){var r=t[0].slice(0);if(0===r.length)return r;var i=t[1],u=s(e.visit(i,r[0]));if([c,l].indexOf(u)<0)throw new Error("TypeError");for(var a=[],o=0;o<r.length;o+=1)a.push([o,r[o]]);a.sort((function(t,r){var n=e.visit(i,t[1]),a=e.visit(i,r[1]);if(s(n)!==u)throw new Error("TypeError: expected ".concat(u,", received ").concat(s(n)));if(s(a)!==u)throw new Error("TypeError: expected ".concat(u,", received ").concat(s(a)));return n>a?1:n<a?-1:t[0]-r[0]}));for(var h=0;h<a.length;h+=1){var f=n(a[h],2);r[h]=f[1]}return r},_signature:[{types:[3]},{types:[6]}]},join:{_func:function(e){var t=e[0];return e[1].join(t)},_signature:[{types:[l]},{types:[9]}]},reverse:{_func:function(e){var t=a(e[0]);if(s(t)===l){for(var r="",n=t.length-1;n>=0;n-=1)r+=t[n];return r}var i=e[0].slice(0);return i.reverse(),i},_signature:[{types:[l,3]}]},toArray:{_func:function(e){return 3===s(e[0])?e[0]:[e[0]]},_signature:[{types:[1]}]},toString:{_func:function(e){return s(e[0])===l?e[0]:JSON.stringify(e[0])},_signature:[{types:[1]}]},toNumber:{_func:function(e){var t=s(e[0]);return t===c?e[0]:t===l?i(e[0]):null},_signature:[{types:[1]}]},notNull:{_func:function(e){for(var t=0;t<e.length;t+=1)if(7!==s(e[t]))return e[t];return null},_signature:[{types:[1],variadic:!0}]}}}function a(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function o(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?a(Object(r),!0).forEach((function(t){c(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):a(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function c(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function l(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=e&&("undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"]);if(null!=r){var n,i,u=[],s=!0,a=!1;try{for(r=r.call(e);!(s=(n=r.next()).done)&&(u.push(n.value),!t||u.length!==t);s=!0);}catch(e){a=!0,i=e}finally{try{s||null==r.return||r.return()}finally{if(a)throw i}}return u}}(e,t)||h(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function h(e,t){if(e){if("string"==typeof e)return f(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?f(e,t):void 0}}function f(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function p(e){return p="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},p(e)}var _=0,y=2,d=3,v=5,g=7,m=8,b=9;const w=new function(){var e,t="UnquotedIdentifier",n="QuotedIdentifier",i="Rbracket",u="Rparen",a="Comma",c="Colon",w="Concatenate",x="Rbrace",k="Number",j="Current",O="Global",S="Field",E="Expref",P="Pipe",I="Or",N="And",A="Add",M="Subtract",T="Multiply",L="Power",R="Divide",F="EQ",C="GT",D="LT",H="GTE",U="LTE",q="NE",J="Flatten",z="Star",B="Filter",G="Dot",Q="Lbrace",V="Lbracket",$="Lparen",W="Literal",Z={0:"number",1:"any",2:"string",3:"array",4:"object",5:"boolean",6:"expression",7:"null",8:"Array<number>",9:"Array<string>"},K={},X=null;function Y(e,t){return e>="0"&&e<="9"||t&&"-"===e||"."===e}function ee(e){return e>="a"&&e<="z"||e>="A"&&e<="Z"||e>="0"&&e<="9"||"_"===e}function te(e){return null!==e&&"[object Array]"===Object.prototype.toString.call(e)}function re(e){return null==e?e:te(e)?e.map((function(e){return re(e)})):e.valueOf()}function ne(e){return null==e?"":e.toString()}function ie(e){return null!==e&&"[object Object]"===Object.prototype.toString.call(e)}function ue(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(null===e)return g;var r=t?e.valueOf():e;switch(Object.prototype.toString.call(r)){case"[object String]":return y;case"[object Number]":return _;case"[object Array]":return d;case"[object Boolean]":return v;case"[object Null]":return g;case"[object Object]":return r.jmespathType===E?6:4;default:return 4}}function se(e){return[ue(e),ue(e,!1)]}function ae(e,t){var r=re(e),n=re(t);if(r===n)return!0;if(Object.prototype.toString.call(r)!==Object.prototype.toString.call(n))return!1;if(!0===te(r)){if(r.length!==n.length)return!1;for(var i=0;i<r.length;i+=1)if(!1===ae(r[i],n[i]))return!1;return!0}if(!0===ie(r)){var u={};for(var s in r)if(hasOwnProperty.call(r,s)){if(!1===ae(r[s],n[s]))return!1;u[s]=!0}for(var a in n)if(hasOwnProperty.call(n,a)&&!0!==u[a])return!1;return!0}return!1}function oe(e){if(null===e)return!0;var t=re(e);if(""===t||!1===t||null===t)return!0;if(te(t)&&0===t.length)return!0;if(ie(t)){for(var r in t)if(Object.prototype.hasOwnProperty.call(t,r))return!1;return!0}return!t}function ce(e){var t=re(e);if(null===t)return null;if(t instanceof Array)return 0;if("number"==typeof t)return t;if("string"==typeof t){var r=X(t);return Number.isNaN(r)?0:r}if("boolean"==typeof t)return t?1:0;throw new Error("need to coerce number")}function le(e,t,r){if(te(e)&&te(t)){var n,i=Math.min(e.length,t.length),u=[];for(n=0;n<i;n+=1)if(te(e[n])||te(t[n]))u.push(le(e[n],t[n],r));else if("*"===r)u.push(e[n]*t[n]);else{if("&"!==r)throw new Error("unimplemented");u.push(e[n]+t[n])}for(n=i;n<Math.max(e.length,t.length);n+=1)"&"===r?u.push(""):"*"===r&&u.push(0);return u}if(te(e)||te(t)){var s=l(te(e)?[e,t]:[t,e],2),a=s[0],o=s[1];if("*"===r)return a.map((function(e){return ce(e)*ce(o)}));if("&"===r)return a.map((function(e){return e+o}))}if("*"===r)return ce(e)*ce(t);if("&"===r)return e+t;throw new Error("unimplemented array operator: ".concat(r))}function he(e,t,r,n){var i=e[0];if(-1!==t.findIndex((function(e){return 1===e||i===e})))return r;if(4===i)throw new Error("TypeError: ".concat(n," expected argument to be type ").concat(Z[t[0]]," but received type ").concat(Z[i]," instead."));var u=-1;if(i===d&&t.includes(b)&&t.includes(m)&&(u=r.length>0&&"string"==typeof r[0]?b:m),-1===u&&[b,m,d].includes(i)&&(u=t.find((function(e){return[b,m,d].includes(e)}))),-1===u&&(u=l(t,1)[0]),1===u)return r;if(u===b||u===m||u===d){if(u===d)return i===m||i===b?r:null===r?[]:[r];var s=u===m?_:y;if(i===d){for(var a=r.slice(),o=0;o<a.length;o+=1){var c=se(a[o]);a[o]=he(c,[s],a[o],n)}return a}if([_,y,g,v].includes(s))return[he(e,[s],r,n)]}else{if(u===_)return[y,v,g].includes(i)?ce(r):0;if(u===y)return i===g||4===i?"":r.toString();if(u===v)return!!r;if(4===u&&4===e[1])return r}throw new Error("unhandled argument")}e="function"==typeof String.prototype.trimLeft?function(e){return e.trimLeft()}:function(e){return e.match(/^\s*(.*)/)[1]};var fe={".":G,",":a,":":c,"{":Q,"}":x,"]":i,"(":$,")":u,"@":j},pe={"<":!0,">":!0,"=":!0,"!":!0},_e={" ":!0,"\t":!0,"\n":!0};function ye(e,t){var r=e[t];return"$"===r?e.length>t&&ee(e[t+1]):r>="a"&&r<="z"||r>="A"&&r<="Z"||"_"===r}function de(e,t,r){if(null!==e&&e===G)return!1;if("$"!==t[r])return!1;for(var n=r+1;n<t.length&&ee(t[n]);)n+=1;var i=t.slice(r,n);return!!K[i]}function ve(){}ve.prototype={tokenize:function(e){var r,i,s,o=[];for(this._current=0;this._current<e.length;){var l=o.length?o.slice(-1)[0].type:null;if(de(l,e,this._current))o.push(this._consumeGlobal(e));else if(ye(e,this._current))r=this._current,i=this._consumeUnquotedIdentifier(e),o.push({type:t,value:i,start:r});else if(void 0!==fe[e[this._current]])o.push({type:fe[e[this._current]],value:e[this._current],start:this._current}),this._current+=1;else if("-"===e[this._current]&&l!==k&&l!==u||Y(e[this._current],!1))s=this._consumeNumber(e),o.push(s);else if("["===e[this._current])s=this._consumeLBracket(e),o.push(s);else if('"'===e[this._current])r=this._current,i=this._consumeQuotedIdentifier(e),o.push({type:n,value:i,start:r});else if("'"===e[this._current])r=this._current,i=this._consumeRawStringLiteral(e),o.push({type:W,value:i,start:r});else if("`"===e[this._current]){r=this._current;var h=this._consumeLiteral(e);o.push({type:W,value:h,start:r})}else if(void 0!==pe[e[this._current]])o.push(this._consumeOperator(e));else if(void 0!==_e[e[this._current]])this._current+=1;else if("&"===e[this._current])r=this._current,this._current+=1,"&"===e[this._current]?(this._current+=1,o.push({type:N,value:"&&",start:r})):l===a||l===$?o.push({type:E,value:"&",start:r}):o.push({type:w,value:"&",start:r});else if("+"===e[this._current])r=this._current,this._current+=1,o.push({type:A,value:"+",start:r});else if("-"===e[this._current])r=this._current,this._current+=1,o.push({type:M,value:"-",start:r});else if("*"===e[this._current]){r=this._current,this._current+=1;var f=o.length&&o.slice(-1)[0].type;0===o.length||[V,G,P,N,I,a,c].includes(f)?o.push({type:z,value:"*",start:r}):o.push({type:T,value:"*",start:r})}else if("/"===e[this._current])r=this._current,this._current+=1,o.push({type:R,value:"/",start:r});else if("^"===e[this._current])r=this._current,this._current+=1,o.push({type:L,value:"^",start:r});else{if("|"!==e[this._current]){var p=new Error("Unknown character:".concat(e[this._current]));throw p.name="LexerError",p}r=this._current,this._current+=1,"|"===e[this._current]?(this._current+=1,o.push({type:I,value:"||",start:r})):o.push({type:P,value:"|",start:r})}}return o},_consumeUnquotedIdentifier:function(e){var t=this._current;for(this._current+=1;this._current<e.length&&ee(e[this._current]);)this._current+=1;return e.slice(t,this._current)},_consumeQuotedIdentifier:function(e){var t=this._current;this._current+=1;for(var r=e.length;'"'!==e[this._current]&&this._current<r;){var n=this._current;"\\"!==e[n]||"\\"!==e[n+1]&&'"'!==e[n+1]?n+=1:n+=2,this._current=n}return this._current+=1,JSON.parse(e.slice(t,this._current))},_consumeRawStringLiteral:function(e){var t=this._current;this._current+=1;for(var r=e.length;"'"!==e[this._current]&&this._current<r;){var n=this._current;"\\"!==e[n]||"\\"!==e[n+1]&&"'"!==e[n+1]?n+=1:n+=2,this._current=n}return this._current+=1,e.slice(t+1,this._current-1).replace("\\'","'")},_consumeNumber:function(e){var t=this._current;this._current+=1;for(var r=e.length;Y(e[this._current],!1)&&this._current<r;)this._current+=1;var n,i=e.slice(t,this._current);return n=i.includes(".")?parseFloat(i):parseInt(i,10),{type:k,value:n,start:t}},_consumeLBracket:function(e){var t=this._current;return this._current+=1,"?"===e[this._current]?(this._current+=1,{type:B,value:"[?",start:t}):"]"===e[this._current]?(this._current+=1,{type:J,value:"[]",start:t}):{type:V,value:"[",start:t}},_consumeGlobal:function(e){var t=this._current;for(this._current+=1;this._current<e.length&&ee(e[this._current]);)this._current+=1;var r=e.slice(t,this._current);return{type:O,value:K[r],start:t}},_consumeOperator:function(e){var t=this._current,r=e[t];return this._current+=1,"!"===r?"="===e[this._current]?(this._current+=1,{type:q,value:"!=",start:t}):{type:"Not",value:"!",start:t}:"<"===r?"="===e[this._current]?(this._current+=1,{type:U,value:"<=",start:t}):{type:D,value:"<",start:t}:">"===r?"="===e[this._current]?(this._current+=1,{type:H,value:">=",start:t}):{type:C,value:">",start:t}:"="===e[this._current]?(this._current+=1,{type:F,value:"==",start:t}):{type:F,value:"=",start:t}},_consumeLiteral:function(t){this._current+=1;for(var r,n=this._current,i=t.length;"`"!==t[this._current]&&this._current<i;){var u=this._current;"\\"!==t[u]||"\\"!==t[u+1]&&"`"!==t[u+1]?u+=1:u+=2,this._current=u}var s=e(t.slice(n,this._current));return s=s.replace("\\`","`"),r=this._looksLikeJSON(s)?JSON.parse(s):JSON.parse('"'.concat(s,'"')),this._current+=1,r},_looksLikeJSON:function(e){if(""===e)return!1;if('[{"'.indexOf(e[0])>=0)return!0;if(["true","false","null"].indexOf(e)>=0)return!0;if(!("-0123456789".indexOf(e[0])>=0))return!1;try{return JSON.parse(e),!0}catch(e){return!1}}};var ge={};function me(){}function be(e){this.runtime=e}function we(){}ge.EOF=0,ge.UnquotedIdentifier=0,ge.QuotedIdentifier=0,ge.Rbracket=0,ge.Rparen=0,ge[a]=0,ge.Rbrace=0,ge.Number=0,ge.Current=0,ge.Global=0,ge.Field=0,ge.Expref=0,ge[P]=1,ge[I]=2,ge[N]=3,ge[A]=6,ge[M]=6,ge[w]=7,ge[T]=7,ge[R]=7,ge[L]=7,ge[F]=5,ge[C]=5,ge[D]=5,ge[H]=5,ge[U]=5,ge[q]=5,ge.Flatten=9,ge.Star=20,ge.Filter=21,ge[G]=40,ge.Not=45,ge.Lbrace=50,ge[V]=55,ge.Lparen=60,me.prototype={parse:function(e){this._loadTokens(e),this.index=0;var t=this.expression(0);if("EOF"!==this._lookahead(0)){var r=this._lookaheadToken(0),n=new Error("Unexpected token type: ".concat(r.type,", value: ").concat(r.value));throw n.name="ParserError",n}return t},_loadTokens:function(e){var t=(new ve).tokenize(e);t.push({type:"EOF",value:"",start:e.length}),this.tokens=t},expression:function(e){var t=this._lookaheadToken(0);this._advance();for(var r=this.nud(t),n=this._lookahead(0);e<ge[n];)this._advance(),r=this.led(n,r),n=this._lookahead(0);return r},_lookahead:function(e){return this.tokens[this.index+e].type},_lookaheadToken:function(e){return this.tokens[this.index+e]},_advance:function(){this.index+=1},nud:function(e){var r,s,o,l,h;switch(e.type){case W:return{type:"Literal",value:e.value};case k:return{type:"Number",value:e.value};case t:return{type:"Field",name:e.value};case n:if(o={type:"Field",name:e.value},this._lookahead(0)===$)throw new Error("Quoted identifier not allowed for function names.");return o;case"Not":return{type:"NotExpression",children:[r=this.expression(ge.Not)]};case z:return{type:"ValueProjection",children:[{type:"Identity"},r=this._lookahead(0)===i?{type:"Identity"}:this._parseProjectionRHS(ge.Star)]};case B:return this.led(e.type,{type:"Identity"});case Q:return this._parseMultiselectHash();case J:return{type:"Projection",children:[{type:J,children:[{type:"Identity"}]},r=this._parseProjectionRHS(ge.Flatten)]};case V:return this._lookahead(1)===a||(h=this._lookahead(1),[w,I,N,A,M,T,L,R,F,C,D,H,U,q].includes(h))?this._parseMultiselectList():this._lookahead(0)===k||this._lookahead(0)===c?(r=this._parseIndexExpression(),this._projectIfSlice({type:"Identity"},r)):this._lookahead(0)===z&&this._lookahead(1)===i?(this._advance(),this._advance(),{type:"Projection",children:[{type:"Identity"},r=this._parseProjectionRHS(ge.Star)]}):this._parseMultiselectList();case j:return{type:j};case O:return{type:O,value:e.value};case S:return{type:S};case E:return{type:"ExpressionReference",children:[s=this.expression(ge.Expref)]};case $:for(l=[];this._lookahead(0)!==u;)this._lookahead(0)===j?(s={type:j},this._advance()):s=this.expression(0),l.push(s);return this._match(u),l[0];default:this._errorToken(e)}},led:function(e,t){var r,n,s,o,l,h,f;switch(e){case w:return{type:"ConcatenateExpression",children:[t,n=this.expression(ge.Concatenate)]};case G:return h=ge.Dot,this._lookahead(0)!==z?{type:"Subexpression",children:[t,n=this._parseDotRHS(h)]}:(this._advance(),{type:"ValueProjection",children:[t,n=this._parseProjectionRHS(h)]});case P:return n=this.expression(ge.Pipe),{type:P,children:[t,n]};case I:return{type:"OrExpression",children:[t,n=this.expression(ge.Or)]};case N:return{type:"AndExpression",children:[t,n=this.expression(ge.And)]};case A:return{type:"AddExpression",children:[t,n=this.expression(ge.Add)]};case M:return{type:"SubtractExpression",children:[t,n=this.expression(ge.Subtract)]};case T:return{type:"MultiplyExpression",children:[t,n=this.expression(ge.Multiply)]};case R:return{type:"DivideExpression",children:[t,n=this.expression(ge.Divide)]};case L:return{type:"PowerExpression",children:[t,n=this.expression(ge.Power)]};case $:for(s=t.name,o=[];this._lookahead(0)!==u;)this._lookahead(0)===j?(l={type:j},this._advance()):l=this.expression(0),this._lookahead(0)===a&&this._match(a),o.push(l);return this._match(u),{type:"Function",name:s,children:o};case B:return r=this.expression(0),this._match(i),{type:"FilterProjection",children:[t,n=this._lookahead(0)===J?{type:"Identity"}:this._parseProjectionRHS(ge.Filter),r]};case J:return{type:"Projection",children:[{type:J,children:[t]},this._parseProjectionRHS(ge.Flatten)]};case F:case q:case C:case H:case D:case U:return this._parseComparator(t,e);case V:return(f=this._lookaheadToken(0)).type===k||f.type===c?(n=this._parseIndexExpression(),this._projectIfSlice(t,n)):(this._match(z),this._match(i),{type:"Projection",children:[t,n=this._parseProjectionRHS(ge.Star)]});default:this._errorToken(this._lookaheadToken(0))}},_match:function(e){if(this._lookahead(0)!==e){var t=this._lookaheadToken(0),r=new Error("Expected ".concat(e,", got: ").concat(t.type));throw r.name="ParserError",r}this._advance()},_errorToken:function(e){var t=new Error("Invalid token (".concat(e.type,'): "').concat(e.value,'"'));throw t.name="ParserError",t},_parseIndexExpression:function(){if(this._lookahead(0)===c||this._lookahead(1)===c)return this._parseSliceExpression();var e={type:"Index",value:this._lookaheadToken(0).value};return this._advance(),this._match(i),e},_projectIfSlice:function(e,t){var r={type:"IndexExpression",children:[e,t]};return"Slice"===t.type?{type:"Projection",children:[r,this._parseProjectionRHS(ge.Star)]}:r},_parseSliceExpression:function(){for(var e=[null,null,null],t=0,r=this._lookahead(0);r!==i&&t<3;){if(r===c)t+=1,this._advance();else{if(r!==k){var n=this._lookahead(0),u=new Error("Syntax error, unexpected token: ".concat(n.value,"(").concat(n.type,")"));throw u.name="Parsererror",u}e[t]=this._lookaheadToken(0).value,this._advance()}r=this._lookahead(0)}return this._match(i),{type:"Slice",children:e}},_parseComparator:function(e,t){return{type:"Comparator",name:t,children:[e,this.expression(ge[t])]}},_parseDotRHS:function(e){var r=this._lookahead(0);return[t,n,z].indexOf(r)>=0?this.expression(e):r===V?(this._match(V),this._parseMultiselectList()):r===Q?(this._match(Q),this._parseMultiselectHash()):void 0},_parseProjectionRHS:function(e){var t;if(ge[this._lookahead(0)]<10)t={type:"Identity"};else if(this._lookahead(0)===V)t=this.expression(e);else if(this._lookahead(0)===B)t=this.expression(e);else{if(this._lookahead(0)!==G){var r=this._lookaheadToken(0),n=new Error("Sytanx error, unexpected token: ".concat(r.value,"(").concat(r.type,")"));throw n.name="ParserError",n}this._match(G),t=this._parseDotRHS(e)}return t},_parseMultiselectList:function(){for(var e=[];this._lookahead(0)!==i;){var t=this.expression(0);if(e.push(t),this._lookahead(0)===a&&(this._match(a),this._lookahead(0)===i))throw new Error("Unexpected token Rbracket")}return this._match(i),{type:"MultiSelectList",children:e}},_parseMultiselectHash:function(){for(var e,r,i,u=[],s=[t,n];;){if(e=this._lookaheadToken(0),s.indexOf(e.type)<0)throw new Error("Expecting an identifier token, got: ".concat(e.type));if(r=e.value,this._advance(),this._match(c),i={type:"KeyValuePair",name:r,value:this.expression(0)},u.push(i),this._lookahead(0)===a)this._match(a);else if(this._lookahead(0)===x){this._match(x);break}}return{type:"MultiSelectHash",children:u}}},be.prototype={search:function(e,t){return this.visit(e,t)},visit:function(e,t){var r,n,i,u,s,a,o,c,p,_,d,v,g,m,w,x,k,S,I,N,A,M,T,L;switch(e.type){case"Field":return null!==t&&ie(t)?void 0===(a=t[e.name])?null:a:null;case"Subexpression":for(i=this.visit(e.children[0],t),p=1;p<e.children.length;p+=1)if(null===(i=this.visit(e.children[1],i)))return null;return i;case"IndexExpression":case P:return o=this.visit(e.children[0],t),this.visit(e.children[1],o);case"Index":return te(t)?((v=e.value)<0&&(v=t.length+v),void 0===(i=t[v])&&(i=null),i):null;case"Slice":if(!te(t))return null;g=e.children.slice(0);var R=l(this.computeSliceParams(t.length,g),3);if(m=R[0],w=R[1],i=[],(x=R[2])>0)for(p=m;p<w;p+=x)i.push(t[p]);else for(p=m;p>w;p+=x)i.push(t[p]);return i;case"Projection":if(!te(d=this.visit(e.children[0],t)))return null;for(c=[],p=0;p<d.length;p+=1)null!==(n=this.visit(e.children[1],d[p]))&&c.push(n);return c;case"ValueProjection":if(!ie(re(d=this.visit(e.children[0],t))))return null;for(c=[],k=function(e){for(var t=Object.keys(e),r=[],n=0;n<t.length;n+=1)r.push(e[t[n]]);return r}(d),p=0;p<k.length;p+=1)null!==(n=this.visit(e.children[1],k[p]))&&c.push(n);return c;case"FilterProjection":if(!te(d=this.visit(e.children[0],t)))return null;for(S=[],I=[],p=0;p<d.length;p+=1)oe(r=this.visit(e.children[2],d[p]))||S.push(d[p]);for(var z=0;z<S.length;z+=1)null!==(n=this.visit(e.children[1],S[z]))&&I.push(n);return I;case"Comparator":switch(u=this.visit(e.children[0],t),s=this.visit(e.children[1],t),e.name){case F:i=ae(u,s);break;case q:i=!ae(u,s);break;case C:i=u>s;break;case H:i=u>=s;break;case D:i=u<s;break;case U:i=u<=s;break;default:throw new Error("Unknown comparator: ".concat(e.name))}return i;case J:if(!te(N=this.visit(e.children[0],t)))return null;for(A=[],p=0;p<N.length;p+=1){var B;te(n=N[p])?(B=A).push.apply(B,function(e){if(Array.isArray(e))return f(e)}(L=n)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(L)||h(L)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()):A.push(n)}return A;case"Identity":case j:return t;case"MultiSelectList":if(null===t)return null;for(c=[],p=0;p<e.children.length;p+=1)c.push(this.visit(e.children[p],t));return c;case"MultiSelectHash":if(null===t)return null;for(c={},p=0;p<e.children.length;p+=1)c[(_=e.children[p]).name]=this.visit(_.value,t);return c;case"OrExpression":return oe(r=this.visit(e.children[0],t))&&(r=this.visit(e.children[1],t)),r;case"AndExpression":return!0===oe(u=this.visit(e.children[0],t))?u:this.visit(e.children[1],t);case"AddExpression":return ce(u=this.visit(e.children[0],t))+ce(this.visit(e.children[1],t));case"ConcatenateExpression":return u=this.visit(e.children[0],t),s=this.visit(e.children[1],t),le(u=he(se(u),[y,b],u,"concatenate"),s=he(se(s),[y,b],s,"concatenate"),"&");case"SubtractExpression":return(u=this.visit(e.children[0],t))-this.visit(e.children[1],t);case"MultiplyExpression":return le(u=this.visit(e.children[0],t),s=this.visit(e.children[1],t),"*");case"DivideExpression":return(u=this.visit(e.children[0],t))/this.visit(e.children[1],t);case"PowerExpression":return u=this.visit(e.children[0],t),Math.pow(u,this.visit(e.children[1],t));case"NotExpression":return oe(u=this.visit(e.children[0],t));case"Literal":case"Number":case O:return e.value;case"Function":if("if"===e.name)return this.runtime.callFunction(e.name,e.children,t);for(M=[],p=0;p<e.children.length;p+=1)M.push(this.visit(e.children[p],t));return this.runtime.callFunction(e.name,M);case"ExpressionReference":return(T=l(e.children,1)[0]).jmespathType=E,T;default:throw new Error("Unknown node type: ".concat(e.type))}},computeSliceParams:function(e,t){var r=t[0],n=t[1],i=t[2],u=[null,null,null];if(null===i)i=1;else if(0===i){var s=new Error("Invalid slice, step cannot be 0");throw s.name="RuntimeError",s}var a=i<0;return r=null===r?a?e-1:0:this.capSliceRange(e,r,i),n=null===n?a?-1:e:this.capSliceRange(e,n,i),u[0]=r,u[1]=n,u[2]=i,u},capSliceRange:function(e,t,r){return t<0?(t+=e)<0&&(t=r<0?-1:0):t>=e&&(t=r<0?e-1:e),t}},we.prototype={addFunctions:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.functionTable=o(o(o({},s(this._interpreter,ie,te,ce,ue,re,ne)),r(this._interpreter,re,ne,ce)),e)},callFunction:function(e,t,r){var n=this.functionTable[e];if(void 0===n)throw new Error("Unknown function: ".concat(e,"()"));return this._validateArgs(e,t,n._signature),n._func.call(this,t,r)},_validateArgs:function(e,t,r){if(0!==r.length){var n,i,u;if(r[r.length-1].variadic){if(t.length<r.length)throw n=1===r.length?" argument":" arguments",new Error("ArgumentError: ".concat(e,"() ")+"takes at least".concat(r.length).concat(n," but received ").concat(t.length))}else if(t.length!==r.length&&!r[r.length-1].optional)throw n=1===r.length?" argument":" arguments",new Error("ArgumentError: ".concat(e,"() ")+"takes ".concat(r.length).concat(n," but received ").concat(t.length));for(var s=Math.min(r.length,t.length),a=0;a<s;a+=1)i=r[a].types,o=t[a],c=i,l=void 0,null!==(l=o)&&!Array.isArray(l)&&"object"===p(l)&&"Object"!==l.constructor.name&&c.includes(10)||(u=se(t[a]),t[a]=he(u,i,t[a],e))}var o,c,l}},this.tokenize=function(e){return(new ve).tokenize(e)},this.compile=function(e){return(new me).parse(e)},this.search=function(e,t,r,n,i){var u=new me,s=new we(n),a=new be(s);s._interpreter=a,s.addFunctions(n),t&&(K=t),X=i||function(e){var t=+e;return Number.isNaN(t)?0:t};var o=u.parse(r);return a.search(o,e)},this.strictDeepEqual=ae};function x(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function k(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?x(Object(r),!0).forEach((function(t){j(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):x(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function j(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function O(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},i=arguments.length>4?arguments[4]:void 0,u=w.search(e,t,r,k({},n),i);return u}return t})()}));
//# sourceMappingURL=json-formula.js.map