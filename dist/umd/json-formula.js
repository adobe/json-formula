!function(t,e){if("object"==typeof exports&&"object"==typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var r=e();for(var n in r)("object"==typeof exports?exports:t)[n]=r[n]}}(self,(function(){return(()=>{"use strict";var t={d:(e,r)=>{for(var n in r)t.o(r,n)&&!t.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:r[n]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},e={};function r(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function n(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?r(Object(n),!0).forEach((function(e){i(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function i(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function s(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var r=t&&("undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"]);if(null!=r){var n,i,s=[],u=!0,o=!1;try{for(r=r.call(t);!(u=(n=r.next()).done)&&(s.push(n.value),!e||s.length!==e);u=!0);}catch(t){o=!0,i=t}finally{try{u||null==r.return||r.return()}finally{if(o)throw i}}return s}}(t,e)||u(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function u(t,e){if(t){if("string"==typeof t)return o(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?o(t,e):void 0}}function o(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}t.r(e),t.d(e,{dataTypes:()=>g,jsonFormula:()=>v});var a=0,c=2,h=3,l=5,f=7,p=8,_=9;function d(){var t,e="UnquotedIdentifier",r="QuotedIdentifier",i="Rbracket",d="Rparen",y="Comma",v="Colon",g="Concatenate",m="Rbrace",b="Number",k="Current",x="Global",E="Field",w="Expref",S="Pipe",j="Or",O="And",P="Add",T="Subtract",A="Multiply",I="Power",N="Divide",R="EQ",M="GT",L="LT",F="GTE",C="LTE",H="NE",D="Flatten",U="Star",Y="Filter",B="Dot",J="Lbrace",G="Lbracket",z="Lparen",K="Literal",Q={0:"number",1:"any",2:"string",3:"array",4:"object",5:"boolean",6:"expression",7:"null",8:"Array<number>",9:"Array<string>"},V={};function q(t,e){return t>="0"&&t<="9"||e&&"-"===t||"."===t}function W(t){return t>="a"&&t<="z"||t>="A"&&t<="Z"||t>="0"&&t<="9"||"_"===t}function $(t){return null!==t&&"[object Array]"===Object.prototype.toString.call(t)}function Z(t){return null==t?t:$(t)?t.map((function(t){return Z(t)})):t.valueOf()}function X(t){return null==t?"":t.toString()}function tt(t){return null!==t&&"[object Object]"===Object.prototype.toString.call(t)}function et(t){if(null===t)return f;var e=t.valueOf();switch(Object.prototype.toString.call(e)){case"[object String]":return c;case"[object Number]":return a;case"[object Array]":return h;case"[object Boolean]":return l;case"[object Null]":return f;case"[object Object]":return e.jmespathType===w?6:4;default:return 4}}function rt(t,e){var r=Z(t),n=Z(e);if(r===n)return!0;if(Object.prototype.toString.call(r)!==Object.prototype.toString.call(n))return!1;if(!0===$(r)){if(r.length!==n.length)return!1;for(var i=0;i<r.length;i+=1)if(!1===rt(r[i],n[i]))return!1;return!0}if(!0===tt(r)){var s={};for(var u in r)if(hasOwnProperty.call(r,u)){if(!1===rt(r[u],n[u]))return!1;s[u]=!0}for(var o in n)if(hasOwnProperty.call(n,o)&&!0!==s[o])return!1;return!0}return!1}function nt(t){if(null===t)return!0;var e=Z(t);if(""===e||!1===e||null===e)return!0;if($(e)&&0===e.length)return!0;if(tt(e)){for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r))return!1;return!0}return!e}function it(t){var e=Z(t);if(null===e)return 0;if(e instanceof Array)return 0;if("number"==typeof e)return e;if("string"==typeof e){var r=parseFloat(e);return Number.isNaN(r)?0:r}if("boolean"==typeof e)return e?1:0;throw new Error("need to coerce number")}function st(t,e,r){if($(t)&&$(e)){var n,i=Math.min(t.length,e.length),u=[];for(n=0;n<i;n+=1)if($(t[n])||$(e[n]))u.push(st(t[n],e[n],r));else if("*"===r)u.push(t[n]*e[n]);else{if("&"!==r)throw new Error("unimplemented");u.push(t[n]+e[n])}for(n=i;n<Math.max(t.length,e.length);n+=1)"&"===r?u.push(""):"*"===r&&u.push(0);return u}if($(t)||$(e)){var o=s($(t)?[t,e]:[e,t],2),a=o[0],c=o[1];if("*"===r)return a.map((function(t){return it(t)*it(c)}));if("&"===r)return a.map((function(t){return t+c}))}if("*"===r)return it(t)*it(e);if("&"===r)return t+e;throw new Error("unimplemented array operator: ".concat(r))}function ut(t,e,r,n){if(-1!==e.findIndex((function(e){return 1===e||t===e})))return r;if(4===t)throw new Error("TypeError: ".concat(n," expected argument to be type ").concat(Q[e[0]]," but received type ").concat(Q[t]," instead."));var i=-1;if(t===h&&e.includes(_)&&e.includes(p)&&(i=r.length>0&&"string"==typeof r[0]?_:p),-1===i&&[_,p,h].includes(t)&&(i=e.find((function(t){return[_,p,h].includes(t)}))),-1===i&&(i=s(e,1)[0]),i===_||i===p||i===h){if(i===h)return t===p||t===_?r:null===r?[]:[r];var u=i===p?a:c;if(t===h){for(var o=r.slice(),d=0;d<o.length;d+=1){var y=et(o[d]);o[d]=ut(y,[u],o[d],n)}return o}if([a,c,f,l].includes(u))return[ut(t,[u],r,n)]}else{if(i===a)return t===c?it(r):t===l&&r?1:0;if(i===c)return t===f||4===t?"":r.toString();if(i===l)return!!r}throw new Error("unhandled argument")}t="function"==typeof String.prototype.trimLeft?function(t){return t.trimLeft()}:function(t){return t.match(/^\s*(.*)/)[1]};var ot={".":B,",":y,":":v,"{":J,"}":m,"]":i,"(":z,")":d,"@":k},at={"<":!0,">":!0,"=":!0,"!":!0},ct={" ":!0,"\t":!0,"\n":!0};function ht(t,e){var r=t[e];return"$"===r?t.length>e&&W(t[e+1]):r>="a"&&r<="z"||r>="A"&&r<="Z"||"_"===r}function lt(t,e,r){if(null!==t&&t===B)return!1;if("$"!==e[r])return!1;for(var n=r+1;n<e.length&&W(e[n]);)n+=1;var i=e.slice(r,n);return!!V[i]}function ft(){}ft.prototype={tokenize:function(t){var n,i,s,u=[];for(this._current=0;this._current<t.length;){var o=u.length?u.slice(-1)[0].type:null;if(lt(o,t,this._current))u.push(this._consumeGlobal(t));else if(ht(t,this._current))n=this._current,i=this._consumeUnquotedIdentifier(t),u.push({type:e,value:i,start:n});else if(void 0!==ot[t[this._current]])u.push({type:ot[t[this._current]],value:t[this._current],start:this._current}),this._current+=1;else if("-"===t[this._current]&&o!==b&&o!==d||q(t[this._current],!1))s=this._consumeNumber(t),u.push(s);else if("["===t[this._current])s=this._consumeLBracket(t),u.push(s);else if('"'===t[this._current])n=this._current,i=this._consumeQuotedIdentifier(t),u.push({type:r,value:i,start:n});else if("'"===t[this._current])n=this._current,i=this._consumeRawStringLiteral(t),u.push({type:K,value:i,start:n});else if("`"===t[this._current]){n=this._current;var a=this._consumeLiteral(t);u.push({type:K,value:a,start:n})}else if(void 0!==at[t[this._current]])u.push(this._consumeOperator(t));else if(void 0!==ct[t[this._current]])this._current+=1;else if("&"===t[this._current])n=this._current,this._current+=1,"&"===t[this._current]?(this._current+=1,u.push({type:O,value:"&&",start:n})):o===y||o===z?u.push({type:w,value:"&",start:n}):u.push({type:g,value:"&",start:n});else if("+"===t[this._current])n=this._current,this._current+=1,u.push({type:P,value:"+",start:n});else if("-"===t[this._current])n=this._current,this._current+=1,u.push({type:T,value:"-",start:n});else if("*"===t[this._current]){n=this._current,this._current+=1;var c=u.length&&u.slice(-1)[0].type;0===u.length||[G,B,S,O,j,y,v].includes(c)?u.push({type:U,value:"*",start:n}):u.push({type:A,value:"*",start:n})}else if("/"===t[this._current])n=this._current,this._current+=1,u.push({type:N,value:"/",start:n});else if("^"===t[this._current])n=this._current,this._current+=1,u.push({type:I,value:"^",start:n});else{if("|"!==t[this._current]){var h=new Error("Unknown character:".concat(t[this._current]));throw h.name="LexerError",h}n=this._current,this._current+=1,"|"===t[this._current]?(this._current+=1,u.push({type:j,value:"||",start:n})):u.push({type:S,value:"|",start:n})}}return u},_consumeUnquotedIdentifier:function(t){var e=this._current;for(this._current+=1;this._current<t.length&&W(t[this._current]);)this._current+=1;return t.slice(e,this._current)},_consumeQuotedIdentifier:function(t){var e=this._current;this._current+=1;for(var r=t.length;'"'!==t[this._current]&&this._current<r;){var n=this._current;"\\"!==t[n]||"\\"!==t[n+1]&&'"'!==t[n+1]?n+=1:n+=2,this._current=n}return this._current+=1,JSON.parse(t.slice(e,this._current))},_consumeRawStringLiteral:function(t){var e=this._current;this._current+=1;for(var r=t.length;"'"!==t[this._current]&&this._current<r;){var n=this._current;"\\"!==t[n]||"\\"!==t[n+1]&&"'"!==t[n+1]?n+=1:n+=2,this._current=n}return this._current+=1,t.slice(e+1,this._current-1).replace("\\'","'")},_consumeNumber:function(t){var e=this._current;this._current+=1;for(var r=t.length;q(t[this._current],!1)&&this._current<r;)this._current+=1;var n,i=t.slice(e,this._current);return n=i.includes(".")?parseFloat(i):parseInt(i,10),{type:b,value:n,start:e}},_consumeLBracket:function(t){var e=this._current;return this._current+=1,"?"===t[this._current]?(this._current+=1,{type:Y,value:"[?",start:e}):"]"===t[this._current]?(this._current+=1,{type:D,value:"[]",start:e}):{type:G,value:"[",start:e}},_consumeGlobal:function(t){var e=this._current;for(this._current+=1;this._current<t.length&&W(t[this._current]);)this._current+=1;var r=t.slice(e,this._current);return{type:x,value:V[r],start:e}},_consumeOperator:function(t){var e=this._current,r=t[e];return this._current+=1,"!"===r?"="===t[this._current]?(this._current+=1,{type:H,value:"!=",start:e}):{type:"Not",value:"!",start:e}:"<"===r?"="===t[this._current]?(this._current+=1,{type:C,value:"<=",start:e}):{type:L,value:"<",start:e}:">"===r?"="===t[this._current]?(this._current+=1,{type:F,value:">=",start:e}):{type:M,value:">",start:e}:"="===t[this._current]?(this._current+=1,{type:R,value:"==",start:e}):{type:R,value:"=",start:e}},_consumeLiteral:function(e){this._current+=1;for(var r,n=this._current,i=e.length;"`"!==e[this._current]&&this._current<i;){var s=this._current;"\\"!==e[s]||"\\"!==e[s+1]&&"`"!==e[s+1]?s+=1:s+=2,this._current=s}var u=t(e.slice(n,this._current));return u=u.replace("\\`","`"),r=this._looksLikeJSON(u)?JSON.parse(u):JSON.parse('"'.concat(u,'"')),this._current+=1,r},_looksLikeJSON:function(t){if(""===t)return!1;if('[{"'.indexOf(t[0])>=0)return!0;if(["true","false","null"].indexOf(t)>=0)return!0;if(!("-0123456789".indexOf(t[0])>=0))return!1;try{return JSON.parse(t),!0}catch(t){return!1}}};var pt={};function _t(){}function dt(t){this.runtime=t}function yt(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.functionTable=n({abs:{_func:this._functionAbs,_signature:[{types:[a]}]},avg:{_func:this._functionAvg,_signature:[{types:[p]}]},ceil:{_func:this._functionCeil,_signature:[{types:[a]}]},contains:{_func:this._functionContains,_signature:[{types:[c,h]},{types:[1]}]},ends_with:{_func:this._functionEndsWith,_signature:[{types:[c]},{types:[c]}]},floor:{_func:this._functionFloor,_signature:[{types:[a]}]},length:{_func:this._functionLength,_signature:[{types:[c,h,4]}]},map:{_func:this._functionMap,_signature:[{types:[6]},{types:[h]}]},max:{_func:this._functionMax,_signature:[{types:[h,p,_]}]},merge:{_func:this._functionMerge,_signature:[{types:[4],variadic:!0}]},max_by:{_func:this._functionMaxBy,_signature:[{types:[h]},{types:[6]}]},sum:{_func:this._functionSum,_signature:[{types:[p]}]},starts_with:{_func:this._functionStartsWith,_signature:[{types:[c]},{types:[c]}]},min:{_func:this._functionMin,_signature:[{types:[h,p,_]}]},min_by:{_func:this._functionMinBy,_signature:[{types:[h]},{types:[6]}]},type:{_func:this._functionType,_signature:[{types:[1]}]},keys:{_func:this._functionKeys,_signature:[{types:[4]}]},values:{_func:this._functionValues,_signature:[{types:[4]}]},sort:{_func:this._functionSort,_signature:[{types:[h,_,p]}]},sort_by:{_func:this._functionSortBy,_signature:[{types:[h]},{types:[6]}]},join:{_func:this._functionJoin,_signature:[{types:[c]},{types:[_]}]},reverse:{_func:this._functionReverse,_signature:[{types:[c,h]}]},to_array:{_func:this._functionToArray,_signature:[{types:[1]}]},to_string:{_func:this._functionToString,_signature:[{types:[1]}]},to_number:{_func:this._functionToNumber,_signature:[{types:[1]}]},not_null:{_func:this._functionNotNull,_signature:[{types:[1],variadic:!0}]},and:{_func:this._functionAnd,_signature:[{types:[1]},{types:[1]}]},or:{_func:this._functionOr,_signature:[{types:[1]},{types:[1]}]},not:{_func:this._functionNot,_signature:[{types:[1]}]},true:{_func:function(){return!0},_signature:[]},false:{_func:function(){return!1},_signature:[]},if:{_func:this._functionIf,_signature:[{types:[1]},{types:[1]},{types:[1]}]}},t)}pt.EOF=0,pt.UnquotedIdentifier=0,pt.QuotedIdentifier=0,pt.Rbracket=0,pt.Rparen=0,pt[y]=0,pt.Rbrace=0,pt.Number=0,pt.Current=0,pt.Global=0,pt.Field=0,pt.Expref=0,pt[S]=1,pt[j]=2,pt[O]=3,pt[P]=6,pt[T]=6,pt[g]=7,pt[A]=7,pt[N]=7,pt[I]=7,pt[R]=5,pt[M]=5,pt[L]=5,pt[F]=5,pt[C]=5,pt[H]=5,pt.Flatten=9,pt.Star=20,pt.Filter=21,pt[B]=40,pt.Not=45,pt.Lbrace=50,pt[G]=55,pt.Lparen=60,_t.prototype={parse:function(t){this._loadTokens(t),this.index=0;var e=this.expression(0);if("EOF"!==this._lookahead(0)){var r=this._lookaheadToken(0),n=new Error("Unexpected token type: ".concat(r.type,", value: ").concat(r.value));throw n.name="ParserError",n}return e},_loadTokens:function(t){var e=(new ft).tokenize(t);e.push({type:"EOF",value:"",start:t.length}),this.tokens=e},expression:function(t){var e=this._lookaheadToken(0);this._advance();for(var r=this.nud(e),n=this._lookahead(0);t<pt[n];)this._advance(),r=this.led(n,r),n=this._lookahead(0);return r},_lookahead:function(t){return this.tokens[this.index+t].type},_lookaheadToken:function(t){return this.tokens[this.index+t]},_advance:function(){this.index+=1},nud:function(t){var n,s,u,o,a;switch(t.type){case K:return{type:"Literal",value:t.value};case b:return{type:"Number",value:t.value};case e:return{type:"Field",name:t.value};case r:if(u={type:"Field",name:t.value},this._lookahead(0)===z)throw new Error("Quoted identifier not allowed for function names.");return u;case"Not":return{type:"NotExpression",children:[n=this.expression(pt.Not)]};case U:return{type:"ValueProjection",children:[{type:"Identity"},n=this._lookahead(0)===i?{type:"Identity"}:this._parseProjectionRHS(pt.Star)]};case Y:return this.led(t.type,{type:"Identity"});case J:return this._parseMultiselectHash();case D:return{type:"Projection",children:[{type:D,children:[{type:"Identity"}]},n=this._parseProjectionRHS(pt.Flatten)]};case G:return this._lookahead(1)===y||(a=this._lookahead(1),[g,j,O,P,T,A,I,N,R,M,L,F,C,H].includes(a))?this._parseMultiselectList():this._lookahead(0)===b||this._lookahead(0)===v?(n=this._parseIndexExpression(),this._projectIfSlice({type:"Identity"},n)):this._lookahead(0)===U&&this._lookahead(1)===i?(this._advance(),this._advance(),{type:"Projection",children:[{type:"Identity"},n=this._parseProjectionRHS(pt.Star)]}):this._parseMultiselectList();case k:return{type:k};case x:return{type:x,value:t.value};case E:return{type:E};case w:return{type:"ExpressionReference",children:[s=this.expression(pt.Expref)]};case z:for(o=[];this._lookahead(0)!==d;)this._lookahead(0)===k?(s={type:k},this._advance()):s=this.expression(0),o.push(s);return this._match(d),o[0];default:this._errorToken(t)}},led:function(t,e){var r,n,s,u,o,a,c;switch(t){case g:return{type:"ConcatenateExpression",children:[e,n=this.expression(pt.Concatenate)]};case B:return a=pt.Dot,this._lookahead(0)!==U?{type:"Subexpression",children:[e,n=this._parseDotRHS(a)]}:(this._advance(),{type:"ValueProjection",children:[e,n=this._parseProjectionRHS(a)]});case S:return n=this.expression(pt.Pipe),{type:S,children:[e,n]};case j:return{type:"OrExpression",children:[e,n=this.expression(pt.Or)]};case O:return{type:"AndExpression",children:[e,n=this.expression(pt.And)]};case P:return{type:"AddExpression",children:[e,n=this.expression(pt.Add)]};case T:return{type:"SubtractExpression",children:[e,n=this.expression(pt.Subtract)]};case A:return{type:"MultiplyExpression",children:[e,n=this.expression(pt.Multiply)]};case N:return{type:"DivideExpression",children:[e,n=this.expression(pt.Divide)]};case I:return{type:"PowerExpression",children:[e,n=this.expression(pt.Power)]};case z:for(s=e.name,u=[];this._lookahead(0)!==d;)this._lookahead(0)===k?(o={type:k},this._advance()):o=this.expression(0),this._lookahead(0)===y&&this._match(y),u.push(o);return this._match(d),{type:"Function",name:s,children:u};case Y:return r=this.expression(0),this._match(i),{type:"FilterProjection",children:[e,n=this._lookahead(0)===D?{type:"Identity"}:this._parseProjectionRHS(pt.Filter),r]};case D:return{type:"Projection",children:[{type:D,children:[e]},this._parseProjectionRHS(pt.Flatten)]};case R:case H:case M:case F:case L:case C:return this._parseComparator(e,t);case G:return(c=this._lookaheadToken(0)).type===b||c.type===v?(n=this._parseIndexExpression(),this._projectIfSlice(e,n)):(this._match(U),this._match(i),{type:"Projection",children:[e,n=this._parseProjectionRHS(pt.Star)]});default:this._errorToken(this._lookaheadToken(0))}},_match:function(t){if(this._lookahead(0)!==t){var e=this._lookaheadToken(0),r=new Error("Expected ".concat(t,", got: ").concat(e.type));throw r.name="ParserError",r}this._advance()},_errorToken:function(t){var e=new Error("Invalid token (".concat(t.type,'): "').concat(t.value,'"'));throw e.name="ParserError",e},_parseIndexExpression:function(){if(this._lookahead(0)===v||this._lookahead(1)===v)return this._parseSliceExpression();var t={type:"Index",value:this._lookaheadToken(0).value};return this._advance(),this._match(i),t},_projectIfSlice:function(t,e){var r={type:"IndexExpression",children:[t,e]};return"Slice"===e.type?{type:"Projection",children:[r,this._parseProjectionRHS(pt.Star)]}:r},_parseSliceExpression:function(){for(var t=[null,null,null],e=0,r=this._lookahead(0);r!==i&&e<3;){if(r===v)e+=1,this._advance();else{if(r!==b){var n=this._lookahead(0),s=new Error("Syntax error, unexpected token: ".concat(n.value,"(").concat(n.type,")"));throw s.name="Parsererror",s}t[e]=this._lookaheadToken(0).value,this._advance()}r=this._lookahead(0)}return this._match(i),{type:"Slice",children:t}},_parseComparator:function(t,e){return{type:"Comparator",name:e,children:[t,this.expression(pt[e])]}},_parseDotRHS:function(t){var n=this._lookahead(0);return[e,r,U].indexOf(n)>=0?this.expression(t):n===G?(this._match(G),this._parseMultiselectList()):n===J?(this._match(J),this._parseMultiselectHash()):void 0},_parseProjectionRHS:function(t){var e;if(pt[this._lookahead(0)]<10)e={type:"Identity"};else if(this._lookahead(0)===G)e=this.expression(t);else if(this._lookahead(0)===Y)e=this.expression(t);else{if(this._lookahead(0)!==B){var r=this._lookaheadToken(0),n=new Error("Sytanx error, unexpected token: ".concat(r.value,"(").concat(r.type,")"));throw n.name="ParserError",n}this._match(B),e=this._parseDotRHS(t)}return e},_parseMultiselectList:function(){for(var t=[];this._lookahead(0)!==i;){var e=this.expression(0);if(t.push(e),this._lookahead(0)===y&&(this._match(y),this._lookahead(0)===i))throw new Error("Unexpected token Rbracket")}return this._match(i),{type:"MultiSelectList",children:t}},_parseMultiselectHash:function(){for(var t,n,i,s=[],u=[e,r];;){if(t=this._lookaheadToken(0),u.indexOf(t.type)<0)throw new Error("Expecting an identifier token, got: ".concat(t.type));if(n=t.value,this._advance(),this._match(v),i={type:"KeyValuePair",name:n,value:this.expression(0)},s.push(i),this._lookahead(0)===y)this._match(y);else if(this._lookahead(0)===m){this._match(m);break}}return{type:"MultiSelectHash",children:s}}},dt.prototype={search:function(t,e){return this.visit(t,e)},visit:function(t,e){var r,n,i,a,h,l,f,p,d,y,v,g,m,b,E,j,O,P,T,A,I,N,U,Y;switch(t.type){case"Field":return null!==e&&tt(e)?void 0===(l=e[t.name])?null:l:null;case"Subexpression":for(i=this.visit(t.children[0],e),d=1;d<t.children.length;d+=1)if(null===(i=this.visit(t.children[1],i)))return null;return i;case"IndexExpression":case S:return f=this.visit(t.children[0],e),this.visit(t.children[1],f);case"Index":return $(e)?((g=t.value)<0&&(g=e.length+g),void 0===(i=e[g])&&(i=null),i):null;case"Slice":if(!$(e))return null;m=t.children.slice(0);var B=s(this.computeSliceParams(e.length,m),3);if(b=B[0],E=B[1],i=[],(j=B[2])>0)for(d=b;d<E;d+=j)i.push(e[d]);else for(d=b;d>E;d+=j)i.push(e[d]);return i;case"Projection":if(!$(v=this.visit(t.children[0],e)))return null;for(p=[],d=0;d<v.length;d+=1)null!==(n=this.visit(t.children[1],v[d]))&&p.push(n);return p;case"ValueProjection":if(!tt(Z(v=this.visit(t.children[0],e))))return null;for(p=[],O=function(t){for(var e=Object.keys(t),r=[],n=0;n<e.length;n+=1)r.push(t[e[n]]);return r}(v),d=0;d<O.length;d+=1)null!==(n=this.visit(t.children[1],O[d]))&&p.push(n);return p;case"FilterProjection":if(!$(v=this.visit(t.children[0],e)))return null;for(P=[],T=[],d=0;d<v.length;d+=1)nt(r=this.visit(t.children[2],v[d]))||P.push(v[d]);for(var J=0;J<P.length;J+=1)null!==(n=this.visit(t.children[1],P[J]))&&T.push(n);return T;case"Comparator":switch(a=this.visit(t.children[0],e),h=this.visit(t.children[1],e),t.name){case R:i=rt(a,h);break;case H:i=!rt(a,h);break;case M:i=a>h;break;case F:i=a>=h;break;case L:i=a<h;break;case C:i=a<=h;break;default:throw new Error("Unknown comparator: ".concat(t.name))}return i;case D:if(!$(A=this.visit(t.children[0],e)))return null;for(I=[],d=0;d<A.length;d+=1){var G;$(n=A[d])?(G=I).push.apply(G,function(t){if(Array.isArray(t))return o(t)}(Y=n)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(Y)||u(Y)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()):I.push(n)}return I;case"Identity":case k:return e;case"MultiSelectList":if(null===e)return null;for(p=[],d=0;d<t.children.length;d+=1)p.push(this.visit(t.children[d],e));return p;case"MultiSelectHash":if(null===e)return null;for(p={},d=0;d<t.children.length;d+=1)p[(y=t.children[d]).name]=this.visit(y.value,e);return p;case"OrExpression":return nt(r=this.visit(t.children[0],e))&&(r=this.visit(t.children[1],e)),r;case"AndExpression":return!0===nt(a=this.visit(t.children[0],e))?a:this.visit(t.children[1],e);case"AddExpression":return it(a=this.visit(t.children[0],e))+it(this.visit(t.children[1],e));case"ConcatenateExpression":return a=this.visit(t.children[0],e),h=this.visit(t.children[1],e),st(a=ut(et(a),[c,_],a,"concatenate"),h=ut(et(h),[c,_],h,"concatenate"),"&");case"SubtractExpression":return(a=this.visit(t.children[0],e))-this.visit(t.children[1],e);case"MultiplyExpression":return st(a=this.visit(t.children[0],e),h=this.visit(t.children[1],e),"*");case"DivideExpression":return(a=this.visit(t.children[0],e))/this.visit(t.children[1],e);case"PowerExpression":return a=this.visit(t.children[0],e),Math.pow(a,this.visit(t.children[1],e));case"NotExpression":return nt(a=this.visit(t.children[0],e));case"Literal":case"Number":case x:return t.value;case"Function":for(N=[],d=0;d<t.children.length;d+=1)N.push(this.visit(t.children[d],e));return this.runtime.callFunction(t.name,N);case"ExpressionReference":return(U=s(t.children,1)[0]).jmespathType=w,U;default:throw new Error("Unknown node type: ".concat(t.type))}},computeSliceParams:function(t,e){var r=e[0],n=e[1],i=e[2],s=[null,null,null];if(null===i)i=1;else if(0===i){var u=new Error("Invalid slice, step cannot be 0");throw u.name="RuntimeError",u}var o=i<0;return r=null===r?o?t-1:0:this.capSliceRange(t,r,i),n=null===n?o?-1:t:this.capSliceRange(t,n,i),s[0]=r,s[1]=n,s[2]=i,s},capSliceRange:function(t,e,r){return e<0?(e+=t)<0&&(e=r<0?-1:0):e>=t&&(e=r<0?t-1:t),e}},yt.prototype={callFunction:function(t,e){var r=this.functionTable[t];if(void 0===r)throw new Error("Unknown function: ".concat(t,"()"));return this._validateArgs(t,e,r._signature),r._func.call(this,e)},_validateArgs:function(t,e,r){if(0!==r.length){var n,i,s;if(r[r.length-1].variadic){if(e.length<r.length)throw n=1===r.length?" argument":" arguments",new Error("ArgumentError: ".concat(t,"() ")+"takes at least".concat(r.length).concat(n," but received ").concat(e.length))}else if(e.length!==r.length)throw n=1===r.length?" argument":" arguments",new Error("ArgumentError: ".concat(t,"() ")+"takes ".concat(r.length).concat(n," but received ").concat(e.length));for(var u=0;u<r.length;u+=1)i=r[u].types,s=et(e[u]),e[u]=ut(s,i,e[u],t)}},_functionStartsWith:function(t){return 0===Z(t[0]).lastIndexOf(Z(t[1]))},_functionEndsWith:function(t){var e=Z(t[0]),r=Z(t[1]);return-1!==e.indexOf(r,e.length-r.length)},_functionReverse:function(t){var e=Z(t[0]);if(et(e)===c){for(var r="",n=e.length-1;n>=0;n-=1)r+=e[n];return r}var i=t[0].slice(0);return i.reverse(),i},_functionAbs:function(t){return Math.abs(t[0])},_functionCeil:function(t){return Math.ceil(t[0])},_functionAvg:function(t){for(var e=0,r=t[0],n=0;n<r.length;n+=1)e+=r[n];return e/r.length},_functionContains:function(t){return Z(t[0]).indexOf(Z(t[1]))>=0},_functionFloor:function(t){return Math.floor(t[0])},_functionLength:function(t){var e=Z(t[0]);return tt(e)?Object.keys(e).length:$(e)?e.length:X(e).length},_functionMap:function(t){for(var e=[],r=this._interpreter,n=t[0],i=t[1],s=0;s<i.length;s+=1)e.push(r.visit(n,i[s]));return e},_functionMerge:function(t){for(var e={},r=function(r){var n=t[r];Object.keys(n).forEach((function(t){e[t]=n[t]}))},n=0;n<t.length;n+=1)r(n);return e},_functionMax:function(t){return t[0].length>0?et(t[0][0])===a?t[0].reduce((function(t,e){return it(t)>=it(e)?t:e}),t[0][0]):t[0].reduce((function(t,e){return X(e).localeCompare(X(t))<0?t:e}),t[0][0]):null},_functionMin:function(t){if(t[0].length>0){if(et(t[0][0])===a)return t[0].reduce((function(t,e){return it(t)<=it(e)?t:e}),t[0][0]);for(var e=t[0],r=e[0],n=1;n<e.length;n+=1)X(e[n]).localeCompare(X(r))<0&&(r=e[n]);return r}return null},_functionSum:function(t){for(var e=0,r=t[0],n=0;n<r.length;n+=1)e+=1*r[n];return e},_functionAnd:function(t){return!!Z(t[0])&&!!Z(t[1])},_functionIf:function(t){return Z(t[0])?t[1]:t[2]},_functionOr:function(t){return!!Z(t[0])||!!Z(t[1])},_functionNot:function(t){return!Z(t[0])},_functionType:function(t){switch(et(t[0])){case a:return"number";case c:return"string";case h:return"array";case 4:return"object";case l:return"boolean";case 6:return"expref";case f:return"null"}},_functionKeys:function(t){return Object.keys(t[0])},_functionValues:function(t){for(var e=t[0],r=Object.keys(e),n=[],i=0;i<r.length;i+=1)n.push(e[r[i]]);return n},_functionJoin:function(t){var e=t[0];return t[1].join(e)},_functionToArray:function(t){return et(t[0])===h?t[0]:[t[0]]},_functionToString:function(t){return et(t[0])===c?t[0]:JSON.stringify(t[0])},_functionToNumber:function(t){var e=et(t[0]);return e===a?t[0]:e===c?it(t[0]):null},_functionNotNull:function(t){for(var e=0;e<t.length;e+=1)if(et(t[e])!==f)return t[e];return null},_functionSort:function(t){var e=t[0].slice(0);if(e.length>0){var r=et(t[0][0])===a?it:X;e.sort((function(t,e){var n=r(t),i=r(e);return n<i?-1:n>i?1:0}))}return e},_functionSortBy:function(t){var e=t[0].slice(0);if(0===e.length)return e;var r=this._interpreter,n=t[1],i=et(r.visit(n,e[0]));if([a,c].indexOf(i)<0)throw new Error("TypeError");for(var u=[],o=0;o<e.length;o+=1)u.push([o,e[o]]);u.sort((function(t,e){var s=r.visit(n,t[1]),u=r.visit(n,e[1]);if(et(s)!==i)throw new Error("TypeError: expected ".concat(i,", received ").concat(et(s)));if(et(u)!==i)throw new Error("TypeError: expected ".concat(i,", received ").concat(et(u)));return s>u?1:s<u?-1:t[0]-e[0]}));for(var h=0;h<u.length;h+=1){var l=s(u[h],2);e[h]=l[1]}return e},_functionMaxBy:function(t){for(var e,r,n=t[1],i=t[0],s=this.createKeyFunction(n,[a,c]),u=-1/0,o=0;o<i.length;o+=1)(r=s(i[o]))>u&&(u=r,e=i[o]);return e},_functionMinBy:function(t){for(var e,r,n=t[1],i=t[0],s=this.createKeyFunction(n,[a,c]),u=1/0,o=0;o<i.length;o+=1)(r=s(i[o]))<u&&(u=r,e=i[o]);return e},createKeyFunction:function(t,e){var r=this._interpreter;return function(n){var i=r.visit(t,n);if(e.indexOf(et(i))<0){var s="TypeError: expected one of ".concat(e,", received ").concat(et(i));throw new Error(s)}return i}}},this.tokenize=function(t){return(new ft).tokenize(t)},this.compile=function(t){return(new _t).parse(t)},this.search=function(t,e,r,n){var i=new _t,s=new yt(n),u=new dt(s);s._interpreter=u,e&&(V=e);var o=i.parse(r);return u.search(o,t)},this.strictDeepEqual=rt}d.dataTypes={TYPE_NUMBER:a,TYPE_ANY:1,TYPE_STRING:c,TYPE_ARRAY:h,TYPE_OBJECT:4,TYPE_BOOLEAN:l,TYPE_EXPREF:6,TYPE_NULL:f,TYPE_ARRAY_NUMBER:p,TYPE_ARRAY_STRING:_};const y=new d;function v(t,e,r,n){return y.search(t,e,r,n)}var g=y.constructor.dataTypes;return e})()}));
//# sourceMappingURL=json-formula.js.map