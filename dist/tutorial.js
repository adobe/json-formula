var JSONFormula;(()=>{"use strict";var t={};function e(t){return function(t){if(Array.isArray(t))return i(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||n(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function r(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var r=t&&("undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"]);if(null!=r){var n,i,s=[],u=!0,o=!1;try{for(r=r.call(t);!(u=(n=r.next()).done)&&(s.push(n.value),!e||s.length!==e);u=!0);}catch(t){o=!0,i=t}finally{try{u||null==r.return||r.return()}finally{if(o)throw i}}return s}}(t,e)||n(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function n(t,e){if(t){if("string"==typeof t)return i(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?i(t,e):void 0}}function i(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}(t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})})(t);const s=new function(){var t,n=0,i=2,s=3,u=5,o=7,a=8,c=9,h="UnquotedIdentifier",l="QuotedIdentifier",f="Rbracket",p="Rparen",_="Comma",d="Colon",y="Concatenate",v="Rbrace",g="Number",m="Current",k="Form",b="Field",x="Expref",S="Pipe",w="Or",E="And",O="Add",j="Subtract",I="Multiply",T="Power",M="Divide",P="EQ",N="GT",A="LT",F="GTE",L="LTE",R="NE",C="Flatten",H="Star",J="Filter",B="Dot",q="Lbrace",U="Lbracket",D="Lparen",$="Literal",z={0:"number",1:"any",2:"string",3:"array",4:"object",5:"boolean",6:"expression",7:"null",8:"Array<number>",9:"Array<string>"};function K(t,e){return t>="0"&&t<="9"||e&&"-"===t||"."===t}function Q(t){return t>="a"&&t<="z"||t>="A"&&t<="Z"||t>="0"&&t<="9"||"_"===t}function V(t){return null!==t&&"[object Array]"===Object.prototype.toString.call(t)}function W(t){return null!==t&&"[object Object]"===Object.prototype.toString.call(t)}function G(t){if(null===t)return o;var e=t.valueOf();switch(Object.prototype.toString.call(e)){case"[object String]":return i;case"[object Number]":return n;case"[object Array]":return s;case"[object Boolean]":return u;case"[object Null]":return o;case"[object Object]":return e.jmespathType===x?6:4;default:return 4}}function Z(t,e){var r=null==t?t:t.valueOf(),n=null==e?e:e.valueOf();if(r===n)return!0;if(W(r)&&"function"==typeof r.equals)return r.equals(n);if(W(n)&&"function"==typeof n.equals)return n.equals(r);if(Object.prototype.toString.call(r)!==Object.prototype.toString.call(n))return!1;if(!0===V(r)){if(r.length!==n.length)return!1;for(var i=0;i<r.length;i+=1)if(!1===Z(r[i],n[i]))return!1;return!0}if(!0===W(r)){var s={};for(var u in r)if(hasOwnProperty.call(r,u)){if(!1===Z(r[u],n[u]))return!1;s[u]=!0}for(var o in n)if(hasOwnProperty.call(n,o)&&!0!==s[o])return!1;return!0}return!1}function X(t){if(null===t)return!0;var e=t.valueOf();if(""===e||!1===e||null===e)return!0;if(V(e)&&0===e.length)return!0;if(W(e)){for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r))return!1;return!0}return!e}function Y(t){if(null===t)return 0;var e=t.valueOf();if(null===e)return 0;if(e instanceof Array)return 0;if("number"==typeof e)return e;if("string"==typeof e){var r=parseFloat(e);return Number.isNaN(r)?0:r}if("boolean"==typeof e)return e?1:0;throw new Error("need to coerce number")}function tt(t,e,n){if(V(t)&&V(e)){var i,s=Math.min(t.length,e.length),u=[];for(i=0;i<s;i+=1)if(V(t[i])||V(e[i]))u.push(tt(t[i],e[i],n));else if("*"===n)u.push(t[i]*e[i]);else{if("&"!==n)throw new Error("unimplemented");u.push(t[i]+e[i])}for(i=s;i<Math.max(t.length,e.length);i+=1)"&"===n?u.push(""):"*"===n&&u.push(0);return u}if(V(t)||V(e)){var o=r(V(t)?[t,e]:[e,t],2),a=o[0],c=o[1];if("*"===n)return a.map((function(t){return Y(t)*Y(c)}));if("&"===n)return a.map((function(t){return t+c}))}if("*"===n)return Y(t)*Y(e);if("&"===n)return t+e;throw new Error("unimplemented array operator: ".concat(n))}function et(t,e,h,l){if(-1!==e.findIndex((function(e){return 1===e||t===e})))return h;if(4===t)throw new Error("TypeError: ".concat(l," expected argument to be type ").concat(z[e[0]]," but received type ").concat(z[t]," instead."));var f=-1;if(t===s&&e.includes(c)&&e.includes(a)&&(f=h.length>0&&"string"==typeof h[0]?c:a),-1===f&&[c,a,s].includes(t)&&(f=e.find((function(t){return[c,a,s].includes(t)}))),-1===f&&(f=r(e,1)[0]),f===c||f===a||f===s){if(f===s)return t===a||t===c?h:null===h?[]:[h];var p=f===a?n:i;if(t===s){for(var _=h.slice(),d=0;d<_.length;d+=1){var y=G(_[d]);_[d]=et(y,[p],_[d],l)}return _}if([n,i,o,u].includes(p))return[et(t,[p],h,l)]}else{if(f===n)return t===i?Y(h):t===u&&h?1:0;if(f===i)return t===o||4===t?"":h.toString();if(f===u)return!!h}throw new Error("unhandled argument")}t="function"==typeof String.prototype.trimLeft?function(t){return t.trimLeft()}:function(t){return t.match(/^\s*(.*)/)[1]};var rt={".":B,",":_,":":d,"{":q,"}":v,"]":f,"(":D,")":p,"@":m,$form:k,$field:b},nt={"<":!0,">":!0,"=":!0,"!":!0},it={" ":!0,"\t":!0,"\n":!0};function st(t,e){var r=t[e];return"@"===r?t.length>e&&Q(t[e+1]):r>="a"&&r<="z"||r>="A"&&r<="Z"||"_"===r}function ut(){}ut.prototype={tokenize:function(t){var e,r,n,i=[];for(this._current=0;this._current<t.length;){var s=i.length?i.slice(-1)[0].type:null;if(st(t,this._current))e=this._current,r=this._consumeUnquotedIdentifier(t),i.push({type:h,value:r,start:e});else if(void 0!==rt[t[this._current]])i.push({type:rt[t[this._current]],value:t[this._current],start:this._current}),this._current+=1;else if("-"===t[this._current]&&s!==g&&s!==p||K(t[this._current],!1))n=this._consumeNumber(t),i.push(n);else if("["===t[this._current])n=this._consumeLBracket(t),i.push(n);else if('"'===t[this._current])e=this._current,r=this._consumeQuotedIdentifier(t),i.push({type:l,value:r,start:e});else if("'"===t[this._current])e=this._current,r=this._consumeRawStringLiteral(t),i.push({type:$,value:r,start:e});else if("`"===t[this._current]){e=this._current;var u=this._consumeLiteral(t);i.push({type:$,value:u,start:e})}else if("$"===t[this._current])i.push(this._consumeSpecial(t));else if(void 0!==nt[t[this._current]])i.push(this._consumeOperator(t));else if(void 0!==it[t[this._current]])this._current+=1;else if("&"===t[this._current])e=this._current,this._current+=1,"&"===t[this._current]?(this._current+=1,i.push({type:E,value:"&&",start:e})):s===_||s===D?i.push({type:x,value:"&",start:e}):i.push({type:y,value:"&",start:e});else if("+"===t[this._current])e=this._current,this._current+=1,i.push({type:O,value:"+",start:e});else if("-"===t[this._current])e=this._current,this._current+=1,i.push({type:j,value:"-",start:e});else if("*"===t[this._current]){e=this._current,this._current+=1;var o=i.length&&i.slice(-1)[0].type;0===i.length||[U,B,S,E,w,_,d].includes(o)?i.push({type:H,value:"*",start:e}):i.push({type:I,value:"*",start:e})}else if("/"===t[this._current])e=this._current,this._current+=1,i.push({type:M,value:"/",start:e});else if("^"===t[this._current])e=this._current,this._current+=1,i.push({type:T,value:"^",start:e});else{if("|"!==t[this._current]){var a=new Error("Unknown character:".concat(t[this._current]));throw a.name="LexerError",a}e=this._current,this._current+=1,"|"===t[this._current]?(this._current+=1,i.push({type:w,value:"||",start:e})):i.push({type:S,value:"|",start:e})}}return i},_consumeUnquotedIdentifier:function(t){var e=this._current;for(this._current+=1;this._current<t.length&&Q(t[this._current]);)this._current+=1;return t.slice(e,this._current)},_consumeQuotedIdentifier:function(t){var e=this._current;this._current+=1;for(var r=t.length;'"'!==t[this._current]&&this._current<r;){var n=this._current;"\\"!==t[n]||"\\"!==t[n+1]&&'"'!==t[n+1]?n+=1:n+=2,this._current=n}return this._current+=1,JSON.parse(t.slice(e,this._current))},_consumeRawStringLiteral:function(t){var e=this._current;this._current+=1;for(var r=t.length;"'"!==t[this._current]&&this._current<r;){var n=this._current;"\\"!==t[n]||"\\"!==t[n+1]&&"'"!==t[n+1]?n+=1:n+=2,this._current=n}return this._current+=1,t.slice(e+1,this._current-1).replace("\\'","'")},_consumeNumber:function(t){var e=this._current;this._current+=1;for(var r=t.length;K(t[this._current],!1)&&this._current<r;)this._current+=1;var n,i=t.slice(e,this._current);return n=i.includes(".")?parseFloat(i):parseInt(i,10),{type:g,value:n,start:e}},_consumeLBracket:function(t){var e=this._current;return this._current+=1,"?"===t[this._current]?(this._current+=1,{type:J,value:"[?",start:e}):"]"===t[this._current]?(this._current+=1,{type:C,value:"[]",start:e}):{type:U,value:"[",start:e}},_consumeSpecial:function(t){var e=this._current;return this._current+=1,"o"===t[this._current+1]?(this._current+=4,{type:k,value:this.data,start:e}):(this._current+=5,{type:b,value:{},start:e})},_consumeOperator:function(t){var e=this._current,r=t[e];return this._current+=1,"!"===r?"="===t[this._current]?(this._current+=1,{type:R,value:"!=",start:e}):{type:"Not",value:"!",start:e}:"<"===r?"="===t[this._current]?(this._current+=1,{type:L,value:"<=",start:e}):{type:A,value:"<",start:e}:">"===r?"="===t[this._current]?(this._current+=1,{type:F,value:">=",start:e}):{type:N,value:">",start:e}:"="===t[this._current]?(this._current+=1,{type:P,value:"==",start:e}):{type:P,value:"=",start:e}},_consumeLiteral:function(e){this._current+=1;for(var r,n=this._current,i=e.length;"`"!==e[this._current]&&this._current<i;){var s=this._current;"\\"!==e[s]||"\\"!==e[s+1]&&"`"!==e[s+1]?s+=1:s+=2,this._current=s}var u=t(e.slice(n,this._current));return u=u.replace("\\`","`"),r=this._looksLikeJSON(u)?JSON.parse(u):JSON.parse('"'.concat(u,'"')),this._current+=1,r},_looksLikeJSON:function(t){if(""===t)return!1;if('[{"'.indexOf(t[0])>=0)return!0;if(["true","false","null"].indexOf(t)>=0)return!0;if(!("-0123456789".indexOf(t[0])>=0))return!1;try{return JSON.parse(t),!0}catch(t){return!1}}};var ot={};function at(){}function ct(t){this.runtime=t}function ht(t){this._interpreter=t,this.functionTable={abs:{_func:this._functionAbs,_signature:[{types:[n]}]},avg:{_func:this._functionAvg,_signature:[{types:[a]}]},ceil:{_func:this._functionCeil,_signature:[{types:[n]}]},contains:{_func:this._functionContains,_signature:[{types:[i,s]},{types:[1]}]},ends_with:{_func:this._functionEndsWith,_signature:[{types:[i]},{types:[i]}]},floor:{_func:this._functionFloor,_signature:[{types:[n]}]},length:{_func:this._functionLength,_signature:[{types:[i,s,4]}]},map:{_func:this._functionMap,_signature:[{types:[6]},{types:[s]}]},max:{_func:this._functionMax,_signature:[{types:[a,c]}]},merge:{_func:this._functionMerge,_signature:[{types:[4],variadic:!0}]},max_by:{_func:this._functionMaxBy,_signature:[{types:[s]},{types:[6]}]},sum:{_func:this._functionSum,_signature:[{types:[a]}]},starts_with:{_func:this._functionStartsWith,_signature:[{types:[i]},{types:[i]}]},min:{_func:this._functionMin,_signature:[{types:[a,c]}]},min_by:{_func:this._functionMinBy,_signature:[{types:[s]},{types:[6]}]},type:{_func:this._functionType,_signature:[{types:[1]}]},keys:{_func:this._functionKeys,_signature:[{types:[4]}]},values:{_func:this._functionValues,_signature:[{types:[4]}]},sort:{_func:this._functionSort,_signature:[{types:[c,a]}]},sort_by:{_func:this._functionSortBy,_signature:[{types:[s]},{types:[6]}]},join:{_func:this._functionJoin,_signature:[{types:[i]},{types:[c]}]},reverse:{_func:this._functionReverse,_signature:[{types:[i,s]}]},to_array:{_func:this._functionToArray,_signature:[{types:[1]}]},to_string:{_func:this._functionToString,_signature:[{types:[1]}]},to_number:{_func:this._functionToNumber,_signature:[{types:[1]}]},not_null:{_func:this._functionNotNull,_signature:[{types:[1],variadic:!0}]},and:{_func:this._functionAnd,_signature:[{types:[1]},{types:[1]}]},or:{_func:this._functionOr,_signature:[{types:[1]},{types:[1]}]},not:{_func:this._functionNot,_signature:[{types:[1]}]},true:{_func:function(){return!0},_signature:[]},false:{_func:function(){return!1},_signature:[]},if:{_func:this._functionIf,_signature:[{types:[1]},{types:[1]},{types:[1]}]}}}ot.EOF=0,ot.UnquotedIdentifier=0,ot.QuotedIdentifier=0,ot.Rbracket=0,ot.Rparen=0,ot[_]=0,ot.Rbrace=0,ot.Number=0,ot.Current=0,ot.Form=0,ot.Field=0,ot.Expref=0,ot[S]=1,ot[w]=2,ot[E]=3,ot[O]=6,ot[j]=6,ot[y]=7,ot[I]=7,ot[M]=7,ot[T]=7,ot[P]=5,ot[N]=5,ot[A]=5,ot[F]=5,ot[L]=5,ot[R]=5,ot.Flatten=9,ot.Star=20,ot.Filter=21,ot[B]=40,ot.Not=45,ot.Lbrace=50,ot[U]=55,ot.Lparen=60,at.prototype={parse:function(t){this._loadTokens(t),this.index=0;var e=this.expression(0);if("EOF"!==this._lookahead(0)){var r=this._lookaheadToken(0),n=new Error("Unexpected token type: ".concat(r.type,", value: ").concat(r.value));throw n.name="ParserError",n}return e},_loadTokens:function(t){var e=(new ut).tokenize(t);e.push({type:"EOF",value:"",start:t.length}),this.tokens=e},expression:function(t){var e=this._lookaheadToken(0);this._advance();for(var r=this.nud(e),n=this._lookahead(0);t<ot[n];)this._advance(),r=this.led(n,r),n=this._lookahead(0);return r},_lookahead:function(t){return this.tokens[this.index+t].type},_lookaheadToken:function(t){return this.tokens[this.index+t]},_advance:function(){this.index+=1},nud:function(t){var e,r,n,i,s;switch(t.type){case $:return{type:"Literal",value:t.value};case g:return{type:"Number",value:t.value};case h:return{type:"Field",name:t.value};case l:if(n={type:"Field",name:t.value},this._lookahead(0)===D)throw new Error("Quoted identifier not allowed for function names.");return n;case"Not":return{type:"NotExpression",children:[e=this.expression(ot.Not)]};case H:return{type:"ValueProjection",children:[{type:"Identity"},e=this._lookahead(0)===f?{type:"Identity"}:this._parseProjectionRHS(ot.Star)]};case J:return this.led(t.type,{type:"Identity"});case q:return this._parseMultiselectHash();case C:return{type:"Projection",children:[{type:C,children:[{type:"Identity"}]},e=this._parseProjectionRHS(ot.Flatten)]};case U:return this._lookahead(1)===_||(s=this._lookahead(1),[y,w,E,O,j,I,T,M,P,N,A,F,L,R].includes(s))?this._parseMultiselectList():this._lookahead(0)===g||this._lookahead(0)===d?(e=this._parseIndexExpression(),this._projectIfSlice({type:"Identity"},e)):this._lookahead(0)===H&&this._lookahead(1)===f?(this._advance(),this._advance(),{type:"Projection",children:[{type:"Identity"},e=this._parseProjectionRHS(ot.Star)]}):this._parseMultiselectList();case m:return{type:m};case k:return{type:k};case b:return{type:b};case x:return{type:"ExpressionReference",children:[r=this.expression(ot.Expref)]};case D:for(i=[];this._lookahead(0)!==p;)this._lookahead(0)===m?(r={type:m},this._advance()):r=this.expression(0),i.push(r);return this._match(p),i[0];default:this._errorToken(t)}},led:function(t,e){var r,n,i,s,u,o,a;switch(t){case y:return{type:"ConcatenateExpression",children:[e,n=this.expression(ot.Concatenate)]};case B:return o=ot.Dot,this._lookahead(0)!==H?{type:"Subexpression",children:[e,n=this._parseDotRHS(o)]}:(this._advance(),{type:"ValueProjection",children:[e,n=this._parseProjectionRHS(o)]});case S:return n=this.expression(ot.Pipe),{type:S,children:[e,n]};case w:return{type:"OrExpression",children:[e,n=this.expression(ot.Or)]};case E:return{type:"AndExpression",children:[e,n=this.expression(ot.And)]};case O:return{type:"AddExpression",children:[e,n=this.expression(ot.Add)]};case j:return{type:"SubtractExpression",children:[e,n=this.expression(ot.Subtract)]};case I:return{type:"MultiplyExpression",children:[e,n=this.expression(ot.Multiply)]};case M:return{type:"DivideExpression",children:[e,n=this.expression(ot.Divide)]};case T:return{type:"PowerExpression",children:[e,n=this.expression(ot.Power)]};case D:for(i=e.name,s=[];this._lookahead(0)!==p;)this._lookahead(0)===m?(u={type:m},this._advance()):u=this.expression(0),this._lookahead(0)===_&&this._match(_),s.push(u);return this._match(p),{type:"Function",name:i,children:s};case J:return r=this.expression(0),this._match(f),{type:"FilterProjection",children:[e,n=this._lookahead(0)===C?{type:"Identity"}:this._parseProjectionRHS(ot.Filter),r]};case C:return{type:"Projection",children:[{type:C,children:[e]},this._parseProjectionRHS(ot.Flatten)]};case P:case R:case N:case F:case A:case L:return this._parseComparator(e,t);case U:return(a=this._lookaheadToken(0)).type===g||a.type===d?(n=this._parseIndexExpression(),this._projectIfSlice(e,n)):(this._match(H),this._match(f),{type:"Projection",children:[e,n=this._parseProjectionRHS(ot.Star)]});default:this._errorToken(this._lookaheadToken(0))}},_match:function(t){if(this._lookahead(0)!==t){var e=this._lookaheadToken(0),r=new Error("Expected ".concat(t,", got: ").concat(e.type));throw r.name="ParserError",r}this._advance()},_errorToken:function(t){var e=new Error("Invalid token (".concat(t.type,'): "').concat(t.value,'"'));throw e.name="ParserError",e},_parseIndexExpression:function(){if(this._lookahead(0)===d||this._lookahead(1)===d)return this._parseSliceExpression();var t={type:"Index",value:this._lookaheadToken(0).value};return this._advance(),this._match(f),t},_projectIfSlice:function(t,e){var r={type:"IndexExpression",children:[t,e]};return"Slice"===e.type?{type:"Projection",children:[r,this._parseProjectionRHS(ot.Star)]}:r},_parseSliceExpression:function(){for(var t=[null,null,null],e=0,r=this._lookahead(0);r!==f&&e<3;){if(r===d)e+=1,this._advance();else{if(r!==g){var n=this._lookahead(0),i=new Error("Syntax error, unexpected token: ".concat(n.value,"(").concat(n.type,")"));throw i.name="Parsererror",i}t[e]=this._lookaheadToken(0).value,this._advance()}r=this._lookahead(0)}return this._match(f),{type:"Slice",children:t}},_parseComparator:function(t,e){return{type:"Comparator",name:e,children:[t,this.expression(ot[e])]}},_parseDotRHS:function(t){var e=this._lookahead(0);return[h,l,H].indexOf(e)>=0?this.expression(t):e===U?(this._match(U),this._parseMultiselectList()):e===q?(this._match(q),this._parseMultiselectHash()):void 0},_parseProjectionRHS:function(t){var e;if(ot[this._lookahead(0)]<10)e={type:"Identity"};else if(this._lookahead(0)===U)e=this.expression(t);else if(this._lookahead(0)===J)e=this.expression(t);else{if(this._lookahead(0)!==B){var r=this._lookaheadToken(0),n=new Error("Sytanx error, unexpected token: ".concat(r.value,"(").concat(r.type,")"));throw n.name="ParserError",n}this._match(B),e=this._parseDotRHS(t)}return e},_parseMultiselectList:function(){for(var t=[];this._lookahead(0)!==f;){var e=this.expression(0);if(t.push(e),this._lookahead(0)===_&&(this._match(_),this._lookahead(0)===f))throw new Error("Unexpected token Rbracket")}return this._match(f),{type:"MultiSelectList",children:t}},_parseMultiselectHash:function(){for(var t,e,r,n=[],i=[h,l];;){if(t=this._lookaheadToken(0),i.indexOf(t.type)<0)throw new Error("Expecting an identifier token, got: ".concat(t.type));if(e=t.value,this._advance(),this._match(d),r={type:"KeyValuePair",name:e,value:this.expression(0)},n.push(r),this._lookahead(0)===_)this._match(_);else if(this._lookahead(0)===v){this._match(v);break}}return{type:"MultiSelectHash",children:n}}},ct.prototype={search:function(t,e){return this.visit(t,e)},visit:function(t,n){var s,u,o,a,h,l,f,p,_,d,y,v,g,b,w,E,O,j,I,T,M,H,J;switch(t.type){case"Field":return null!==n&&W(n)?void 0===(l=n[t.name])?null:l:null;case"Subexpression":for(o=this.visit(t.children[0],n),_=1;_<t.children.length;_+=1)if(null===(o=this.visit(t.children[1],o)))return null;return o;case"IndexExpression":case S:return f=this.visit(t.children[0],n),this.visit(t.children[1],f);case"Index":return V(n)?((v=t.value)<0&&(v=n.length+v),void 0===(o=n[v])&&(o=null),o):null;case"Slice":if(!V(n))return null;g=t.children.slice(0);var B=r(this.computeSliceParams(n.length,g),3);if(b=B[0],w=B[1],o=[],(E=B[2])>0)for(_=b;_<w;_+=E)o.push(n[_]);else for(_=b;_>w;_+=E)o.push(n[_]);return o;case"Projection":if(!V(y=this.visit(t.children[0],n)))return null;for(p=[],_=0;_<y.length;_+=1)null!==(u=this.visit(t.children[1],y[_]))&&p.push(u);return p;case"ValueProjection":if(!W(y=this.visit(t.children[0],n)))return null;for(p=[],O=function(t){for(var e=Object.keys(t),r=[],n=0;n<e.length;n+=1)r.push(t[e[n]]);return r}(y),_=0;_<O.length;_+=1)null!==(u=this.visit(t.children[1],O[_]))&&p.push(u);return p;case"FilterProjection":if(!V(y=this.visit(t.children[0],n)))return null;for(j=[],I=[],_=0;_<y.length;_+=1)X(s=this.visit(t.children[2],y[_]))||j.push(y[_]);for(var q=0;q<j.length;q+=1)null!==(u=this.visit(t.children[1],j[q]))&&I.push(u);return I;case"Comparator":switch(a=this.visit(t.children[0],n),h=this.visit(t.children[1],n),t.name){case P:o=Z(a,h);break;case R:o=!Z(a,h);break;case N:o=a>h;break;case F:o=a>=h;break;case A:o=a<h;break;case L:o=a<=h;break;default:throw new Error("Unknown comparator: ".concat(t.name))}return o;case C:if(!V(T=this.visit(t.children[0],n)))return null;for(M=[],_=0;_<T.length;_+=1){var U;V(u=T[_])?(U=M).push.apply(U,e(u)):M.push(u)}return M;case"Identity":case m:return n;case"MultiSelectList":if(null===n)return null;for(p=[],_=0;_<t.children.length;_+=1)p.push(this.visit(t.children[_],n));return p;case"MultiSelectHash":if(null===n)return null;for(p={},_=0;_<t.children.length;_+=1)p[(d=t.children[_]).name]=this.visit(d.value,n);return p;case"OrExpression":return X(s=this.visit(t.children[0],n))&&(s=this.visit(t.children[1],n)),s;case"AndExpression":return!0===X(a=this.visit(t.children[0],n))?a:this.visit(t.children[1],n);case"AddExpression":return Y(a=this.visit(t.children[0],n))+Y(this.visit(t.children[1],n));case"ConcatenateExpression":return a=this.visit(t.children[0],n),h=this.visit(t.children[1],n),tt(a=et(G(a),[i,c],a,"concatenate"),h=et(G(h),[i,c],h,"concatenate"),"&");case"SubtractExpression":return(a=this.visit(t.children[0],n))-this.visit(t.children[1],n);case"MultiplyExpression":return tt(a=this.visit(t.children[0],n),h=this.visit(t.children[1],n),"*");case"DivideExpression":return(a=this.visit(t.children[0],n))/this.visit(t.children[1],n);case"PowerExpression":return a=this.visit(t.children[0],n),Math.pow(a,this.visit(t.children[1],n));case"NotExpression":return X(a=this.visit(t.children[0],n));case"Literal":case"Number":return t.value;case k:return this.$form;case"Function":for(H=[],_=0;_<t.children.length;_+=1)H.push(this.visit(t.children[_],n));return this.runtime.callFunction(t.name,H);case"ExpressionReference":return(J=r(t.children,1)[0]).jmespathType=x,J;default:throw new Error("Unknown node type: ".concat(t.type))}},computeSliceParams:function(t,e){var r=e[0],n=e[1],i=e[2],s=[null,null,null];if(null===i)i=1;else if(0===i){var u=new Error("Invalid slice, step cannot be 0");throw u.name="RuntimeError",u}var o=i<0;return r=null===r?o?t-1:0:this.capSliceRange(t,r,i),n=null===n?o?-1:t:this.capSliceRange(t,n,i),s[0]=r,s[1]=n,s[2]=i,s},capSliceRange:function(t,e,r){return e<0?(e+=t)<0&&(e=r<0?-1:0):e>=t&&(e=r<0?t-1:t),e}},ht.prototype={callFunction:function(t,e){var r=this.functionTable[t];if(void 0===r)throw new Error("Unknown function: ".concat(t,"()"));return this._validateArgs(t,e,r._signature),r._func.call(this,e)},_validateArgs:function(t,e,r){if(0!==r.length){var n,i,s;if(r[r.length-1].variadic){if(e.length<r.length)throw n=1===r.length?" argument":" arguments",new Error("ArgumentError: ".concat(t,"() ")+"takes at least".concat(r.length).concat(n," but received ").concat(e.length))}else if(e.length!==r.length)throw n=1===r.length?" argument":" arguments",new Error("ArgumentError: ".concat(t,"() ")+"takes ".concat(r.length).concat(n," but received ").concat(e.length));for(var u=0;u<r.length;u+=1)i=r[u].types,s=G(e[u]),e[u]=et(s,i,e[u],t)}},_functionStartsWith:function(t){return 0===t[0].lastIndexOf(t[1])},_functionEndsWith:function(t){var e=t[0],r=t[1];return-1!==e.indexOf(r,e.length-r.length)},_functionReverse:function(t){if(G(t[0])===i){for(var e=t[0],r="",n=e.length-1;n>=0;n-=1)r+=e[n];return r}var s=t[0].slice(0);return s.reverse(),s},_functionAbs:function(t){return Math.abs(t[0])},_functionCeil:function(t){return Math.ceil(t[0])},_functionAvg:function(t){for(var e=0,r=t[0],n=0;n<r.length;n+=1)e+=r[n];return e/r.length},_functionContains:function(t){return t[0].indexOf(t[1])>=0},_functionFloor:function(t){return Math.floor(t[0])},_functionLength:function(t){return W(t[0])?Object.keys(t[0]).length:t[0].length},_functionMap:function(t){for(var e=[],r=this._interpreter,n=t[0],i=t[1],s=0;s<i.length;s+=1)e.push(r.visit(n,i[s]));return e},_functionMerge:function(t){for(var e={},r=function(r){var n=t[r];Object.keys(n).forEach((function(t){e[t]=n[t]}))},n=0;n<t.length;n+=1)r(n);return e},_functionMax:function(t){if(t[0].length>0){if(G(t[0][0])===n)return Math.max.apply(Math,e(t[0]));for(var r=t[0],i=r[0],s=1;s<r.length;s+=1)i.localeCompare(r[s])<0&&(i=r[s]);return i}return null},_functionMin:function(t){if(t[0].length>0){if(G(t[0][0])===n)return Math.min.apply(Math,e(t[0]));for(var r=t[0],i=r[0],s=1;s<r.length;s+=1)r[s].localeCompare(i)<0&&(i=r[s]);return i}return null},_functionSum:function(t){for(var e=0,r=t[0],n=0;n<r.length;n+=1)e+=1*r[n];return e},_functionAnd:function(t){return!!t[0].valueOf()&&!!t[1].valueOf()},_functionIf:function(t){return t[0].valueOf()?t[1]:t[2]},_functionOr:function(t){return!!t[0].valueOf()||!!t[1]},_functionNot:function(t){return!t[0].valueOf()},_functionType:function(t){switch(G(t[0])){case n:return"number";case i:return"string";case s:return"array";case 4:return"object";case u:return"boolean";case 6:return"expref";case o:return"null"}},_functionKeys:function(t){return Object.keys(t[0])},_functionValues:function(t){for(var e=t[0],r=Object.keys(e),n=[],i=0;i<r.length;i+=1)n.push(e[r[i]]);return n},_functionJoin:function(t){var e=t[0];return t[1].join(e)},_functionToArray:function(t){return G(t[0])===s?t[0]:[t[0]]},_functionToString:function(t){return G(t[0])===i?t[0]:JSON.stringify(t[0])},_functionToNumber:function(t){var e=G(t[0]);return e===n?t[0]:e===i?Y(t[0]):null},_functionNotNull:function(t){for(var e=0;e<t.length;e+=1)if(G(t[e])!==o)return t[e];return null},_functionSort:function(t){var e=t[0].slice(0);return e.sort(),e},_functionSortBy:function(t){var e=t[0].slice(0);if(0===e.length)return e;var s=this._interpreter,u=t[1],o=G(s.visit(u,e[0]));if([n,i].indexOf(o)<0)throw new Error("TypeError");for(var a=[],c=0;c<e.length;c+=1)a.push([c,e[c]]);a.sort((function(t,e){var r=s.visit(u,t[1]),n=s.visit(u,e[1]);if(G(r)!==o)throw new Error("TypeError: expected ".concat(o,", received ").concat(G(r)));if(G(n)!==o)throw new Error("TypeError: expected ".concat(o,", received ").concat(G(n)));return r>n?1:r<n?-1:t[0]-e[0]}));for(var h=0;h<a.length;h+=1){var l=r(a[h],2);e[h]=l[1]}return e},_functionMaxBy:function(t){for(var e,r,s=t[1],u=t[0],o=this.createKeyFunction(s,[n,i]),a=-1/0,c=0;c<u.length;c+=1)(r=o(u[c]))>a&&(a=r,e=u[c]);return e},_functionMinBy:function(t){for(var e,r,s=t[1],u=t[0],o=this.createKeyFunction(s,[n,i]),a=1/0,c=0;c<u.length;c+=1)(r=o(u[c]))<a&&(a=r,e=u[c]);return e},createKeyFunction:function(t,e){var r=this._interpreter;return function(n){var i=r.visit(t,n);if(e.indexOf(G(i))<0){var s="TypeError: expected one of ".concat(e,", received ").concat(G(i));throw new Error(s)}return i}}},this.tokenize=function(t){return(new ut).tokenize(t)},this.compile=function(t){return(new at).parse(t)},this.search=function(t,e){var r=new at,n=new ht,i=new ct(n);n._interpreter=i;var s=r.parse(e);return i.$form=t,i.search(s,t)},this.strictDeepEqual=Z};function u(t){return u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},u(t)}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function a(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function c(t,e,r){return e&&a(t.prototype,e),r&&a(t,r),t}window.addEventListener("load",(function(){var t=document.getElementById("data"),e=document.getElementById("expression"),r=document.getElementById("result"),n=[],i=window.localStorage.getItem("data");i&&(t.value=i);var a=window.localStorage.getItem("expression");function h(t,e,r){r instanceof Array?r.forEach((function(t,e){h(r,e,t)})):null!==r&&"object"===u(r)?Object.keys(r).forEach((function(t){h(r,t,r[t])})):t[e]=function(t,e){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],s=new(function(){function n(){o(this,n)}return c(n,[{key:"valueOf",value:function(){return e}},{key:"toString",value:function(){return e.toString()}},{key:"toJSON",value:function(){return e}},{key:"equals",value:function(t){return null==t?this.valueOf()===t:this.valueOf()===t.valueOf()}},{key:"value",get:function(){return e}},{key:"name",get:function(){return t}},{key:"readonly",get:function(){return r}},{key:"required",get:function(){return i}},{key:"@value",get:function(){return e}},{key:"@name",get:function(){return t}},{key:"@readonly",get:function(){return r}},{key:"@required",get:function(){return i}}]),n}());return n.push(s),s}(e,t[e])}a&&(e.value=a);var l=function(){function t(e){var r=this;o(this,t),Object.keys(e).forEach((function(t){r[t]=e[t]}))}return c(t,[{key:"fields",get:function(){return n}}]),t}();function f(){window.localStorage.setItem("data",t.value),window.localStorage.setItem("expression",e.value);var n,i=e.value;try{n=JSON.parse(t.value);var o=new l(n);n.$=o,document.getElementById("use-fields").checked&&h(null,null,n)}catch(t){return void(r.value=t.toString())}try{var a=function(t,e){return s.search(t,e)}(n,i),c=null==a?a:a.valueOf();"object"===u(c)?r.value=JSON.stringify(c,null,2):r.value=c}catch(t){r.value=t.toString()}}t.addEventListener("blur",f),e.addEventListener("blur",f),f(),fetch("../antlr/JSONFormula.g4").then((function(t){t.text().then((function(t){document.getElementById("grammar-out").innerHTML=t}))}))})),JSONFormula=t})();
//# sourceMappingURL=tutorial.js.map