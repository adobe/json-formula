var JSONFormula;(()=>{"use strict";var t={};(t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})})(t);const e={substitute:{_func:function(t){var e=t[0].toString(),r=t[1].toString(),n=t[2].toString();if(t.length<=3)return e.replace(new RegExp(r,"g"),n);for(var i=t[3].valueOf(),u=-1,o=0;o<i;o+=1){u+=1;var s=e.slice(u).indexOf(r);if(-1===s)return e;u+=s}return e.slice(0,u)+e.slice(u).replace(r,n)},_signature:[{types:[2]},{types:[2]},{types:[2]},{types:[0],optional:!0}]},value:{_func:function(t){var e=(t[0]||{})[t[1]];return void 0===e?null:e},_signature:[{types:[4,3,7]},{types:[2,0]}]}};function r(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function n(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?r(Object(n),!0).forEach((function(e){i(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function i(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function u(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var r=t&&("undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"]);if(null!=r){var n,i,u=[],o=!0,s=!1;try{for(r=r.call(t);!(o=(n=r.next()).done)&&(u.push(n.value),!e||u.length!==e);o=!0);}catch(t){s=!0,i=t}finally{try{o||null==r.return||r.return()}finally{if(s)throw i}}return u}}(t,e)||o(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function o(t,e){if(t){if("string"==typeof t)return s(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?s(t,e):void 0}}function s(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function a(t){return a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},a(t)}var c=0,l=2,h=3,f=5,p=7,_=8,y=9;const d=new function(){var t,r="UnquotedIdentifier",i="QuotedIdentifier",d="Rbracket",v="Rparen",g="Comma",m="Colon",b="Concatenate",S="Rbrace",k="Number",w="Current",x="Global",O="Field",E="Expref",j="Pipe",P="Or",I="And",T="Add",N="Subtract",A="Multiply",M="Power",L="Divide",F="EQ",R="GT",C="LT",D="GTE",H="LTE",J="NE",B="Flatten",U="Star",$="Filter",q="Dot",z="Lbrace",G="Lbracket",K="Lparen",Q="Literal",V={0:"number",1:"any",2:"string",3:"array",4:"object",5:"boolean",6:"expression",7:"null",8:"Array<number>",9:"Array<string>"},W={};function Z(t,e){return t>="0"&&t<="9"||e&&"-"===t||"."===t}function X(t){return t>="a"&&t<="z"||t>="A"&&t<="Z"||t>="0"&&t<="9"||"_"===t}function Y(t){return null!==t&&"[object Array]"===Object.prototype.toString.call(t)}function tt(t){return null==t?t:Y(t)?t.map((function(t){return tt(t)})):t.valueOf()}function et(t){return null==t?"":t.toString()}function rt(t){return null!==t&&"[object Object]"===Object.prototype.toString.call(t)}function nt(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(null===t)return p;var r=e?t.valueOf():t;switch(Object.prototype.toString.call(r)){case"[object String]":return l;case"[object Number]":return c;case"[object Array]":return h;case"[object Boolean]":return f;case"[object Null]":return p;case"[object Object]":return r.jmespathType===E?6:4;default:return 4}}function it(t){return[nt(t),nt(t,!1)]}function ut(t,e){var r=tt(t),n=tt(e);if(r===n)return!0;if(Object.prototype.toString.call(r)!==Object.prototype.toString.call(n))return!1;if(!0===Y(r)){if(r.length!==n.length)return!1;for(var i=0;i<r.length;i+=1)if(!1===ut(r[i],n[i]))return!1;return!0}if(!0===rt(r)){var u={};for(var o in r)if(hasOwnProperty.call(r,o)){if(!1===ut(r[o],n[o]))return!1;u[o]=!0}for(var s in n)if(hasOwnProperty.call(n,s)&&!0!==u[s])return!1;return!0}return!1}function ot(t){if(null===t)return!0;var e=tt(t);if(""===e||!1===e||null===e)return!0;if(Y(e)&&0===e.length)return!0;if(rt(e)){for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r))return!1;return!0}return!e}function st(t){var e=tt(t);if(null===e)return 0;if(e instanceof Array)return 0;if("number"==typeof e)return e;if("string"==typeof e){var r=parseFloat(e);return Number.isNaN(r)?0:r}if("boolean"==typeof e)return e?1:0;throw new Error("need to coerce number")}function at(t,e,r){if(Y(t)&&Y(e)){var n,i=Math.min(t.length,e.length),o=[];for(n=0;n<i;n+=1)if(Y(t[n])||Y(e[n]))o.push(at(t[n],e[n],r));else if("*"===r)o.push(t[n]*e[n]);else{if("&"!==r)throw new Error("unimplemented");o.push(t[n]+e[n])}for(n=i;n<Math.max(t.length,e.length);n+=1)"&"===r?o.push(""):"*"===r&&o.push(0);return o}if(Y(t)||Y(e)){var s=u(Y(t)?[t,e]:[e,t],2),a=s[0],c=s[1];if("*"===r)return a.map((function(t){return st(t)*st(c)}));if("&"===r)return a.map((function(t){return t+c}))}if("*"===r)return st(t)*st(e);if("&"===r)return t+e;throw new Error("unimplemented array operator: ".concat(r))}function ct(t,e,r,n){var i=t[0];if(-1!==e.findIndex((function(t){return 1===t||i===t})))return r;if(4===i)throw new Error("TypeError: ".concat(n," expected argument to be type ").concat(V[e[0]]," but received type ").concat(V[i]," instead."));var o=-1;if(i===h&&e.includes(y)&&e.includes(_)&&(o=r.length>0&&"string"==typeof r[0]?y:_),-1===o&&[y,_,h].includes(i)&&(o=e.find((function(t){return[y,_,h].includes(t)}))),-1===o&&(o=u(e,1)[0]),o===y||o===_||o===h){if(o===h)return i===_||i===y?r:null===r?[]:[r];var s=o===_?c:l;if(i===h){for(var a=r.slice(),d=0;d<a.length;d+=1){var v=it(a[d]);a[d]=ct(v,[s],a[d],n)}return a}if([c,l,p,f].includes(s))return[ct(t,[s],r,n)]}else{if(o===c)return i===l?st(r):i===f&&r?1:0;if(o===l)return i===p||4===i?"":r.toString();if(o===f)return!!r;if(4===o&&4===t[1])return r}throw new Error("unhandled argument")}t="function"==typeof String.prototype.trimLeft?function(t){return t.trimLeft()}:function(t){return t.match(/^\s*(.*)/)[1]};var lt={".":q,",":g,":":m,"{":z,"}":S,"]":d,"(":K,")":v,"@":w},ht={"<":!0,">":!0,"=":!0,"!":!0},ft={" ":!0,"\t":!0,"\n":!0};function pt(t,e){var r=t[e];return"$"===r?t.length>e&&X(t[e+1]):r>="a"&&r<="z"||r>="A"&&r<="Z"||"_"===r}function _t(t,e,r){if(null!==t&&t===q)return!1;if("$"!==e[r])return!1;for(var n=r+1;n<e.length&&X(e[n]);)n+=1;var i=e.slice(r,n);return!!W[i]}function yt(){}yt.prototype={tokenize:function(t){var e,n,u,o=[];for(this._current=0;this._current<t.length;){var s=o.length?o.slice(-1)[0].type:null;if(_t(s,t,this._current))o.push(this._consumeGlobal(t));else if(pt(t,this._current))e=this._current,n=this._consumeUnquotedIdentifier(t),o.push({type:r,value:n,start:e});else if(void 0!==lt[t[this._current]])o.push({type:lt[t[this._current]],value:t[this._current],start:this._current}),this._current+=1;else if("-"===t[this._current]&&s!==k&&s!==v||Z(t[this._current],!1))u=this._consumeNumber(t),o.push(u);else if("["===t[this._current])u=this._consumeLBracket(t),o.push(u);else if('"'===t[this._current])e=this._current,n=this._consumeQuotedIdentifier(t),o.push({type:i,value:n,start:e});else if("'"===t[this._current])e=this._current,n=this._consumeRawStringLiteral(t),o.push({type:Q,value:n,start:e});else if("`"===t[this._current]){e=this._current;var a=this._consumeLiteral(t);o.push({type:Q,value:a,start:e})}else if(void 0!==ht[t[this._current]])o.push(this._consumeOperator(t));else if(void 0!==ft[t[this._current]])this._current+=1;else if("&"===t[this._current])e=this._current,this._current+=1,"&"===t[this._current]?(this._current+=1,o.push({type:I,value:"&&",start:e})):s===g||s===K?o.push({type:E,value:"&",start:e}):o.push({type:b,value:"&",start:e});else if("+"===t[this._current])e=this._current,this._current+=1,o.push({type:T,value:"+",start:e});else if("-"===t[this._current])e=this._current,this._current+=1,o.push({type:N,value:"-",start:e});else if("*"===t[this._current]){e=this._current,this._current+=1;var c=o.length&&o.slice(-1)[0].type;0===o.length||[G,q,j,I,P,g,m].includes(c)?o.push({type:U,value:"*",start:e}):o.push({type:A,value:"*",start:e})}else if("/"===t[this._current])e=this._current,this._current+=1,o.push({type:L,value:"/",start:e});else if("^"===t[this._current])e=this._current,this._current+=1,o.push({type:M,value:"^",start:e});else{if("|"!==t[this._current]){var l=new Error("Unknown character:".concat(t[this._current]));throw l.name="LexerError",l}e=this._current,this._current+=1,"|"===t[this._current]?(this._current+=1,o.push({type:P,value:"||",start:e})):o.push({type:j,value:"|",start:e})}}return o},_consumeUnquotedIdentifier:function(t){var e=this._current;for(this._current+=1;this._current<t.length&&X(t[this._current]);)this._current+=1;return t.slice(e,this._current)},_consumeQuotedIdentifier:function(t){var e=this._current;this._current+=1;for(var r=t.length;'"'!==t[this._current]&&this._current<r;){var n=this._current;"\\"!==t[n]||"\\"!==t[n+1]&&'"'!==t[n+1]?n+=1:n+=2,this._current=n}return this._current+=1,JSON.parse(t.slice(e,this._current))},_consumeRawStringLiteral:function(t){var e=this._current;this._current+=1;for(var r=t.length;"'"!==t[this._current]&&this._current<r;){var n=this._current;"\\"!==t[n]||"\\"!==t[n+1]&&"'"!==t[n+1]?n+=1:n+=2,this._current=n}return this._current+=1,t.slice(e+1,this._current-1).replace("\\'","'")},_consumeNumber:function(t){var e=this._current;this._current+=1;for(var r=t.length;Z(t[this._current],!1)&&this._current<r;)this._current+=1;var n,i=t.slice(e,this._current);return n=i.includes(".")?parseFloat(i):parseInt(i,10),{type:k,value:n,start:e}},_consumeLBracket:function(t){var e=this._current;return this._current+=1,"?"===t[this._current]?(this._current+=1,{type:$,value:"[?",start:e}):"]"===t[this._current]?(this._current+=1,{type:B,value:"[]",start:e}):{type:G,value:"[",start:e}},_consumeGlobal:function(t){var e=this._current;for(this._current+=1;this._current<t.length&&X(t[this._current]);)this._current+=1;var r=t.slice(e,this._current);return{type:x,value:W[r],start:e}},_consumeOperator:function(t){var e=this._current,r=t[e];return this._current+=1,"!"===r?"="===t[this._current]?(this._current+=1,{type:J,value:"!=",start:e}):{type:"Not",value:"!",start:e}:"<"===r?"="===t[this._current]?(this._current+=1,{type:H,value:"<=",start:e}):{type:C,value:"<",start:e}:">"===r?"="===t[this._current]?(this._current+=1,{type:D,value:">=",start:e}):{type:R,value:">",start:e}:"="===t[this._current]?(this._current+=1,{type:F,value:"==",start:e}):{type:F,value:"=",start:e}},_consumeLiteral:function(e){this._current+=1;for(var r,n=this._current,i=e.length;"`"!==e[this._current]&&this._current<i;){var u=this._current;"\\"!==e[u]||"\\"!==e[u+1]&&"`"!==e[u+1]?u+=1:u+=2,this._current=u}var o=t(e.slice(n,this._current));return o=o.replace("\\`","`"),r=this._looksLikeJSON(o)?JSON.parse(o):JSON.parse('"'.concat(o,'"')),this._current+=1,r},_looksLikeJSON:function(t){if(""===t)return!1;if('[{"'.indexOf(t[0])>=0)return!0;if(["true","false","null"].indexOf(t)>=0)return!0;if(!("-0123456789".indexOf(t[0])>=0))return!1;try{return JSON.parse(t),!0}catch(t){return!1}}};var dt={};function vt(){}function gt(t){this.runtime=t}function mt(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.functionTable=n(n({abs:{_func:this._functionAbs,_signature:[{types:[c]}]},avg:{_func:this._functionAvg,_signature:[{types:[_]}]},ceil:{_func:this._functionCeil,_signature:[{types:[c]}]},contains:{_func:this._functionContains,_signature:[{types:[l,h]},{types:[1]}]},ends_with:{_func:this._functionEndsWith,_signature:[{types:[l]},{types:[l]}]},floor:{_func:this._functionFloor,_signature:[{types:[c]}]},length:{_func:this._functionLength,_signature:[{types:[l,h,4]}]},map:{_func:this._functionMap,_signature:[{types:[6]},{types:[h]}]},max:{_func:this._functionMax,_signature:[{types:[h,_,y]}]},merge:{_func:this._functionMerge,_signature:[{types:[4],variadic:!0}]},max_by:{_func:this._functionMaxBy,_signature:[{types:[h]},{types:[6]}]},sum:{_func:this._functionSum,_signature:[{types:[_]}]},starts_with:{_func:this._functionStartsWith,_signature:[{types:[l]},{types:[l]}]},min:{_func:this._functionMin,_signature:[{types:[h,_,y]}]},min_by:{_func:this._functionMinBy,_signature:[{types:[h]},{types:[6]}]},type:{_func:this._functionType,_signature:[{types:[1]}]},keys:{_func:this._functionKeys,_signature:[{types:[1]}]},values:{_func:this._functionValues,_signature:[{types:[1]}]},sort:{_func:this._functionSort,_signature:[{types:[h,y,_]}]},sort_by:{_func:this._functionSortBy,_signature:[{types:[h]},{types:[6]}]},join:{_func:this._functionJoin,_signature:[{types:[l]},{types:[y]}]},reverse:{_func:this._functionReverse,_signature:[{types:[l,h]}]},to_array:{_func:this._functionToArray,_signature:[{types:[1]}]},to_string:{_func:this._functionToString,_signature:[{types:[1]}]},to_number:{_func:this._functionToNumber,_signature:[{types:[1]}]},not_null:{_func:this._functionNotNull,_signature:[{types:[1],variadic:!0}]},and:{_func:this._functionAnd,_signature:[{types:[1]},{types:[1]}]},or:{_func:this._functionOr,_signature:[{types:[1]},{types:[1]}]},not:{_func:this._functionNot,_signature:[{types:[1]}]},true:{_func:function(){return!0},_signature:[]},false:{_func:function(){return!1},_signature:[]},if:{_func:this._functionIf,_signature:[{types:[1]},{types:[1]},{types:[1]}]}},e),t)}dt.EOF=0,dt.UnquotedIdentifier=0,dt.QuotedIdentifier=0,dt.Rbracket=0,dt.Rparen=0,dt[g]=0,dt.Rbrace=0,dt.Number=0,dt.Current=0,dt.Global=0,dt.Field=0,dt.Expref=0,dt[j]=1,dt[P]=2,dt[I]=3,dt[T]=6,dt[N]=6,dt[b]=7,dt[A]=7,dt[L]=7,dt[M]=7,dt[F]=5,dt[R]=5,dt[C]=5,dt[D]=5,dt[H]=5,dt[J]=5,dt.Flatten=9,dt.Star=20,dt.Filter=21,dt[q]=40,dt.Not=45,dt.Lbrace=50,dt[G]=55,dt.Lparen=60,vt.prototype={parse:function(t){this._loadTokens(t),this.index=0;var e=this.expression(0);if("EOF"!==this._lookahead(0)){var r=this._lookaheadToken(0),n=new Error("Unexpected token type: ".concat(r.type,", value: ").concat(r.value));throw n.name="ParserError",n}return e},_loadTokens:function(t){var e=(new yt).tokenize(t);e.push({type:"EOF",value:"",start:t.length}),this.tokens=e},expression:function(t){var e=this._lookaheadToken(0);this._advance();for(var r=this.nud(e),n=this._lookahead(0);t<dt[n];)this._advance(),r=this.led(n,r),n=this._lookahead(0);return r},_lookahead:function(t){return this.tokens[this.index+t].type},_lookaheadToken:function(t){return this.tokens[this.index+t]},_advance:function(){this.index+=1},nud:function(t){var e,n,u,o,s;switch(t.type){case Q:return{type:"Literal",value:t.value};case k:return{type:"Number",value:t.value};case r:return{type:"Field",name:t.value};case i:if(u={type:"Field",name:t.value},this._lookahead(0)===K)throw new Error("Quoted identifier not allowed for function names.");return u;case"Not":return{type:"NotExpression",children:[e=this.expression(dt.Not)]};case U:return{type:"ValueProjection",children:[{type:"Identity"},e=this._lookahead(0)===d?{type:"Identity"}:this._parseProjectionRHS(dt.Star)]};case $:return this.led(t.type,{type:"Identity"});case z:return this._parseMultiselectHash();case B:return{type:"Projection",children:[{type:B,children:[{type:"Identity"}]},e=this._parseProjectionRHS(dt.Flatten)]};case G:return this._lookahead(1)===g||(s=this._lookahead(1),[b,P,I,T,N,A,M,L,F,R,C,D,H,J].includes(s))?this._parseMultiselectList():this._lookahead(0)===k||this._lookahead(0)===m?(e=this._parseIndexExpression(),this._projectIfSlice({type:"Identity"},e)):this._lookahead(0)===U&&this._lookahead(1)===d?(this._advance(),this._advance(),{type:"Projection",children:[{type:"Identity"},e=this._parseProjectionRHS(dt.Star)]}):this._parseMultiselectList();case w:return{type:w};case x:return{type:x,value:t.value};case O:return{type:O};case E:return{type:"ExpressionReference",children:[n=this.expression(dt.Expref)]};case K:for(o=[];this._lookahead(0)!==v;)this._lookahead(0)===w?(n={type:w},this._advance()):n=this.expression(0),o.push(n);return this._match(v),o[0];default:this._errorToken(t)}},led:function(t,e){var r,n,i,u,o,s,a;switch(t){case b:return{type:"ConcatenateExpression",children:[e,n=this.expression(dt.Concatenate)]};case q:return s=dt.Dot,this._lookahead(0)!==U?{type:"Subexpression",children:[e,n=this._parseDotRHS(s)]}:(this._advance(),{type:"ValueProjection",children:[e,n=this._parseProjectionRHS(s)]});case j:return n=this.expression(dt.Pipe),{type:j,children:[e,n]};case P:return{type:"OrExpression",children:[e,n=this.expression(dt.Or)]};case I:return{type:"AndExpression",children:[e,n=this.expression(dt.And)]};case T:return{type:"AddExpression",children:[e,n=this.expression(dt.Add)]};case N:return{type:"SubtractExpression",children:[e,n=this.expression(dt.Subtract)]};case A:return{type:"MultiplyExpression",children:[e,n=this.expression(dt.Multiply)]};case L:return{type:"DivideExpression",children:[e,n=this.expression(dt.Divide)]};case M:return{type:"PowerExpression",children:[e,n=this.expression(dt.Power)]};case K:for(i=e.name,u=[];this._lookahead(0)!==v;)this._lookahead(0)===w?(o={type:w},this._advance()):o=this.expression(0),this._lookahead(0)===g&&this._match(g),u.push(o);return this._match(v),{type:"Function",name:i,children:u};case $:return r=this.expression(0),this._match(d),{type:"FilterProjection",children:[e,n=this._lookahead(0)===B?{type:"Identity"}:this._parseProjectionRHS(dt.Filter),r]};case B:return{type:"Projection",children:[{type:B,children:[e]},this._parseProjectionRHS(dt.Flatten)]};case F:case J:case R:case D:case C:case H:return this._parseComparator(e,t);case G:return(a=this._lookaheadToken(0)).type===k||a.type===m?(n=this._parseIndexExpression(),this._projectIfSlice(e,n)):(this._match(U),this._match(d),{type:"Projection",children:[e,n=this._parseProjectionRHS(dt.Star)]});default:this._errorToken(this._lookaheadToken(0))}},_match:function(t){if(this._lookahead(0)!==t){var e=this._lookaheadToken(0),r=new Error("Expected ".concat(t,", got: ").concat(e.type));throw r.name="ParserError",r}this._advance()},_errorToken:function(t){var e=new Error("Invalid token (".concat(t.type,'): "').concat(t.value,'"'));throw e.name="ParserError",e},_parseIndexExpression:function(){if(this._lookahead(0)===m||this._lookahead(1)===m)return this._parseSliceExpression();var t={type:"Index",value:this._lookaheadToken(0).value};return this._advance(),this._match(d),t},_projectIfSlice:function(t,e){var r={type:"IndexExpression",children:[t,e]};return"Slice"===e.type?{type:"Projection",children:[r,this._parseProjectionRHS(dt.Star)]}:r},_parseSliceExpression:function(){for(var t=[null,null,null],e=0,r=this._lookahead(0);r!==d&&e<3;){if(r===m)e+=1,this._advance();else{if(r!==k){var n=this._lookahead(0),i=new Error("Syntax error, unexpected token: ".concat(n.value,"(").concat(n.type,")"));throw i.name="Parsererror",i}t[e]=this._lookaheadToken(0).value,this._advance()}r=this._lookahead(0)}return this._match(d),{type:"Slice",children:t}},_parseComparator:function(t,e){return{type:"Comparator",name:e,children:[t,this.expression(dt[e])]}},_parseDotRHS:function(t){var e=this._lookahead(0);return[r,i,U].indexOf(e)>=0?this.expression(t):e===G?(this._match(G),this._parseMultiselectList()):e===z?(this._match(z),this._parseMultiselectHash()):void 0},_parseProjectionRHS:function(t){var e;if(dt[this._lookahead(0)]<10)e={type:"Identity"};else if(this._lookahead(0)===G)e=this.expression(t);else if(this._lookahead(0)===$)e=this.expression(t);else{if(this._lookahead(0)!==q){var r=this._lookaheadToken(0),n=new Error("Sytanx error, unexpected token: ".concat(r.value,"(").concat(r.type,")"));throw n.name="ParserError",n}this._match(q),e=this._parseDotRHS(t)}return e},_parseMultiselectList:function(){for(var t=[];this._lookahead(0)!==d;){var e=this.expression(0);if(t.push(e),this._lookahead(0)===g&&(this._match(g),this._lookahead(0)===d))throw new Error("Unexpected token Rbracket")}return this._match(d),{type:"MultiSelectList",children:t}},_parseMultiselectHash:function(){for(var t,e,n,u=[],o=[r,i];;){if(t=this._lookaheadToken(0),o.indexOf(t.type)<0)throw new Error("Expecting an identifier token, got: ".concat(t.type));if(e=t.value,this._advance(),this._match(m),n={type:"KeyValuePair",name:e,value:this.expression(0)},u.push(n),this._lookahead(0)===g)this._match(g);else if(this._lookahead(0)===S){this._match(S);break}}return{type:"MultiSelectHash",children:u}}},gt.prototype={search:function(t,e){return this.visit(t,e)},visit:function(t,e){var r,n,i,a,c,h,f,p,_,d,v,g,m,b,S,k,O,P,I,T,N,A,M,L;switch(t.type){case"Field":return null!==e&&rt(e)?void 0===(h=e[t.name])?null:h:null;case"Subexpression":for(i=this.visit(t.children[0],e),_=1;_<t.children.length;_+=1)if(null===(i=this.visit(t.children[1],i)))return null;return i;case"IndexExpression":case j:return f=this.visit(t.children[0],e),this.visit(t.children[1],f);case"Index":return Y(e)?((g=t.value)<0&&(g=e.length+g),void 0===(i=e[g])&&(i=null),i):null;case"Slice":if(!Y(e))return null;m=t.children.slice(0);var U=u(this.computeSliceParams(e.length,m),3);if(b=U[0],S=U[1],i=[],(k=U[2])>0)for(_=b;_<S;_+=k)i.push(e[_]);else for(_=b;_>S;_+=k)i.push(e[_]);return i;case"Projection":if(!Y(v=this.visit(t.children[0],e)))return null;for(p=[],_=0;_<v.length;_+=1)null!==(n=this.visit(t.children[1],v[_]))&&p.push(n);return p;case"ValueProjection":if(!rt(tt(v=this.visit(t.children[0],e))))return null;for(p=[],O=function(t){for(var e=Object.keys(t),r=[],n=0;n<e.length;n+=1)r.push(t[e[n]]);return r}(v),_=0;_<O.length;_+=1)null!==(n=this.visit(t.children[1],O[_]))&&p.push(n);return p;case"FilterProjection":if(!Y(v=this.visit(t.children[0],e)))return null;for(P=[],I=[],_=0;_<v.length;_+=1)ot(r=this.visit(t.children[2],v[_]))||P.push(v[_]);for(var $=0;$<P.length;$+=1)null!==(n=this.visit(t.children[1],P[$]))&&I.push(n);return I;case"Comparator":switch(a=this.visit(t.children[0],e),c=this.visit(t.children[1],e),t.name){case F:i=ut(a,c);break;case J:i=!ut(a,c);break;case R:i=a>c;break;case D:i=a>=c;break;case C:i=a<c;break;case H:i=a<=c;break;default:throw new Error("Unknown comparator: ".concat(t.name))}return i;case B:if(!Y(T=this.visit(t.children[0],e)))return null;for(N=[],_=0;_<T.length;_+=1){var q;Y(n=T[_])?(q=N).push.apply(q,function(t){if(Array.isArray(t))return s(t)}(L=n)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(L)||o(L)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()):N.push(n)}return N;case"Identity":case w:return e;case"MultiSelectList":if(null===e)return null;for(p=[],_=0;_<t.children.length;_+=1)p.push(this.visit(t.children[_],e));return p;case"MultiSelectHash":if(null===e)return null;for(p={},_=0;_<t.children.length;_+=1)p[(d=t.children[_]).name]=this.visit(d.value,e);return p;case"OrExpression":return ot(r=this.visit(t.children[0],e))&&(r=this.visit(t.children[1],e)),r;case"AndExpression":return!0===ot(a=this.visit(t.children[0],e))?a:this.visit(t.children[1],e);case"AddExpression":return st(a=this.visit(t.children[0],e))+st(this.visit(t.children[1],e));case"ConcatenateExpression":return a=this.visit(t.children[0],e),c=this.visit(t.children[1],e),at(a=ct(it(a),[l,y],a,"concatenate"),c=ct(it(c),[l,y],c,"concatenate"),"&");case"SubtractExpression":return(a=this.visit(t.children[0],e))-this.visit(t.children[1],e);case"MultiplyExpression":return at(a=this.visit(t.children[0],e),c=this.visit(t.children[1],e),"*");case"DivideExpression":return(a=this.visit(t.children[0],e))/this.visit(t.children[1],e);case"PowerExpression":return a=this.visit(t.children[0],e),Math.pow(a,this.visit(t.children[1],e));case"NotExpression":return ot(a=this.visit(t.children[0],e));case"Literal":case"Number":case x:return t.value;case"Function":if("if"===t.name)return this.runtime.callFunction(t.name,t.children,e);for(A=[],_=0;_<t.children.length;_+=1)A.push(this.visit(t.children[_],e));return this.runtime.callFunction(t.name,A);case"ExpressionReference":return(M=u(t.children,1)[0]).jmespathType=E,M;default:throw new Error("Unknown node type: ".concat(t.type))}},computeSliceParams:function(t,e){var r=e[0],n=e[1],i=e[2],u=[null,null,null];if(null===i)i=1;else if(0===i){var o=new Error("Invalid slice, step cannot be 0");throw o.name="RuntimeError",o}var s=i<0;return r=null===r?s?t-1:0:this.capSliceRange(t,r,i),n=null===n?s?-1:t:this.capSliceRange(t,n,i),u[0]=r,u[1]=n,u[2]=i,u},capSliceRange:function(t,e,r){return e<0?(e+=t)<0&&(e=r<0?-1:0):e>=t&&(e=r<0?t-1:t),e}},mt.prototype={callFunction:function(t,e,r){var n=this.functionTable[t];if(void 0===n)throw new Error("Unknown function: ".concat(t,"()"));return this._validateArgs(t,e,n._signature),n._func.call(this,e,r)},_validateArgs:function(t,e,r){if(0!==r.length){var n,i,u;if(r[r.length-1].variadic){if(e.length<r.length)throw n=1===r.length?" argument":" arguments",new Error("ArgumentError: ".concat(t,"() ")+"takes at least".concat(r.length).concat(n," but received ").concat(e.length))}else if(e.length!==r.length&&!r[r.length-1].optional)throw n=1===r.length?" argument":" arguments",new Error("ArgumentError: ".concat(t,"() ")+"takes ".concat(r.length).concat(n," but received ").concat(e.length));for(var o=Math.min(r.length,e.length),s=0;s<o;s+=1)i=r[s].types,c=e[s],l=i,h=void 0,null!==(h=c)&&!Array.isArray(h)&&"object"===a(h)&&"Object"!==h.constructor.name&&l.includes(10)||(u=it(e[s]),e[s]=ct(u,i,e[s],t))}var c,l,h},_functionStartsWith:function(t){return 0===tt(t[0]).lastIndexOf(tt(t[1]))},_functionEndsWith:function(t){var e=tt(t[0]),r=tt(t[1]);return-1!==e.indexOf(r,e.length-r.length)},_functionReverse:function(t){var e=tt(t[0]);if(nt(e)===l){for(var r="",n=e.length-1;n>=0;n-=1)r+=e[n];return r}var i=t[0].slice(0);return i.reverse(),i},_functionAbs:function(t){return Math.abs(t[0])},_functionCeil:function(t){return Math.ceil(t[0])},_functionAvg:function(t){for(var e=0,r=t[0],n=0;n<r.length;n+=1)e+=r[n];return e/r.length},_functionContains:function(t){return tt(t[0]).indexOf(tt(t[1]))>=0},_functionFloor:function(t){return Math.floor(t[0])},_functionLength:function(t){var e=tt(t[0]);return rt(e)?Object.keys(e).length:Y(e)?e.length:et(e).length},_functionMap:function(t){for(var e=[],r=this._interpreter,n=t[0],i=t[1],u=0;u<i.length;u+=1)e.push(r.visit(n,i[u]));return e},_functionMerge:function(t){for(var e={},r=function(r){var n=t[r];Object.keys(n).forEach((function(t){e[t]=n[t]}))},n=0;n<t.length;n+=1)r(n);return e},_functionMax:function(t){return t[0].length>0?nt(t[0][0])===c?t[0].reduce((function(t,e){return st(t)>=st(e)?t:e}),t[0][0]):t[0].reduce((function(t,e){return et(e).localeCompare(et(t))<0?t:e}),t[0][0]):null},_functionMin:function(t){if(t[0].length>0){if(nt(t[0][0])===c)return t[0].reduce((function(t,e){return st(t)<=st(e)?t:e}),t[0][0]);for(var e=t[0],r=e[0],n=1;n<e.length;n+=1)et(e[n]).localeCompare(et(r))<0&&(r=e[n]);return r}return null},_functionSum:function(t){for(var e=0,r=t[0],n=0;n<r.length;n+=1)e+=1*r[n];return e},_functionAnd:function(t){return!!tt(t[0])&&!!tt(t[1])},_functionIf:function(t,e){var r=this._interpreter,n=t[0],i=t[1],u=t[2];return tt(r.visit(n,e))?r.visit(i,e):r.visit(u,e)},_functionOr:function(t){return!!tt(t[0])||!!tt(t[1])},_functionNot:function(t){return!tt(t[0])},_functionType:function(t){switch(nt(t[0])){case c:return"number";case l:return"string";case h:return"array";case 4:return"object";case f:return"boolean";case 6:return"expref";case p:return"null"}},_functionKeys:function(t){return Object.keys(t[0])},_functionValues:function(t){return Object.values(t[0])},_functionJoin:function(t){var e=t[0];return t[1].join(e)},_functionToArray:function(t){return nt(t[0])===h?t[0]:[t[0]]},_functionToString:function(t){return nt(t[0])===l?t[0]:JSON.stringify(t[0])},_functionToNumber:function(t){var e=nt(t[0]);return e===c?t[0]:e===l?st(t[0]):null},_functionNotNull:function(t){for(var e=0;e<t.length;e+=1)if(nt(t[e])!==p)return t[e];return null},_functionSort:function(t){var e=t[0].slice(0);if(e.length>0){var r=nt(t[0][0])===c?st:et;e.sort((function(t,e){var n=r(t),i=r(e);return n<i?-1:n>i?1:0}))}return e},_functionSortBy:function(t){var e=t[0].slice(0);if(0===e.length)return e;var r=this._interpreter,n=t[1],i=nt(r.visit(n,e[0]));if([c,l].indexOf(i)<0)throw new Error("TypeError");for(var o=[],s=0;s<e.length;s+=1)o.push([s,e[s]]);o.sort((function(t,e){var u=r.visit(n,t[1]),o=r.visit(n,e[1]);if(nt(u)!==i)throw new Error("TypeError: expected ".concat(i,", received ").concat(nt(u)));if(nt(o)!==i)throw new Error("TypeError: expected ".concat(i,", received ").concat(nt(o)));return u>o?1:u<o?-1:t[0]-e[0]}));for(var a=0;a<o.length;a+=1){var h=u(o[a],2);e[a]=h[1]}return e},_functionMaxBy:function(t){for(var e,r,n=t[1],i=t[0],u=this.createKeyFunction(n,[c,l]),o=-1/0,s=0;s<i.length;s+=1)(r=u(i[s]))>o&&(o=r,e=i[s]);return e},_functionMinBy:function(t){for(var e,r,n=t[1],i=t[0],u=this.createKeyFunction(n,[c,l]),o=1/0,s=0;s<i.length;s+=1)(r=u(i[s]))<o&&(o=r,e=i[s]);return e},createKeyFunction:function(t,e){var r=this._interpreter;return function(n){var i=r.visit(t,n);if(e.indexOf(nt(i))<0){var u="TypeError: expected one of ".concat(e,", received ").concat(nt(i));throw new Error(u)}return i}}},this.tokenize=function(t){return(new yt).tokenize(t)},this.compile=function(t){return(new vt).parse(t)},this.search=function(t,e,r,n){var i=new vt,u=new mt(n),o=new gt(u);u._interpreter=o,e&&(W=e);var s=i.parse(r);return o.search(s,t)},this.strictDeepEqual=ut};function v(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function g(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?v(Object(r),!0).forEach((function(e){m(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):v(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function m(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function b(t){return b="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},b(t)}function S(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function k(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function w(t,e,r){return e&&k(t.prototype,e),r&&k(t,r),t}var x,O=[];function E(t,e,r){r instanceof Array?(t[e]=[],r.forEach((function(r,n){E(t[e],n,r)}))):null!==r&&"object"===b(r)?(t[e]={},Object.keys(r).forEach((function(n){E(t[e],n,r[n])}))):t[e]=function(t,e){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],i=new(function(){function i(){S(this,i)}return w(i,[{key:"valueOf",value:function(){return e}},{key:"toString",value:function(){return e.toString()}},{key:"toJSON",value:function(){return e}},{key:"$value",get:function(){return e}},{key:"$name",get:function(){return t}},{key:"$readonly",get:function(){return r}},{key:"$required",get:function(){return n}}]),i}());return O.push(i),i}(e,r)}O.length=0;var j=function(){function t(e,r){var n=this;S(this,t),x=e,E(e,"data",r),Object.keys(e.data).forEach((function(t){n[t]=e.data[t]}))}return w(t,[{key:"valueOf",value:function(){return x.data}},{key:"stringify",value:function(){return JSON.stringify(x.data,null,2)}},{key:"$fields",get:function(){return O}}]),t}();function P(t){return P="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},P(t)}window.addEventListener("load",(function(){var t=document.getElementById("data"),e=document.getElementById("expression"),r=document.getElementById("result"),n=window.localStorage.getItem("data");n&&(t.value=n);var i=window.localStorage.getItem("expression");function u(){window.localStorage.setItem("data",t.value),window.localStorage.setItem("expression",e.value);var n,i=e.value,u=document.getElementById("use-fields").checked,o=null,s={};try{n=JSON.parse(t.value),u&&(o=new j(s,n))}catch(t){return void(r.value=t.toString())}try{var a=function(t,e,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return d.search(t,e,r,g({},n))}(u?s.data:n,{$form:o,$:{}},i,!0),c=null==a?a:a.valueOf();"object"===P(c)?r.value=JSON.stringify(c,null,2):r.value=c}catch(t){r.value=t.toString()}}i&&(e.value=i),t.addEventListener("blur",u),e.addEventListener("blur",u),u(),fetch("../antlr/JSONFormula.g4").then((function(t){t.text().then((function(t){document.getElementById("grammar-out").innerHTML=t}))}))})),JSONFormula=t})();
//# sourceMappingURL=tutorial.js.map