var JSONFormula;(()=>{"use strict";var t={};function e(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}(t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})})(t);const r=new function(){function t(t){return null!==t&&"[object Array]"===Object.prototype.toString.call(t)}function r(t){return null!==t&&"[object Object]"===Object.prototype.toString.call(t)}function n(e,i){if(e===i)return!0;if(r(e)&&"function"==typeof e.equals)return e.equals(i);if(r(i)&&"function"==typeof i.equals)return i.equals(e);if(Object.prototype.toString.call(e)!==Object.prototype.toString.call(i))return!1;if(!0===t(e)){if(e.length!==i.length)return!1;for(var s=0;s<e.length;s++)if(!1===n(e[s],i[s]))return!1;return!0}if(!0===r(e)){var u={};for(var a in e)if(hasOwnProperty.call(e,a)){if(!1===n(e[a],i[a]))return!1;u[a]=!0}for(var o in i)if(hasOwnProperty.call(i,o)&&!0!==u[o])return!1;return!0}return!1}function i(e){if(""===e||!1===e||null===e)return!0;if(t(e)&&0===e.length)return!0;if(r(e)){for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n))return!1;return!0}return!e}function s(t){if(null===t)return 0;var e=t.valueOf();if(null===e)return 0;if(e instanceof Array)return 0;if("number"==typeof e)return e;if("string"==typeof e){var r=parseFloat(e);return isNaN(r)?0:r}if("boolean"==typeof e)return e?1:0;throw"need to coerce number"}function u(r,n,i){if(t(r)&&t(n)){var a,o=Math.min(r.length,n.length),c=[];for(a=0;a<o;a+=1)if(t(r[a])||t(n[a]))c.push(u(r[a],n[a],i));else if("*"===i)c.push(r[a]*n[a]);else{if("&"!==i)throw"unimplemented";c.push(r[a]+n[a])}for(a=o;a<Math.max(r.length,n.length);a+=1)"&"===i?c.push(""):"*"===i&&c.push(0);return c}if(t(r)||t(n)){var h=function(t,r){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var r=t&&("undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"]);if(null!=r){var n,i,s=[],u=!0,a=!1;try{for(r=r.call(t);!(u=(n=r.next()).done)&&(s.push(n.value),!e||s.length!==e);u=!0);}catch(t){a=!0,i=t}finally{try{u||null==r.return||r.return()}finally{if(a)throw i}}return s}}(t,r)||function(t,r){if(t){if("string"==typeof t)return e(t,r);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?e(t,r):void 0}}(t,r)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}(t(r)?[r,n]:[n,r],2),l=h[0],f=h[1];if("*"===i)return l.map((function(t){return s(t)*s(f)}));if("&"===i)return l.map((function(t){return t+f}))}return"*"===i?s(r)*s(n):"&"===i?r+n:void 0}function a(t,e,r){if(-1!==e.findIndex((function(e){return e===l||t===e})))return r;var n=-1;if(t===p&&e.includes(m)&&e.includes(g)&&(n=r.length>0&&"string"==typeof r[0]?m:g),-1===n&&[m,g,p].includes(t)&&(n=e.find((function(t){return[m,g,p].includes(t)}))),-1===n&&(n=e[0]),n===m||n===g||n===p){if(n===p)return t===g||t===m?r:null===r?[]:[r];var i=n===g?h:f;if(t===p){for(var u=r.slice(),c=0;c<u.length;c++){var v=o(u[c]);u[c]=a(v,[i],u[c])}return u}if([h,f,y,d].includes(i))return[a(t,[i],r)]}else{if(n===h)return t===f?s(r):t===d&&r?1:0;if(n===f)return t===y||t===_?"":r.toString();if(n===d)return!!r}throw new Error("unhandled argument")}function o(t){if(null===t)return y;var e=t.valueOf();switch(Object.prototype.toString.call(e)){case"[object String]":return f;case"[object Number]":return h;case"[object Array]":return p;case"[object Boolean]":return d;case"[object Null]":return y;case"[object Object]":return e.jmespathType===N?v:_}}var c;c="function"==typeof String.prototype.trimLeft?function(t){return t.trimLeft()}:function(t){return t.match(/^\s*(.*)/)[1]};var h=0,l=1,f=2,p=3,_=4,d=5,v=6,y=7,g=8,m=9,k="UnquotedIdentifier",b="QuotedIdentifier",x="Rbracket",S="Rparen",w="Comma",E="Colon",O="Concatenate",j="Rbrace",I="Number",M="Current",P="Form",T="Field",N="Expref",F="Pipe",L="Or",A="And",R="Add",C="Subtract",H="Multiply",J="Power",B="Divide",q="EQ",U="GT",D="LT",$="GTE",z="LTE",K="NE",Q="Flatten",V="Star",W="Filter",G="Dot",Z="Lbrace",X="Lbracket",Y="Lparen",tt="Literal",et={".":G,",":w,":":E,"{":Z,"}":j,"]":x,"(":Y,")":S,"@":M,$form:P,$field:T},rt={"<":!0,">":!0,"=":!0,"!":!0},nt={" ":!0,"\t":!0,"\n":!0};function it(t,e){var r=t[e];return"@"===r?t.length>e&&ut(t[e+1]):r>="a"&&r<="z"||r>="A"&&r<="Z"||"_"===r}function st(t,e){return t>="0"&&t<="9"||e&&"-"===t||"."===t}function ut(t){return t>="a"&&t<="z"||t>="A"&&t<="Z"||t>="0"&&t<="9"||"_"===t}function at(){}at.prototype={tokenize:function(t){var e,r,n,i=[];for(this._current=0;this._current<t.length;){var s=i.length?i.slice(-1)[0].type:null;if(it(t,this._current))e=this._current,r=this._consumeUnquotedIdentifier(t),i.push({type:k,value:r,start:e});else if(void 0!==et[t[this._current]])i.push({type:et[t[this._current]],value:t[this._current],start:this._current}),this._current++;else if("-"===t[this._current]&&s!==I&&s!==S||st(t[this._current],!1))n=this._consumeNumber(t),i.push(n);else if("["===t[this._current])n=this._consumeLBracket(t),i.push(n);else if('"'===t[this._current])e=this._current,r=this._consumeQuotedIdentifier(t),i.push({type:b,value:r,start:e});else if("'"===t[this._current])e=this._current,r=this._consumeRawStringLiteral(t),i.push({type:tt,value:r,start:e});else if("`"===t[this._current]){e=this._current;var u=this._consumeLiteral(t);i.push({type:tt,value:u,start:e})}else if("$"===t[this._current])i.push(this._consumeSpecial(t));else if(void 0!==rt[t[this._current]])i.push(this._consumeOperator(t));else if(void 0!==nt[t[this._current]])this._current++;else if("&"===t[this._current])e=this._current,this._current++,"&"===t[this._current]?(this._current++,i.push({type:A,value:"&&",start:e})):s===w||s===Y?i.push({type:N,value:"&",start:e}):i.push({type:O,value:"&",start:e});else if("+"===t[this._current])e=this._current,this._current++,i.push({type:R,value:"+",start:e});else if("-"===t[this._current])e=this._current,this._current++,i.push({type:C,value:"-",start:e});else if("*"===t[this._current]){e=this._current,this._current++;var a=i.length&&i.slice(-1)[0].type;0===i.length||[X,G,F,A,L,w,E].includes(a)?i.push({type:V,value:"*",start:e}):i.push({type:H,value:"*",start:e})}else if("/"===t[this._current])e=this._current,this._current++,i.push({type:B,value:"/",start:e});else if("^"===t[this._current])e=this._current,this._current++,i.push({type:J,value:"^",start:e});else{if("|"!==t[this._current]){var o=new Error("Unknown character:"+t[this._current]);throw o.name="LexerError",o}e=this._current,this._current++,"|"===t[this._current]?(this._current++,i.push({type:L,value:"||",start:e})):i.push({type:F,value:"|",start:e})}}return i},_consumeUnquotedIdentifier:function(t){var e=this._current;for(this._current++;this._current<t.length&&ut(t[this._current]);)this._current++;return t.slice(e,this._current)},_consumeQuotedIdentifier:function(t){var e=this._current;this._current++;for(var r=t.length;'"'!==t[this._current]&&this._current<r;){var n=this._current;"\\"!==t[n]||"\\"!==t[n+1]&&'"'!==t[n+1]?n++:n+=2,this._current=n}return this._current++,JSON.parse(t.slice(e,this._current))},_consumeRawStringLiteral:function(t){var e=this._current;this._current++;for(var r=t.length;"'"!==t[this._current]&&this._current<r;){var n=this._current;"\\"!==t[n]||"\\"!==t[n+1]&&"'"!==t[n+1]?n++:n+=2,this._current=n}return this._current++,t.slice(e+1,this._current-1).replace("\\'","'")},_consumeNumber:function(t){var e=this._current;this._current++;for(var r=t.length;st(t[this._current],!1)&&this._current<r;)this._current++;var n,i=t.slice(e,this._current);return n=i.includes(".")?parseFloat(i):parseInt(i),{type:I,value:n,start:e}},_consumeLBracket:function(t){var e=this._current;return this._current++,"?"===t[this._current]?(this._current++,{type:W,value:"[?",start:e}):"]"===t[this._current]?(this._current++,{type:Q,value:"[]",start:e}):{type:X,value:"[",start:e}},_consumeSpecial:function(t){var e=this._current;return this._current++,"o"===t[this._current+1]?(this._current+=4,{type:P,value:this.data,start:e}):(this._current+=5,{type:T,value:{},start:e})},_consumeOperator:function(t){var e=this._current,r=t[e];return this._current++,"!"===r?"="===t[this._current]?(this._current++,{type:K,value:"!=",start:e}):{type:"Not",value:"!",start:e}:"<"===r?"="===t[this._current]?(this._current++,{type:z,value:"<=",start:e}):{type:D,value:"<",start:e}:">"===r?"="===t[this._current]?(this._current++,{type:$,value:">=",start:e}):{type:U,value:">",start:e}:"="===r&&"="===t[this._current]?(this._current++,{type:q,value:"==",start:e}):void 0},_consumeLiteral:function(t){this._current++;for(var e,r=this._current,n=t.length;"`"!==t[this._current]&&this._current<n;){var i=this._current;"\\"!==t[i]||"\\"!==t[i+1]&&"`"!==t[i+1]?i++:i+=2,this._current=i}var s=c(t.slice(r,this._current));return s=s.replace("\\`","`"),e=this._looksLikeJSON(s)?JSON.parse(s):JSON.parse('"'+s+'"'),this._current++,e},_looksLikeJSON:function(t){if(""===t)return!1;if('[{"'.indexOf(t[0])>=0)return!0;if(["true","false","null"].indexOf(t)>=0)return!0;if(!("-0123456789".indexOf(t[0])>=0))return!1;try{return JSON.parse(t),!0}catch(t){return!1}}};var ot={};function ct(){}function ht(t){this.runtime=t}function lt(t){this._interpreter=t,this.functionTable={abs:{_func:this._functionAbs,_signature:[{types:[h]}]},avg:{_func:this._functionAvg,_signature:[{types:[g]}]},ceil:{_func:this._functionCeil,_signature:[{types:[h]}]},contains:{_func:this._functionContains,_signature:[{types:[f,p]},{types:[l]}]},ends_with:{_func:this._functionEndsWith,_signature:[{types:[f]},{types:[f]}]},floor:{_func:this._functionFloor,_signature:[{types:[h]}]},length:{_func:this._functionLength,_signature:[{types:[f,p,_]}]},map:{_func:this._functionMap,_signature:[{types:[v]},{types:[p]}]},max:{_func:this._functionMax,_signature:[{types:[g,m]}]},merge:{_func:this._functionMerge,_signature:[{types:[_],variadic:!0}]},max_by:{_func:this._functionMaxBy,_signature:[{types:[p]},{types:[v]}]},sum:{_func:this._functionSum,_signature:[{types:[g]}]},starts_with:{_func:this._functionStartsWith,_signature:[{types:[f]},{types:[f]}]},min:{_func:this._functionMin,_signature:[{types:[g,m]}]},min_by:{_func:this._functionMinBy,_signature:[{types:[p]},{types:[v]}]},type:{_func:this._functionType,_signature:[{types:[l]}]},keys:{_func:this._functionKeys,_signature:[{types:[_]}]},values:{_func:this._functionValues,_signature:[{types:[_]}]},sort:{_func:this._functionSort,_signature:[{types:[m,g]}]},sort_by:{_func:this._functionSortBy,_signature:[{types:[p]},{types:[v]}]},join:{_func:this._functionJoin,_signature:[{types:[f]},{types:[m]}]},reverse:{_func:this._functionReverse,_signature:[{types:[f,p]}]},to_array:{_func:this._functionToArray,_signature:[{types:[l]}]},to_string:{_func:this._functionToString,_signature:[{types:[l]}]},to_number:{_func:this._functionToNumber,_signature:[{types:[l]}]},not_null:{_func:this._functionNotNull,_signature:[{types:[l],variadic:!0}]},and:{_func:this._functionAnd,_signature:[{types:[l]},{types:[l]}]},or:{_func:this._functionOr,_signature:[{types:[l]},{types:[l]}]},not:{_func:this._functionNot,_signature:[{types:[l]}]},true:{_func:function(){return!0},_signature:[]},false:{_func:function(){return!1},_signature:[]},if:{_func:this._functionIf,_signature:[{types:[l]},{types:[l]},{types:[l]}]}}}ot.EOF=0,ot.UnquotedIdentifier=0,ot.QuotedIdentifier=0,ot.Rbracket=0,ot.Rparen=0,ot[w]=0,ot.Rbrace=0,ot.Number=0,ot.Current=0,ot.Form=0,ot.Field=0,ot[N]=0,ot[F]=1,ot[L]=2,ot[A]=3,ot[R]=6,ot[C]=6,ot[O]=7,ot[H]=7,ot[B]=7,ot[J]=7,ot[q]=5,ot[U]=5,ot[D]=5,ot[$]=5,ot[z]=5,ot[K]=5,ot.Flatten=9,ot.Star=20,ot.Filter=21,ot[G]=40,ot.Not=45,ot.Lbrace=50,ot[X]=55,ot.Lparen=60,ct.prototype={parse:function(t){this._loadTokens(t),this.index=0;var e=this.expression(0);if("EOF"!==this._lookahead(0)){var r=this._lookaheadToken(0),n=new Error("Unexpected token type: "+r.type+", value: "+r.value);throw n.name="ParserError",n}return e},_loadTokens:function(t){var e=(new at).tokenize(t);e.push({type:"EOF",value:"",start:t.length}),this.tokens=e},expression:function(t){var e=this._lookaheadToken(0);this._advance();for(var r=this.nud(e),n=this._lookahead(0);t<ot[n];)this._advance(),r=this.led(n,r),n=this._lookahead(0);return r},_lookahead:function(t){return this.tokens[this.index+t].type},_lookaheadToken:function(t){return this.tokens[this.index+t]},_advance:function(){this.index++},nud:function(t){var e,r,n;switch(t.type){case tt:return{type:"Literal",value:t.value};case I:return{type:"Number",value:t.value};case k:return{type:"Field",name:t.value};case b:var i={type:"Field",name:t.value};if(this._lookahead(0)===Y)throw new Error("Quoted identifier not allowed for function names.");return i;case"Not":return{type:"NotExpression",children:[e=this.expression(ot.Not)]};case V:return e=null,{type:"ValueProjection",children:[{type:"Identity"},e=this._lookahead(0)===x?{type:"Identity"}:this._parseProjectionRHS(ot.Star)]};case W:return this.led(t.type,{type:"Identity"});case Z:return this._parseMultiselectHash();case Q:return{type:"Projection",children:[{type:Q,children:[{type:"Identity"}]},e=this._parseProjectionRHS(ot.Flatten)]};case X:return this._lookahead(1)===w||(n=this._lookahead(1),[O,L,A,R,C,H,J,B,q,U,D,$,z,K].includes(n))?this._parseMultiselectList():this._lookahead(0)===I||this._lookahead(0)===E?(e=this._parseIndexExpression(),this._projectIfSlice({type:"Identity"},e)):this._lookahead(0)===V&&this._lookahead(1)===x?(this._advance(),this._advance(),{type:"Projection",children:[{type:"Identity"},e=this._parseProjectionRHS(ot.Star)]}):this._parseMultiselectList();case M:return{type:M};case P:return{type:P};case T:return{type:T};case N:return{type:"ExpressionReference",children:[r=this.expression(ot.Expref)]};case Y:for(var s=[];this._lookahead(0)!==S;)this._lookahead(0)===M?(r={type:M},this._advance()):r=this.expression(0),s.push(r);return this._match(S),s[0];default:this._errorToken(t)}},led:function(t,e){var r;switch(t){case O:return{type:"ConcatenateExpression",children:[e,r=this.expression(ot.Concatenate)]};case G:var n=ot.Dot;return this._lookahead(0)!==V?{type:"Subexpression",children:[e,r=this._parseDotRHS(n)]}:(this._advance(),{type:"ValueProjection",children:[e,r=this._parseProjectionRHS(n)]});case F:return r=this.expression(ot.Pipe),{type:F,children:[e,r]};case L:return{type:"OrExpression",children:[e,r=this.expression(ot.Or)]};case A:return{type:"AndExpression",children:[e,r=this.expression(ot.And)]};case R:return{type:"AddExpression",children:[e,r=this.expression(ot.Add)]};case C:return{type:"SubtractExpression",children:[e,r=this.expression(ot.Subtract)]};case H:return{type:"MultiplyExpression",children:[e,r=this.expression(ot.Multiply)]};case B:return{type:"DivideExpression",children:[e,r=this.expression(ot.Divide)]};case J:return{type:"PowerExpression",children:[e,r=this.expression(ot.Power)]};case Y:for(var i,s=e.name,u=[];this._lookahead(0)!==S;)this._lookahead(0)===M?(i={type:M},this._advance()):i=this.expression(0),this._lookahead(0)===w&&this._match(w),u.push(i);return this._match(S),{type:"Function",name:s,children:u};case W:var a=this.expression(0);return this._match(x),{type:"FilterProjection",children:[e,r=this._lookahead(0)===Q?{type:"Identity"}:this._parseProjectionRHS(ot.Filter),a]};case Q:return{type:"Projection",children:[{type:Q,children:[e]},this._parseProjectionRHS(ot.Flatten)]};case q:case K:case U:case $:case D:case z:return this._parseComparator(e,t);case X:var o=this._lookaheadToken(0);return o.type===I||o.type===E?(r=this._parseIndexExpression(),this._projectIfSlice(e,r)):(this._match(V),this._match(x),{type:"Projection",children:[e,r=this._parseProjectionRHS(ot.Star)]});default:this._errorToken(this._lookaheadToken(0))}},_match:function(t){if(this._lookahead(0)!==t){var e=this._lookaheadToken(0),r=new Error("Expected "+t+", got: "+e.type);throw r.name="ParserError",r}this._advance()},_errorToken:function(t){var e=new Error("Invalid token ("+t.type+'): "'+t.value+'"');throw e.name="ParserError",e},_parseIndexExpression:function(){if(this._lookahead(0)===E||this._lookahead(1)===E)return this._parseSliceExpression();var t={type:"Index",value:this._lookaheadToken(0).value};return this._advance(),this._match(x),t},_projectIfSlice:function(t,e){var r={type:"IndexExpression",children:[t,e]};return"Slice"===e.type?{type:"Projection",children:[r,this._parseProjectionRHS(ot.Star)]}:r},_parseSliceExpression:function(){for(var t=[null,null,null],e=0,r=this._lookahead(0);r!==x&&e<3;){if(r===E)e++,this._advance();else{if(r!==I){var n=this._lookahead(0),i=new Error("Syntax error, unexpected token: "+n.value+"("+n.type+")");throw i.name="Parsererror",i}t[e]=this._lookaheadToken(0).value,this._advance()}r=this._lookahead(0)}return this._match(x),{type:"Slice",children:t}},_parseComparator:function(t,e){return{type:"Comparator",name:e,children:[t,this.expression(ot[e])]}},_parseDotRHS:function(t){var e=this._lookahead(0);return[k,b,V].indexOf(e)>=0?this.expression(t):e===X?(this._match(X),this._parseMultiselectList()):e===Z?(this._match(Z),this._parseMultiselectHash()):void 0},_parseProjectionRHS:function(t){var e;if(ot[this._lookahead(0)]<10)e={type:"Identity"};else if(this._lookahead(0)===X)e=this.expression(t);else if(this._lookahead(0)===W)e=this.expression(t);else{if(this._lookahead(0)!==G){var r=this._lookaheadToken(0),n=new Error("Sytanx error, unexpected token: "+r.value+"("+r.type+")");throw n.name="ParserError",n}this._match(G),e=this._parseDotRHS(t)}return e},_parseMultiselectList:function(){for(var t=[];this._lookahead(0)!==x;){var e=this.expression(0);if(t.push(e),this._lookahead(0)===w&&(this._match(w),this._lookahead(0)===x))throw new Error("Unexpected token Rbracket")}return this._match(x),{type:"MultiSelectList",children:t}},_parseMultiselectHash:function(){for(var t,e,r,n=[],i=[k,b];;){if(t=this._lookaheadToken(0),i.indexOf(t.type)<0)throw new Error("Expecting an identifier token, got: "+t.type);if(e=t.value,this._advance(),this._match(E),r={type:"KeyValuePair",name:e,value:this.expression(0)},n.push(r),this._lookahead(0)===w)this._match(w);else if(this._lookahead(0)===j){this._match(j);break}}return{type:"MultiSelectHash",children:n}}},ht.prototype={search:function(t,e){return this.visit(t,e)},visit:function(e,c){var h,l,p,_,d,v,y,g,k;switch(e.type){case"Field":return null!==c&&r(c)?void 0===(v=c[e.name])?null:v:null;case"Subexpression":for(p=this.visit(e.children[0],c),k=1;k<e.children.length;k++)if(null===(p=this.visit(e.children[1],p)))return null;return p;case"IndexExpression":case F:return y=this.visit(e.children[0],c),this.visit(e.children[1],y);case"Index":if(!t(c))return null;var b=e.value;return b<0&&(b=c.length+b),void 0===(p=c[b])&&(p=null),p;case"Slice":if(!t(c))return null;var x=e.children.slice(0),S=this.computeSliceParams(c.length,x),w=S[0],E=S[1],O=S[2];if(p=[],O>0)for(k=w;k<E;k+=O)p.push(c[k]);else for(k=w;k>E;k+=O)p.push(c[k]);return p;case"Projection":var j=this.visit(e.children[0],c);if(!t(j))return null;for(g=[],k=0;k<j.length;k++)null!==(l=this.visit(e.children[1],j[k]))&&g.push(l);return g;case"ValueProjection":if(!r(j=this.visit(e.children[0],c)))return null;g=[];var I=function(t){for(var e=Object.keys(t),r=[],n=0;n<e.length;n++)r.push(t[e[n]]);return r}(j);for(k=0;k<I.length;k++)null!==(l=this.visit(e.children[1],I[k]))&&g.push(l);return g;case"FilterProjection":if(!t(j=this.visit(e.children[0],c)))return null;var T=[],L=[];for(k=0;k<j.length;k++)i(h=this.visit(e.children[2],j[k]))||T.push(j[k]);for(var A=0;A<T.length;A++)null!==(l=this.visit(e.children[1],T[A]))&&L.push(l);return L;case"Comparator":switch(_=this.visit(e.children[0],c),d=this.visit(e.children[1],c),e.name){case q:p=n(_,d);break;case K:p=!n(_,d);break;case U:p=_>d;break;case $:p=_>=d;break;case D:p=_<d;break;case z:p=_<=d;break;default:throw new Error("Unknown comparator: "+e.name)}return p;case Q:var R=this.visit(e.children[0],c);if(!t(R))return null;var C=[];for(k=0;k<R.length;k++)t(l=R[k])?C.push.apply(C,l):C.push(l);return C;case"Identity":case M:return c;case"MultiSelectList":if(null===c)return null;for(g=[],k=0;k<e.children.length;k++)g.push(this.visit(e.children[k],c));return g;case"MultiSelectHash":if(null===c)return null;var H;for(g={},k=0;k<e.children.length;k++)g[(H=e.children[k]).name]=this.visit(H.value,c);return g;case"OrExpression":return i(h=this.visit(e.children[0],c))&&(h=this.visit(e.children[1],c)),h;case"AndExpression":return!0===i(_=this.visit(e.children[0],c))?_:this.visit(e.children[1],c);case"AddExpression":return s(_=this.visit(e.children[0],c))+s(this.visit(e.children[1],c));case"ConcatenateExpression":return _=this.visit(e.children[0],c),d=this.visit(e.children[1],c),u(_=a(o(_),[f,m],_),d=a(o(d),[f,m],d),"&");case"SubtractExpression":return(_=this.visit(e.children[0],c))-this.visit(e.children[1],c);case"MultiplyExpression":return u(_=this.visit(e.children[0],c),d=this.visit(e.children[1],c),"*");case"DivideExpression":return(_=this.visit(e.children[0],c))/this.visit(e.children[1],c);case"PowerExpression":return _=this.visit(e.children[0],c),Math.pow(_,this.visit(e.children[1],c));case"NotExpression":return i(_=this.visit(e.children[0],c));case"Literal":case"Number":return e.value;case P:return this.$form;case"Function":var J=[];for(k=0;k<e.children.length;k++)J.push(this.visit(e.children[k],c));return this.runtime.callFunction(e.name,J);case"ExpressionReference":var B=e.children[0];return B.jmespathType=N,B;default:throw new Error("Unknown node type: "+e.type)}},computeSliceParams:function(t,e){var r=e[0],n=e[1],i=e[2],s=[null,null,null];if(null===i)i=1;else if(0===i){var u=new Error("Invalid slice, step cannot be 0");throw u.name="RuntimeError",u}var a=i<0;return r=null===r?a?t-1:0:this.capSliceRange(t,r,i),n=null===n?a?-1:t:this.capSliceRange(t,n,i),s[0]=r,s[1]=n,s[2]=i,s},capSliceRange:function(t,e,r){return e<0?(e+=t)<0&&(e=r<0?-1:0):e>=t&&(e=r<0?t-1:t),e}},lt.prototype={callFunction:function(t,e){var r=this.functionTable[t];if(void 0===r)throw new Error("Unknown function: "+t+"()");return this._validateArgs(t,e,r._signature),r._func.call(this,e)},_validateArgs:function(t,e,r){if(0!==r.length){var n,i,s;if(r[r.length-1].variadic){if(e.length<r.length)throw n=1===r.length?" argument":" arguments",new Error("ArgumentError: "+t+"() takes at least"+r.length+n+" but received "+e.length)}else if(e.length!==r.length)throw n=1===r.length?" argument":" arguments",new Error("ArgumentError: "+t+"() takes "+r.length+n+" but received "+e.length);for(var u=0;u<r.length;u++)i=r[u].types,s=o(e[u]),e[u]=a(s,i,e[u])}},_functionStartsWith:function(t){return 0===t[0].lastIndexOf(t[1])},_functionEndsWith:function(t){var e=t[0],r=t[1];return-1!==e.indexOf(r,e.length-r.length)},_functionReverse:function(t){if(o(t[0])===f){for(var e=t[0],r="",n=e.length-1;n>=0;n--)r+=e[n];return r}var i=t[0].slice(0);return i.reverse(),i},_functionAbs:function(t){return Math.abs(t[0])},_functionCeil:function(t){return Math.ceil(t[0])},_functionAvg:function(t){for(var e=0,r=t[0],n=0;n<r.length;n++)e+=r[n];return e/r.length},_functionContains:function(t){return t[0].indexOf(t[1])>=0},_functionFloor:function(t){return Math.floor(t[0])},_functionLength:function(t){return r(t[0])?Object.keys(t[0]).length:t[0].length},_functionMap:function(t){for(var e=[],r=this._interpreter,n=t[0],i=t[1],s=0;s<i.length;s++)e.push(r.visit(n,i[s]));return e},_functionMerge:function(t){for(var e={},r=0;r<t.length;r++){var n=t[r];for(var i in n)e[i]=n[i]}return e},_functionMax:function(t){if(t[0].length>0){if(o(t[0][0])===h)return Math.max.apply(Math,t[0]);for(var e=t[0],r=e[0],n=1;n<e.length;n++)r.localeCompare(e[n])<0&&(r=e[n]);return r}return null},_functionMin:function(t){if(t[0].length>0){if(o(t[0][0])===h)return Math.min.apply(Math,t[0]);for(var e=t[0],r=e[0],n=1;n<e.length;n++)e[n].localeCompare(r)<0&&(r=e[n]);return r}return null},_functionSum:function(t){for(var e=0,r=t[0],n=0;n<r.length;n++)e+=1*r[n];return e},_functionAnd:function(t){return!!t[0]&&!!t[1]},_functionIf:function(t){return t[0]?t[1]:t[2]},_functionOr:function(t){return!!t[0]||!!t[1]},_functionNot:function(t){return!t[0]},_functionType:function(t){switch(o(t[0])){case h:return"number";case f:return"string";case p:return"array";case _:return"object";case d:return"boolean";case v:return"expref";case y:return"null"}},_functionKeys:function(t){return Object.keys(t[0])},_functionValues:function(t){for(var e=t[0],r=Object.keys(e),n=[],i=0;i<r.length;i++)n.push(e[r[i]]);return n},_functionJoin:function(t){var e=t[0];return t[1].join(e)},_functionToArray:function(t){return o(t[0])===p?t[0]:[t[0]]},_functionToString:function(t){return o(t[0])===f?t[0]:JSON.stringify(t[0])},_functionToNumber:function(t){var e=o(t[0]);return e===h?t[0]:e===f?s(t[0]):null},_functionNotNull:function(t){for(var e=0;e<t.length;e++)if(o(t[e])!==y)return t[e];return null},_functionSort:function(t){var e=t[0].slice(0);return e.sort(),e},_functionSortBy:function(t){var e=t[0].slice(0);if(0===e.length)return e;var r=this._interpreter,n=t[1],i=o(r.visit(n,e[0]));if([h,f].indexOf(i)<0)throw new Error("TypeError");for(var s=[],u=0;u<e.length;u++)s.push([u,e[u]]);s.sort((function(t,e){var s=r.visit(n,t[1]),u=r.visit(n,e[1]);if(o(s)!==i)throw new Error("TypeError: expected "+i+", received "+o(s));if(o(u)!==i)throw new Error("TypeError: expected "+i+", received "+o(u));return s>u?1:s<u?-1:t[0]-e[0]}));for(var a=0;a<s.length;a++)e[a]=s[a][1];return e},_functionMaxBy:function(t){for(var e,r,n=t[1],i=t[0],s=this.createKeyFunction(n,[h,f]),u=-1/0,a=0;a<i.length;a++)(r=s(i[a]))>u&&(u=r,e=i[a]);return e},_functionMinBy:function(t){for(var e,r,n=t[1],i=t[0],s=this.createKeyFunction(n,[h,f]),u=1/0,a=0;a<i.length;a++)(r=s(i[a]))<u&&(u=r,e=i[a]);return e},createKeyFunction:function(t,e){var r=this._interpreter;return function(n){var i=r.visit(t,n);if(e.indexOf(o(i))<0){var s="TypeError: expected one of "+e+", received "+o(i);throw new Error(s)}return i}}},this.tokenize=function(t){return(new at).tokenize(t)},this.compile=function(t){return(new ct).parse(t)},this.search=function(t,e){var r=new ct,n=new lt,i=new ht(n);n._interpreter=i;var s=r.parse(e);return i.$form=t,i.search(s,t)},this.strictDeepEqual=n};function n(t){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},n(t)}function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function s(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function u(t,e,r){return e&&s(t.prototype,e),r&&s(t,r),t}window.addEventListener("load",(function(){var t=document.getElementById("data"),e=document.getElementById("expression"),s=document.getElementById("result"),a=[],o=window.localStorage.getItem("data");o&&(t.value=o);var c=window.localStorage.getItem("expression");function h(t,e,r){r instanceof Array?r.forEach((function(t,e){h(r,e,t)})):null!==r&&"object"===n(r)?Object.keys(r).forEach((function(t){h(r,t,r[t])})):t[e]=function(t,e){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],s=new(function(){function s(){i(this,s)}return u(s,[{key:"valueOf",value:function(){return e}},{key:"toString",value:function(){return e.toString()}},{key:"toJSON",value:function(){return e}},{key:"equals",value:function(t){return null==t?this.valueOf()===t:this.valueOf()===t.valueOf()}},{key:"value",get:function(){return e}},{key:"name",get:function(){return t}},{key:"readonly",get:function(){return r}},{key:"required",get:function(){return n}},{key:"@value",get:function(){return e}},{key:"@name",get:function(){return t}},{key:"@readonly",get:function(){return r}},{key:"@required",get:function(){return n}}]),s}());return a.push(s),s}(e,t[e])}c&&(e.value=c);var l=function(){function t(e){var r=this;i(this,t),Object.keys(e).forEach((function(t){r[t]=e[t]}))}return u(t,[{key:"fields",get:function(){return a}}]),t}();function f(){window.localStorage.setItem("data",t.value),window.localStorage.setItem("expression",e.value);var i,u,a=e.value;try{i=JSON.parse(t.value);var o=new l(i);i.$=o,document.getElementById("use-fields").checked&&h(null,null,i)}catch(t){return void(s.value=t.toString())}try{var c=function(t,e){return r.search(t,e)}(i,a);null!==(u=c)&&"object"===n(u)&&"Field"===u.__proto__.constructor.name?s.value=c.value:"object"===n(c)?s.value=JSON.stringify(c,null,2):s.value=c}catch(t){s.value=t.toString()}}t.addEventListener("blur",f),e.addEventListener("blur",f),f(),fetch("../antlr/JSONFormula.g4").then((function(t){t.text().then((function(t){return document.getElementById("grammar-out").innerHTML=t}))}))})),JSONFormula=t})();
//# sourceMappingURL=tutorial.js.map