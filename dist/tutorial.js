var JSONFormula;(()=>{"use strict";var e={};(e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})})(e);const t="UnquotedIdentifier",r="QuotedIdentifier",n="Rbracket",i="Rparen",u="Comma",a="Colon",o="Concatenate",s="Rbrace",c="Number",l="Current",f="Global",h="Expref",p="Pipe",y="Subtract",v="Multiply",d="Power",_="Divide",g="EQ",m="GT",b="LT",w="GTE",k="LTE",O="NE",S="Flatten",j="Star",E="Filter",x="Lbrace",P="Lbracket",N="Lparen",T="Literal";function I(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function A(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var M=t,C=r,D=i,F=u,L=a,R=c,U=p,H="Or",G="And",$="Dot",J=P,B=N,q=T,Q={".":$,",":F,":":L,"{":x,"}":s,"]":n,"(":B,")":D,"@":l},z={"<":!0,">":!0,"=":!0,"!":!0},V={" ":!0,"\t":!0,"\n":!0};function Y(e,t){return e>="0"&&e<="9"||t&&"-"===e||"."===e}function W(e){return e>="a"&&e<="z"||e>="A"&&e<="Z"||e>="0"&&e<="9"||"_"===e}function Z(e,t){var r=e[t];return"$"===r?e.length>t&&W(e[t+1]):r>="a"&&r<="z"||r>="A"&&r<="Z"||"_"===r}var K=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];I(this,e),this._allowedGlobalNames=t}var t,r;return t=e,(r=[{key:"tokenize",value:function(e){var t,r,n,i=[];for(this._current=0;this._current<e.length;){var u=i.length?i.slice(-1)[0].type:null;if(this._isGlobal(u,e,this._current))i.push(this._consumeGlobal(e));else if(Z(e,this._current))t=this._current,r=this._consumeUnquotedIdentifier(e),i.push({type:M,value:r,start:t});else if(void 0!==Q[e[this._current]])i.push({type:Q[e[this._current]],value:e[this._current],start:this._current}),this._current+=1;else if("-"===e[this._current]&&![R,D,M,C].includes(u)||Y(e[this._current],!1))n=this._consumeNumber(e),i.push(n);else if("["===e[this._current])n=this._consumeLBracket(e),i.push(n);else if('"'===e[this._current])t=this._current,r=this._consumeQuotedIdentifier(e),i.push({type:C,value:r,start:t});else if("'"===e[this._current])t=this._current,r=this._consumeRawStringLiteral(e),i.push({type:q,value:r,start:t});else if("`"===e[this._current]){t=this._current;var a=this._consumeLiteral(e);i.push({type:q,value:a,start:t})}else if(void 0!==z[e[this._current]])i.push(this._consumeOperator(e));else if(void 0!==V[e[this._current]])this._current+=1;else if("&"===e[this._current])t=this._current,this._current+=1,"&"===e[this._current]?(this._current+=1,i.push({type:G,value:"&&",start:t})):u===F||u===B?i.push({type:"Expref",value:"&",start:t}):i.push({type:"Concatenate",value:"&",start:t});else if("+"===e[this._current])t=this._current,this._current+=1,i.push({type:"Add",value:"+",start:t});else if("-"===e[this._current])t=this._current,this._current+=1,i.push({type:"Subtract",value:"-",start:t});else if("*"===e[this._current]){t=this._current,this._current+=1;var o=i.length&&i.slice(-1)[0].type;0===i.length||[J,$,U,G,H,F,L].includes(o)?i.push({type:"Star",value:"*",start:t}):i.push({type:"Multiply",value:"*",start:t})}else if("/"===e[this._current])t=this._current,this._current+=1,i.push({type:"Divide",value:"/",start:t});else if("^"===e[this._current])t=this._current,this._current+=1,i.push({type:"Power",value:"^",start:t});else{if("|"!==e[this._current]){var s=new Error("Unknown character:".concat(e[this._current]));throw s.name="LexerError",s}t=this._current,this._current+=1,"|"===e[this._current]?(this._current+=1,i.push({type:H,value:"||",start:t})):i.push({type:U,value:"|",start:t})}}return i}},{key:"_consumeUnquotedIdentifier",value:function(e){var t=this._current;for(this._current+=1;this._current<e.length&&W(e[this._current]);)this._current+=1;return e.slice(t,this._current)}},{key:"_consumeQuotedIdentifier",value:function(e){var t=this._current;this._current+=1;for(var r=e.length;'"'!==e[this._current]&&this._current<r;){var n=this._current;"\\"!==e[n]||"\\"!==e[n+1]&&'"'!==e[n+1]?n+=1:n+=2,this._current=n}return this._current+=1,JSON.parse(e.slice(t,this._current))}},{key:"_consumeRawStringLiteral",value:function(e){var t=this._current;this._current+=1;for(var r=e.length;"'"!==e[this._current]&&this._current<r;){var n=this._current;"\\"!==e[n]||"\\"!==e[n+1]&&"'"!==e[n+1]?n+=1:n+=2,this._current=n}return this._current+=1,e.slice(t+1,this._current-1).replace("\\'","'")}},{key:"_consumeNumber",value:function(e){var t=this._current;this._current+=1;for(var r=e.length;Y(e[this._current],!1)&&this._current<r;)this._current+=1;var n,i=e.slice(t,this._current);return n=i.includes(".")?parseFloat(i):parseInt(i,10),{type:R,value:n,start:t}}},{key:"_consumeLBracket",value:function(e){var t=this._current;return this._current+=1,"?"===e[this._current]?(this._current+=1,{type:"Filter",value:"[?",start:t}):"]"===e[this._current]?(this._current+=1,{type:"Flatten",value:"[]",start:t}):{type:J,value:"[",start:t}}},{key:"_isGlobal",value:function(e,t,r){if(null!==e&&e===$)return!1;if("$"!==t[r])return!1;for(var n=r+1;n<t.length&&W(t[n]);)n+=1;var i=t.slice(r,n);return this._allowedGlobalNames.includes(i)}},{key:"_consumeGlobal",value:function(e){var t=this._current;for(this._current+=1;this._current<e.length&&W(e[this._current]);)this._current+=1;return{type:"Global",name:e.slice(t,this._current),start:t}}},{key:"_consumeOperator",value:function(e){var t=this._current,r=e[t];return this._current+=1,"!"===r?"="===e[this._current]?(this._current+=1,{type:"NE",value:"!=",start:t}):{type:"Not",value:"!",start:t}:"<"===r?"="===e[this._current]?(this._current+=1,{type:"LTE",value:"<=",start:t}):{type:"LT",value:"<",start:t}:">"===r?"="===e[this._current]?(this._current+=1,{type:"GTE",value:">=",start:t}):{type:"GT",value:">",start:t}:"="===e[this._current]?(this._current+=1,{type:"EQ",value:"==",start:t}):{type:"EQ",value:"=",start:t}}},{key:"_consumeLiteral",value:function(e){this._current+=1;for(var t,r=this._current,n=e.length;"`"!==e[this._current]&&this._current<n;){var i=this._current;"\\"!==e[i]||"\\"!==e[i+1]&&"`"!==e[i+1]?i+=1:i+=2,this._current=i}var u=e.slice(r,this._current).trimStart();return t=function(e){if(""===e)return!1;if('[{"'.indexOf(e[0])>=0)return!0;if(["true","false","null"].indexOf(e)>=0)return!0;if(!("-0123456789".indexOf(e[0])>=0))return!1;try{return JSON.parse(e),!0}catch(e){return!1}}(u=u.replace("\\`","`"))?JSON.parse(u):JSON.parse('"'.concat(u,'"')),this._current+=1,t}}])&&A(t.prototype,r),Object.defineProperty(t,"prototype",{writable:!1}),e}();function X(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var ee=0,te=2,re=3,ne=5,ie=7,ue=8,ae=9,oe=h,se={0:"number",1:"any",2:"string",3:"array",4:"object",5:"boolean",6:"expression",7:"null",8:"Array<number>",9:"Array<string>"};function ce(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(null===e)return ie;var r=t?e.valueOf():e;switch(Object.prototype.toString.call(r)){case"[object String]":return te;case"[object Number]":return ee;case"[object Array]":return re;case"[object Boolean]":return ne;case"[object Null]":return ie;case"[object Object]":return r.jmespathType===oe?6:4;default:return 4}}function le(e){return[ce(e),ce(e,!1)]}function fe(e,t,r,n,i){var u=e[0];if(-1!==t.findIndex((function(e){return 1===e||u===e})))return r;if(4===u)throw new Error("TypeError: ".concat(n," expected argument to be type ").concat(se[t[0]]," but received type ").concat(se[u]," instead."));var a=-1;if(u===re&&t.includes(ae)&&t.includes(ue)&&(a=r.length>0&&"string"==typeof r[0]?ae:ue),-1===a&&[ae,ue,re].includes(u)&&(a=t.find((function(e){return[ae,ue,re].includes(e)}))),-1===a&&(a=function(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,i,u=[],a=!0,o=!1;try{for(r=r.call(e);!(a=(n=r.next()).done)&&(u.push(n.value),!t||u.length!==t);a=!0);}catch(e){o=!0,i=e}finally{try{a||null==r.return||r.return()}finally{if(o)throw i}}return u}}(e,t)||function(e,t){if(e){if("string"==typeof e)return X(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?X(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}(t,1)[0]),1===a)return r;if(a===ae||a===ue||a===re){if(a===re)return u===ue||u===ae?r:null===r?[]:[r];var o=a===ue?ee:te;if(u===re){for(var s=r.slice(),c=0;c<s.length;c+=1){var l=le(s[c]);s[c]=fe(l,[o],s[c],n,i)}return s}if([ee,te,ie,ne].includes(o))return[fe(e,[o],r,n,i)]}else{if(a===ee)return[te,ne,ie].includes(u)?i(r):0;if(a===te)return u===ie||4===u?"":r.toString();if(a===ne)return!!r;if(4===a&&4===e[1])return r}throw new Error("unhandled argument")}function he(e){return null!==e&&"[object Array]"===Object.prototype.toString.call(e)}function pe(e){return null!==e&&"[object Object]"===Object.prototype.toString.call(e)}function ye(e){return null==e?e:he(e)?e.map((function(e){return ye(e)})):e.valueOf()}function ve(e,t){var r=ye(e),n=ye(t);if(r===n)return!0;if(Object.prototype.toString.call(r)!==Object.prototype.toString.call(n))return!1;if(!0===he(r)){if(r.length!==n.length)return!1;for(var i=0;i<r.length;i+=1)if(!1===ve(r[i],n[i]))return!1;return!0}if(!0===pe(r)){var u={};for(var a in r)if(hasOwnProperty.call(r,a)){if(!1===ve(r[a],n[a]))return!1;u[a]=!0}for(var o in n)if(hasOwnProperty.call(n,o)&&!0!==u[o])return!1;return!0}return!1}function de(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _e(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,i,u=[],a=!0,o=!1;try{for(r=r.call(e);!(a=(n=r.next()).done)&&(u.push(n.value),!t||u.length!==t);a=!0);}catch(e){o=!0,i=e}finally{try{a||null==r.return||r.return()}finally{if(o)throw i}}return u}}(e,t)||ge(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ge(e,t){if(e){if("string"==typeof e)return me(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?me(e,t):void 0}}function me(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function be(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function we(e){if(null===e)return!0;var t=ye(e);if(""===t||!1===t||null===t)return!0;if(he(t)&&0===t.length)return!0;if(pe(t)){for(var r in t)if(Object.prototype.hasOwnProperty.call(t,r))return!1;return!0}return!t}var ke,Oe=function(){function e(t,r,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.runtime=t,this.globals=r,this.toNumber=n}var t,r;return t=e,(r=[{key:"search",value:function(e,t){return this.visit(e,t)}},{key:"visit",value:function(e,t){var r,n=this,i=(de(r={Field:function(e,t){if(null!==t&&pe(t)){var r=t[e.name];return void 0===r?null:r}return null},Subexpression:function(e,t){for(var r=n.visit(e.children[0],t),i=1;i<e.children.length;i+=1)if(null===(r=n.visit(e.children[1],r)))return null;return r},IndexExpression:function(e,t){var r=n.visit(e.children[0],t);return n.visit(e.children[1],r)},Index:function(e,t){if(!he(t))return null;var r=e.value;r<0&&(r=t.length+r);var n=t[r];return void 0===n?null:n},Slice:function(e,t){if(!he(t))return null;var r=e.children.slice(0),i=_e(n.computeSliceParams(t.length,r),3),u=i[0],a=i[1],o=i[2],s=[];if(o>0)for(var c=u;c<a;c+=o)s.push(t[c]);else for(var l=u;l>a;l+=o)s.push(t[l]);return s},Projection:function(e,t){var r=n.visit(e.children[0],t);if(!he(r))return null;for(var i=[],u=0;u<r.length;u+=1){var a=n.visit(e.children[1],r[u]);null!==a&&i.push(a)}return i},ValueProjection:function(e,t){var r=n.visit(e.children[0],t);if(!pe(ye(r)))return null;for(var i=[],u=function(e){for(var t=Object.keys(e),r=[],n=0;n<t.length;n+=1)r.push(e[t[n]]);return r}(r),a=0;a<u.length;a+=1){var o=n.visit(e.children[1],u[a]);null!==o&&i.push(o)}return i},FilterProjection:function(e,t){var r=n.visit(e.children[0],t);if(!he(r))return null;for(var i=[],u=[],a=0;a<r.length;a+=1)we(n.visit(e.children[2],r[a]))||i.push(r[a]);for(var o=0;o<i.length;o+=1){var s=n.visit(e.children[1],i[o]);null!==s&&u.push(s)}return u},Comparator:function(e,t){var r=n.visit(e.children[0],t),i=n.visit(e.children[1],t);if("EQ"===e.name)return ve(r,i);if("NE"===e.name)return!ve(r,i);if("GT"===e.name)return r>i;if("GTE"===e.name)return r>=i;if("LT"===e.name)return r<i;if("LTE"===e.name)return r<=i;throw new Error("Unknown comparator: ".concat(e.name))}},"Flatten",(function(e,t){var r,i=n.visit(e.children[0],t);if(!he(i))return null;for(var u=[],a=0;a<i.length;a+=1){var o=i[a];he(o)?u.push.apply(u,function(e){if(Array.isArray(e))return me(e)}(r=o)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(r)||ge(r)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()):u.push(o)}return u})),de(r,"Identity",(function(e,t){return t})),de(r,"MultiSelectList",(function(e,t){if(null===t)return null;for(var r=[],i=0;i<e.children.length;i+=1)r.push(n.visit(e.children[i],t));return r})),de(r,"MultiSelectHash",(function(e,t){if(null===t)return null;for(var r={},i=0;i<e.children.length;i+=1){var u=e.children[i];r[u.name]=n.visit(u.value,t)}return r})),de(r,"OrExpression",(function(e,t){var r=n.visit(e.children[0],t);return we(r)&&(r=n.visit(e.children[1],t)),r})),de(r,"AndExpression",(function(e,t){var r=n.visit(e.children[0],t);return!0===we(r)?r:n.visit(e.children[1],t)})),de(r,"AddExpression",(function(e,t){var r=n.visit(e.children[0],t);return n.toNumber(r)+n.toNumber(n.visit(e.children[1],t))})),de(r,"ConcatenateExpression",(function(e,t){var r=n.visit(e.children[0],t),i=n.visit(e.children[1],t);return r=fe(le(r),[2,9],r,"concatenate",n.toNumber),i=fe(le(i),[2,9],i,"concatenate",n.toNumber),n.applyOperator(r,i,"&")})),de(r,"SubtractExpression",(function(e,t){return n.visit(e.children[0],t)-n.visit(e.children[1],t)})),de(r,"MultiplyExpression",(function(e,t){var r=n.visit(e.children[0],t),i=n.visit(e.children[1],t);return n.applyOperator(r,i,"*")})),de(r,"DivideExpression",(function(e,t){return n.visit(e.children[0],t)/n.visit(e.children[1],t)})),de(r,"PowerExpression",(function(e,t){var r=n.visit(e.children[0],t);return Math.pow(r,n.visit(e.children[1],t))})),de(r,"NotExpression",(function(e,t){return we(n.visit(e.children[0],t))})),de(r,"Literal",(function(e){return e.value})),de(r,"Number",(function(e){return e.value})),de(r,"Pipe",(function(e,t){var r=n.visit(e.children[0],t);return n.visit(e.children[1],r)})),de(r,"Current",(function(e,t){return t})),de(r,"Global",(function(e){var t=n.globals[e.name];return void 0===t?null:t})),de(r,"Function",(function(e,t){if("if"===e.name)return n.runtime.callFunction(e.name,e.children,t);for(var r=[],i=0;i<e.children.length;i+=1)r.push(n.visit(e.children[i],t));return n.runtime.callFunction(e.name,r)})),de(r,"ExpressionReference",(function(e){var t=_e(e.children,1)[0];return t.jmespathType="Expref",t})),r)[e.type];if(!i)throw new Error("Unknown node type: ".concat(e.type));return i(e,t)}},{key:"computeSliceParams",value:function(e,t){function r(e,t,r){var n=t;return n<0?(n+=e)<0&&(n=r<0?-1:0):n>=e&&(n=r<0?e-1:e),n}var n=t[0],i=t[1],u=t[2],a=[null,null,null];if(null===u)u=1;else if(0===u){var o=new Error("Invalid slice, step cannot be 0");throw o.name="RuntimeError",o}var s=u<0;return n=null===n?s?e-1:0:r(e,n,u),i=null===i?s?-1:e:r(e,i,u),a[0]=n,a[1]=i,a[2]=u,a}},{key:"applyOperator",value:function(e,t,r){var n=this;if(he(e)&&he(t)){var i,u=Math.min(e.length,t.length),a=[];for(i=0;i<u;i+=1)if(he(e[i])||he(t[i]))a.push(this.applyOperator(e[i],t[i],r));else if("*"===r)a.push(e[i]*t[i]);else{if("&"!==r)throw new Error("unimplemented");a.push(e[i]+t[i])}for(i=u;i<Math.max(e.length,t.length);i+=1)"&"===r?a.push(""):"*"===r&&a.push(0);return a}if(he(e)||he(t)){var o=_e(he(e)?[e,t]:[t,e],2),s=o[0],c=o[1];if("*"===r)return s.map((function(e){return n.toNumber(e)*n.toNumber(c)}));if("&"===r)return s.map((function(e){return e+c}))}if("*"===r)return this.toNumber(e)*this.toNumber(t);if("&"===r)return e+t;throw new Error("unimplemented array operator: ".concat(r))}}])&&be(t.prototype,r),Object.defineProperty(t,"prototype",{writable:!1}),e}();function Se(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function je(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Ee(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var xe=a,Pe="EOF",Ne=t,Te=r,Ie=n,Ae=i,Me=u,Ce=o,De=s,Fe=c,Le=l,Re=f,Ue="Field",He=h,Ge=p,$e="Or",Je="And",Be="Add",qe=y,Qe=v,ze=d,Ve=_,Ye=g,We=m,Ze=b,Ke=w,Xe=k,et=O,tt=S,rt=j,nt=E,it="Dot",ut=x,at=P,ot=N,st=(Ee(ke={},Pe,0),Ee(ke,Ne,0),Ee(ke,Te,0),Ee(ke,Ie,0),Ee(ke,Ae,0),Ee(ke,Me,0),Ee(ke,De,0),Ee(ke,Fe,0),Ee(ke,Le,0),Ee(ke,Re,0),Ee(ke,Ue,0),Ee(ke,He,0),Ee(ke,Ge,1),Ee(ke,$e,2),Ee(ke,Je,3),Ee(ke,Be,6),Ee(ke,qe,6),Ee(ke,Ce,7),Ee(ke,Qe,7),Ee(ke,Ve,7),Ee(ke,ze,7),Ee(ke,Ye,5),Ee(ke,We,5),Ee(ke,Ze,5),Ee(ke,Ke,5),Ee(ke,Xe,5),Ee(ke,et,5),Ee(ke,tt,9),Ee(ke,rt,20),Ee(ke,nt,21),Ee(ke,it,40),Ee(ke,"Not",45),Ee(ke,ut,50),Ee(ke,at,55),Ee(ke,ot,60),ke),ct=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];Se(this,e),this._allowedGlobalNames=t}var t,r;return t=e,(r=[{key:"parse",value:function(e){this._loadTokens(e),this.index=0;var t=this.expression(0);if(this._lookahead(0)!==Pe){var r=this._lookaheadToken(0),n=new Error("Unexpected token type: ".concat(r.type,", value: ").concat(r.value));throw n.name="ParserError",n}return t}},{key:"_loadTokens",value:function(e){var t=new K(this._allowedGlobalNames).tokenize(e);t.push({type:Pe,value:"",start:e.length}),this.tokens=t}},{key:"expression",value:function(e){var t=this._lookaheadToken(0);this._advance();for(var r=this.nud(t),n=this._lookahead(0);e<st[n];)this._advance(),r=this.led(n,r),n=this._lookahead(0);return r}},{key:"_lookahead",value:function(e){return this.tokens[this.index+e].type}},{key:"_lookaheadToken",value:function(e){return this.tokens[this.index+e]}},{key:"_advance",value:function(){this.index+=1}},{key:"nud",value:function(e){var t,r,n,i,u;switch(e.type){case"Literal":return{type:"Literal",value:e.value};case Fe:return{type:"Number",value:e.value};case Ne:return{type:"Field",name:e.value};case Te:if(n={type:"Field",name:e.value},this._lookahead(0)===ot)throw new Error("Quoted identifier not allowed for function names.");return n;case"Not":return{type:"NotExpression",children:[t=this.expression(st.Not)]};case rt:return{type:"ValueProjection",children:[{type:"Identity"},t=this._lookahead(0)===Ie?{type:"Identity"}:this._parseProjectionRHS(st.Star)]};case nt:return this.led(e.type,{type:"Identity"});case ut:return this._parseMultiselectHash();case tt:return{type:"Projection",children:[{type:tt,children:[{type:"Identity"}]},t=this._parseProjectionRHS(st.Flatten)]};case at:return this._lookahead(1)===Me||(u=this._lookahead(1),[Ce,$e,Je,Be,qe,Qe,ze,Ve,Ye,We,Ze,Ke,Xe,et].includes(u))?this._parseMultiselectList():this._lookahead(0)===Fe||this._lookahead(0)===xe?(t=this._parseIndexExpression(),this._projectIfSlice({type:"Identity"},t)):this._lookahead(0)===rt&&this._lookahead(1)===Ie?(this._advance(),this._advance(),{type:"Projection",children:[{type:"Identity"},t=this._parseProjectionRHS(st.Star)]}):this._parseMultiselectList();case Le:return{type:Le};case Re:return{type:Re,name:e.name};case Ue:return{type:Ue};case He:return{type:"ExpressionReference",children:[r=this.expression(st.Expref)]};case ot:for(i=[];this._lookahead(0)!==Ae;)this._lookahead(0)===Le?(r={type:Le},this._advance()):r=this.expression(0),i.push(r);return this._match(Ae),i[0];default:this._errorToken(e)}}},{key:"led",value:function(e,t){var r,n,i,u,a,o,s;switch(e){case Ce:return{type:"ConcatenateExpression",children:[t,n=this.expression(st.Concatenate)]};case it:return o=st.Dot,this._lookahead(0)!==rt?{type:"Subexpression",children:[t,n=this._parseDotRHS(o)]}:(this._advance(),{type:"ValueProjection",children:[t,n=this._parseProjectionRHS(o)]});case Ge:return n=this.expression(st.Pipe),{type:Ge,children:[t,n]};case $e:return{type:"OrExpression",children:[t,n=this.expression(st.Or)]};case Je:return{type:"AndExpression",children:[t,n=this.expression(st.And)]};case Be:return{type:"AddExpression",children:[t,n=this.expression(st.Add)]};case qe:return{type:"SubtractExpression",children:[t,n=this.expression(st.Subtract)]};case Qe:return{type:"MultiplyExpression",children:[t,n=this.expression(st.Multiply)]};case Ve:return{type:"DivideExpression",children:[t,n=this.expression(st.Divide)]};case ze:return{type:"PowerExpression",children:[t,n=this.expression(st.Power)]};case ot:for(i=t.name,u=[];this._lookahead(0)!==Ae;)this._lookahead(0)===Le?(a={type:Le},this._advance()):a=this.expression(0),this._lookahead(0)===Me&&this._match(Me),u.push(a);return this._match(Ae),{type:"Function",name:i,children:u};case nt:return r=this.expression(0),this._match(Ie),{type:"FilterProjection",children:[t,n=this._lookahead(0)===tt?{type:"Identity"}:this._parseProjectionRHS(st.Filter),r]};case tt:return{type:"Projection",children:[{type:tt,children:[t]},this._parseProjectionRHS(st.Flatten)]};case Ye:case et:case We:case Ke:case Ze:case Xe:return this._parseComparator(t,e);case at:return(s=this._lookaheadToken(0)).type===Fe||s.type===xe?(n=this._parseIndexExpression(),this._projectIfSlice(t,n)):(this._match(rt),this._match(Ie),{type:"Projection",children:[t,n=this._parseProjectionRHS(st.Star)]});default:this._errorToken(this._lookaheadToken(0))}}},{key:"_match",value:function(e){if(this._lookahead(0)!==e){var t=this._lookaheadToken(0),r=new Error("Expected ".concat(e,", got: ").concat(t.type));throw r.name="ParserError",r}this._advance()}},{key:"_errorToken",value:function(e){var t=new Error("Invalid token (".concat(e.type,'): "').concat(e.value,'"'));throw t.name="ParserError",t}},{key:"_parseIndexExpression",value:function(){if(this._lookahead(0)===xe||this._lookahead(1)===xe)return this._parseSliceExpression();var e={type:"Index",value:this._lookaheadToken(0).value};return this._advance(),this._match(Ie),e}},{key:"_projectIfSlice",value:function(e,t){var r={type:"IndexExpression",children:[e,t]};return"Slice"===t.type?{type:"Projection",children:[r,this._parseProjectionRHS(st.Star)]}:r}},{key:"_parseSliceExpression",value:function(){for(var e=[null,null,null],t=0,r=this._lookahead(0);r!==Ie&&t<3;){if(r===xe)t+=1,this._advance();else{if(r!==Fe){var n=this._lookahead(0),i=new Error("Syntax error, unexpected token: ".concat(n.value,"(").concat(n.type,")"));throw i.name="Parsererror",i}e[t]=this._lookaheadToken(0).value,this._advance()}r=this._lookahead(0)}return this._match(Ie),{type:"Slice",children:e}}},{key:"_parseComparator",value:function(e,t){return{type:"Comparator",name:t,children:[e,this.expression(st[t])]}}},{key:"_parseDotRHS",value:function(e){var t=this._lookahead(0);return[Ne,Te,rt].indexOf(t)>=0?this.expression(e):t===at?(this._match(at),this._parseMultiselectList()):t===ut?(this._match(ut),this._parseMultiselectHash()):void 0}},{key:"_parseProjectionRHS",value:function(e){var t;if(st[this._lookahead(0)]<10)t={type:"Identity"};else if(this._lookahead(0)===at)t=this.expression(e);else if(this._lookahead(0)===nt)t=this.expression(e);else{if(this._lookahead(0)!==it){var r=this._lookaheadToken(0),n=new Error("Sytanx error, unexpected token: ".concat(r.value,"(").concat(r.type,")"));throw n.name="ParserError",n}this._match(it),t=this._parseDotRHS(e)}return t}},{key:"_parseMultiselectList",value:function(){for(var e=[];this._lookahead(0)!==Ie;){var t=this.expression(0);if(e.push(t),this._lookahead(0)===Me&&(this._match(Me),this._lookahead(0)===Ie))throw new Error("Unexpected token Rbracket")}return this._match(Ie),{type:"MultiSelectList",children:e}}},{key:"_parseMultiselectHash",value:function(){for(var e,t,r,n=[],i=[Ne,Te];;){if(e=this._lookaheadToken(0),i.indexOf(e.type)<0)throw new Error("Expecting an identifier token, got: ".concat(e.type));if(t=e.value,this._advance(),this._match(xe),r={type:"KeyValuePair",name:t,value:this.expression(0)},n.push(r),this._lookahead(0)===Me)this._match(Me);else if(this._lookahead(0)===De){this._match(De);break}}return{type:"MultiSelectHash",children:n}}}])&&je(t.prototype,r),Object.defineProperty(t,"prototype",{writable:!1}),e}();function lt(e,t,r,n){return{and:{_func:function(e){return!!t(e[0])&&!!t(e[1])},_signature:[{types:[1]},{types:[1]}]},or:{_func:function(e){return!!t(e[0])||!!t(e[1])},_signature:[{types:[1]},{types:[1]}]},not:{_func:function(e){return!t(e[0])},_signature:[{types:[1]}]},true:{_func:function(){return!0},_signature:[]},false:{_func:function(){return!1},_signature:[]},if:{_func:function(r,n){var i=r[0],u=r[1],a=r[2],o=e.visit(i,n);return t(o)?e.visit(u,n):e.visit(a,n)},_signature:[{types:[1]},{types:[1]},{types:[1]}]},substitute:{_func:function(e){var t=r(e[0]),i=r(e[1]),u=r(e[2]);if(e.length<=3)return t.replace(new RegExp(i,"g"),u);for(var a=n(e[3]),o=-1,s=0;s<a;s+=1){o+=1;var c=t.slice(o).indexOf(i);if(-1===c)return t;o+=c}return t.slice(0,o)+t.slice(o).replace(i,u)},_signature:[{types:[2]},{types:[2]},{types:[2]},{types:[0],optional:!0}]},value:{_func:function(e){var t=(e[0]||{})[e[1]];return void 0===t?null:t},_signature:[{types:[4,3,7]},{types:[2,0]}]},lower:{_func:function(e){return r(e[0]).toLowerCase()},_signature:[{types:[2]}]},upper:{_func:function(e){return r(e[0]).toUpperCase()},_signature:[{types:[2]}]},exp:{_func:function(e){var t=n(e[0]);return Math.exp(t)},_signature:[{types:[0]}]},power:{_func:function(e){var t=n(e[0]),r=n(e[1]);return Math.pow(t,r)},_signature:[{types:[0]},{types:[0]}]},find:{_func:function(e){var t=r(e[0]),i=r(e[1]),u=e.length>2?n(e[2]):0,a=i.indexOf(t,u);return-1===a?null:a},_signature:[{types:[2]},{types:[2]},{types:[0],optional:!0}]},left:{_func:function(e){var t=r(e[0]),i=e.length>1?n(e[1]):1;return i<0?null:t.substr(0,i)},_signature:[{types:[2]},{types:[0],optional:!0}]},right:{_func:function(e){var t=r(e[0]),i=e.length>1?n(e[1]):1;if(i<0)return null;var u=t.length-i;return t.substr(u,i)},_signature:[{types:[2]},{types:[0],optional:!0}]},mid:{_func:function(e){var t=r(e[0]),i=n(e[1]);if(i<0)return null;var u=n(e[2]);return t.substr(i,u)},_signature:[{types:[2]},{types:[0]},{types:[0]}]},proper:{_func:function(e){return r(e[0]).split(" ").map((function(e){return e.charAt(0).toUpperCase()+e.slice(1).toLowerCase()})).join(" ")},_signature:[{types:[2]}]},rept:{_func:function(e){var t=r(e[0]),i=n(e[1]);return i<0?null:t.repeat(i)},_signature:[{types:[2]},{types:[0]}]},replace:{_func:function(e){var t=r(e[0]),i=n(e[1]),u=n(e[2]),a=r(e[3]);return i<0?null:t.substr(0,i)+a+t.substr(i+u)},_signature:[{types:[2]},{types:[0]},{types:[0]},{types:[2]}]},round:{_func:function(e){var t=n(e[0]),r=n(e[1]);return Math.round(t*Math.pow(10,r))/Math.pow(10,r)},_signature:[{types:[0]},{types:[0]}]},sqrt:{_func:function(e){var t=Math.sqrt(n(e[0]));return Number.isNaN(t)?null:t},_signature:[{types:[0]}]},stdevp:{_func:function(e){var t=e[0]||[];if(0===t.length)return null;var r=t.map((function(e){return n(e)})),i=r.reduce((function(e,t){return e+t}),0)/t.length,u=r.reduce((function(e,t){return e+t*t}),0)/t.length,a=Math.sqrt(u-i*i);return Number.isNaN(a)?null:a},_signature:[{types:[8]}]},stdev:{_func:function(e){var t=e[0]||[];if(t.length<=1)return null;var r=t.map((function(e){return n(e)})),i=r.reduce((function(e,t){return e+t}),0)/t.length,u=r.reduce((function(e,t){return e+t*t}),0),a=Math.sqrt((u-t.length*i*i)/(t.length-1));return Number.isNaN(a)?null:a},_signature:[{types:[8]}]},trim:{_func:function(e){return r(e[0]).split(" ").filter((function(e){return e})).join(" ")},_signature:[{types:[2]}]},trunc:{_func:function(e){var t=n(e[0]),r=e.length>1?n(e[1]):0;return(t>=0?Math.floor:Math.ceil)(t*Math.pow(10,r))/Math.pow(10,r)},_signature:[{types:[0]},{types:[0],optional:!0}]},charCode:{_func:function(e){var t=n(e[0]);return Number.isInteger(t)?String.fromCharCode(t):null},_signature:[{types:[0]}]},codePoint:{_func:function(e){var t=r(e[0]);return 0===t.length?null:t.codePointAt(0)},_signature:[{types:[2]}]},date:{_func:function(e){var t=n(e[0]),r=n(e[1]),i=n(e[2]),u=Date.UTC(t,r-1,i);return Math.floor(u/864e5)},_signature:[{types:[0]},{types:[0]},{types:[0]}]},day:{_func:function(e){var t=n(e[0]);return new Date(864e5*t).getUTCDate()},_signature:[{types:[0]}]},month:{_func:function(e){var t=n(e[0]);return new Date(864e5*t).getUTCMonth()+1},_signature:[{types:[0]}]},year:{_func:function(e){var t=n(e[0]);return new Date(864e5*t).getUTCFullYear()},_signature:[{types:[0]}]},time:{_func:function(e){var t=(3600*n(e[0])+60*n(e[1])+n(e[2]))/86400;return t<0?null:t-Math.floor(t)},_signature:[{types:[0]},{types:[0]},{types:[0]}]},hour:{_func:function(e){var t=n(e[0]);return t<0?null:86400*t/3600%24},_signature:[{types:[0]}]},minute:{_func:function(e){var t=n(e[0]);return t<0?null:1440*t%60},_signature:[{types:[0]}]},second:{_func:function(e){var t=n(e[0]);return t<0?null:86400*t%60},_signature:[{types:[0]}]},now:{_func:function(){var e=new Date,t=e.getFullYear(),r=e.getMonth(),n=e.getDate(),i=e.getHours(),u=e.getMinutes(),a=e.getSeconds();return Date.UTC(t,r,n,i,u,a)/864e5},_signature:[]},today:{_func:function(){var e=new Date,t=e.getFullYear(),r=e.getMonth(),n=e.getDate();return Math.floor(Date.UTC(t,r,n)/864e5)},_signature:[]},weekday:{_func:function(e){var t=n(e[0]),r=e.length>1?n(e[1]):1,i=new Date(864e5*t).getUTCDay();switch(r){case 1:return i+1;case 2:return(i+6)%7+1;case 3:return(i+6)%7;default:return null}},_signature:[{types:[0]},{types:[0],optional:!0}]}}}function ft(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,i,u=[],a=!0,o=!1;try{for(r=r.call(e);!(a=(n=r.next()).done)&&(u.push(n.value),!t||u.length!==t);a=!0);}catch(e){o=!0,i=e}finally{try{a||null==r.return||r.return()}finally{if(o)throw i}}return u}}(e,t)||function(e,t){if(e){if("string"==typeof e)return ht(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?ht(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ht(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function pt(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function yt(e,t,r,n,i,u,a){var o=0,s=2;function c(t,r){return function(n){var u=e.visit(t,n);if(r.indexOf(i(u))<0){var a="TypeError: expected one of ".concat(r,", received ").concat(i(u));throw new Error(a)}return u}}return{abs:{_func:function(e){return Math.abs(e[0])},_signature:[{types:[o]}]},avg:{_func:function(e){for(var t=0,r=e[0],n=0;n<r.length;n+=1)t+=r[n];return t/r.length},_signature:[{types:[8]}]},ceil:{_func:function(e){return Math.ceil(e[0])},_signature:[{types:[o]}]},contains:{_func:function(e){return u(e[0]).indexOf(u(e[1]))>=0},_signature:[{types:[s,3]},{types:[1]}]},endsWith:{_func:function(e){var t=u(e[0]),r=u(e[1]);return-1!==t.indexOf(r,t.length-r.length)},_signature:[{types:[s]},{types:[s]}]},floor:{_func:function(e){return Math.floor(e[0])},_signature:[{types:[o]}]},length:{_func:function(e){var n=u(e[0]);return t(n)?Object.keys(n).length:r(n)?n.length:a(n).length},_signature:[{types:[s,3,4]}]},map:{_func:function(t){for(var r=[],n=t[0],i=t[1],u=0;u<i.length;u+=1)r.push(e.visit(n,i[u]));return r},_signature:[{types:[6]},{types:[3]}]},max:{_func:function(e){return e[0].length>0?i(e[0][0])===o?e[0].reduce((function(e,t){return n(e)>=n(t)?e:t}),e[0][0]):e[0].reduce((function(e,t){return a(t).localeCompare(a(e))<0?e:t}),e[0][0]):null},_signature:[{types:[3,8,9]}]},merge:{_func:function(e){for(var t={},r=function(r){var n=e[r];Object.keys(n).forEach((function(e){t[e]=n[e]}))},n=0;n<e.length;n+=1)r(n);return t},_signature:[{types:[4],variadic:!0}]},maxBy:{_func:function(e){for(var t,r,n=e[1],i=e[0],u=c(n,[o,s]),a=-1/0,l=0;l<i.length;l+=1)(r=u(i[l]))>a&&(a=r,t=i[l]);return t},_signature:[{types:[3]},{types:[6]}]},sum:{_func:function(e){for(var t=0,r=e[0],n=0;n<r.length;n+=1)t+=1*r[n];return t},_signature:[{types:[8]}]},startsWith:{_func:function(e){return 0===u(e[0]).lastIndexOf(u(e[1]))},_signature:[{types:[s]},{types:[s]}]},min:{_func:function(e){if(e[0].length>0){if(i(e[0][0])===o)return e[0].reduce((function(e,t){return n(e)<=n(t)?e:t}),e[0][0]);for(var t=e[0],r=t[0],u=1;u<t.length;u+=1)a(t[u]).localeCompare(a(r))<0&&(r=t[u]);return r}return null},_signature:[{types:[3,8,9]}]},minBy:{_func:function(e){for(var t,r,n=e[1],i=e[0],u=c(n,[o,s]),a=1/0,l=0;l<i.length;l+=1)(r=u(i[l]))<a&&(a=r,t=i[l]);return t},_signature:[{types:[3]},{types:[6]}]},type:{_func:function(e){var t;return(t={},pt(t,o,"number"),pt(t,s,"string"),pt(t,3,"array"),pt(t,4,"object"),pt(t,5,"boolean"),pt(t,6,"expref"),pt(t,7,"null"),t)[i(e[0])]},_signature:[{types:[1]}]},keys:{_func:function(e){return Object.keys(e[0])},_signature:[{types:[1]}]},values:{_func:function(e){return Object.values(e[0])},_signature:[{types:[1]}]},sort:{_func:function(e){var t=e[0].slice(0);if(t.length>0){var r=i(e[0][0])===o?n:a;t.sort((function(e,t){var n=r(e),i=r(t);return n<i?-1:n>i?1:0}))}return t},_signature:[{types:[3,9,8]}]},sortBy:{_func:function(t){var r=t[0].slice(0);if(0===r.length)return r;var n=t[1],u=i(e.visit(n,r[0]));if([o,s].indexOf(u)<0)throw new Error("TypeError");for(var a=[],c=0;c<r.length;c+=1)a.push([c,r[c]]);a.sort((function(t,r){var a=e.visit(n,t[1]),o=e.visit(n,r[1]);if(i(a)!==u)throw new Error("TypeError: expected ".concat(u,", received ").concat(i(a)));if(i(o)!==u)throw new Error("TypeError: expected ".concat(u,", received ").concat(i(o)));return a>o?1:a<o?-1:t[0]-r[0]}));for(var l=0;l<a.length;l+=1){var f=ft(a[l],2);r[l]=f[1]}return r},_signature:[{types:[3]},{types:[6]}]},join:{_func:function(e){var t=e[0];return e[1].join(t)},_signature:[{types:[s]},{types:[9]}]},reverse:{_func:function(e){var t=u(e[0]);if(i(t)===s){for(var r="",n=t.length-1;n>=0;n-=1)r+=t[n];return r}var a=e[0].slice(0);return a.reverse(),a},_signature:[{types:[s,3]}]},toArray:{_func:function(e){return 3===i(e[0])?e[0]:[e[0]]},_signature:[{types:[1]}]},toString:{_func:function(e){return i(e[0])===s?e[0]:JSON.stringify(e[0])},_signature:[{types:[1]}]},toNumber:{_func:function(e){var t=i(e[0]);return t===o?e[0]:t===s?n(e[0]):null},_signature:[{types:[1]}]},notNull:{_func:function(e){for(var t=0;t<e.length;t+=1)if(7!==i(e[t]))return e[t];return null},_signature:[{types:[1],variadic:!0}]}}}function vt(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function dt(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?vt(Object(r),!0).forEach((function(t){_t(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):vt(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function _t(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function gt(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function mt(e){return mt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},mt(e)}const bt=new function(){var e;function t(e){return null==e?"":e.toString()}var r=function(){function r(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r)}var n,i;return n=r,i=[{key:"addFunctions",value:function(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.functionTable=dt(dt(dt({},yt(this._interpreter,pe,he,e,ce,ye,t)),lt(this._interpreter,ye,t,e)),r)}},{key:"callFunction",value:function(t,r,n){var i=this.functionTable[t];if(void 0===i)throw new Error("Unknown function: ".concat(t,"()"));return function(t,r,n){if(0!==n.length){var i,u,a;if(n[n.length-1].variadic){if(r.length<n.length)throw i=1===n.length?" argument":" arguments",new Error("ArgumentError: ".concat(t,"() ")+"takes at least".concat(n.length).concat(i," but received ").concat(r.length))}else if(r.length!==n.length&&!n[n.length-1].optional)throw i=1===n.length?" argument":" arguments",new Error("ArgumentError: ".concat(t,"() ")+"takes ".concat(n.length).concat(i," but received ").concat(r.length));for(var o=Math.min(n.length,r.length),s=0;s<o;s+=1)u=n[s].types,c=r[s],l=u,f=void 0,null!==(f=c)&&!Array.isArray(f)&&"object"===mt(f)&&"Object"!==f.constructor.name&&l.includes(10)||(a=le(r[s]),r[s]=fe(a,u,r[s],t,e))}var c,l,f}(t,r,i._signature),i._func.call(this,r,n)}}],i&&gt(n.prototype,i),Object.defineProperty(n,"prototype",{writable:!1}),r}();this.tokenize=function(e){return(new K).tokenize(e)},this.compile=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],r=new ct(t),n=r.parse(e);return n},this.search=function(t,n,i,u,a){var o,s=new r(u),c=new Oe(s,i,e);return s._interpreter=c,s.addFunctions(u),o=a||function(e){var t=+e;return Number.isNaN(t)?0:t},e=function(e){var t=ye(e);if(null===t)return null;if(t instanceof Array)return 0;if("number"==typeof t)return t;if("string"==typeof t){var r=o(t);return Number.isNaN(r)?0:r}if("boolean"==typeof t)return t?1:0;throw new Error("need to coerce number")},c.search(t,n)},this.strictDeepEqual=ve};function wt(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function kt(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?wt(Object(r),!0).forEach((function(t){Ot(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):wt(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function Ot(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function St(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function jt(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var Et=function(){function e(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[];St(this,e),this.expression=t,this.customFunctions=r,this.stringToNumber=n,this.node=bt.compile(t,i)}var t,r;return t=e,(r=[{key:"search",value:function(e,t){return bt.search(this.node,e,t,kt({},this.customFunctions),this.stringToNumber)}}])&&jt(t.prototype,r),Object.defineProperty(t,"prototype",{writable:!1}),e}();function xt(e){return xt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},xt(e)}function Pt(e){return function(e){if(Array.isArray(e))return Nt(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return Nt(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?Nt(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Nt(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function Tt(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function It(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function At(e,t,r){return t&&It(e.prototype,t),r&&It(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function Mt(e,t,r){var n=[];if(r instanceof Array)e[t]=[],r.forEach((function(r,i){var u=Mt(e[t],i,r);n.push.apply(n,Pt(u))}));else if(null!==r&&"object"===xt(r))e[t]={},Object.keys(r).forEach((function(i){var u=Mt(e[t],i,r[i]);n.push.apply(n,Pt(u))}));else{var i=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];return new(function(){function i(){Tt(this,i)}return At(i,[{key:"valueOf",value:function(){return t}},{key:"toString",value:function(){return t.toString()}},{key:"toJSON",value:function(){return t}},{key:"$value",get:function(){return t}},{key:"$name",get:function(){return e}},{key:"$readonly",get:function(){return r}},{key:"$required",get:function(){return n}}]),i}())}(t,r);e[t]=i,n.push(i)}return n}var Ct=function(){function e(t,r){var n=this;Tt(this,e),this.fieldData=t,this.allFields=Mt(t,"data",r),Object.keys(t.data).forEach((function(e){n[e]=t.data[e]}))}return At(e,[{key:"valueOf",value:function(){return this.fieldData}},{key:"stringify",value:function(){return JSON.stringify(this.fieldData.data,null,2)}},{key:"$fields",get:function(){return this.allFields}}]),e}();function Dt(e){return Dt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Dt(e)}window.addEventListener("load",(function(){var e=document.getElementById("data"),t=document.getElementById("expression"),r=document.getElementById("result"),n=window.localStorage.getItem("data");n&&(e.value=n);var i=window.localStorage.getItem("expression");function u(){window.localStorage.setItem("data",e.value),window.localStorage.setItem("expression",t.value);var n,i=t.value,u=document.getElementById("use-fields").checked,a=null,o={};try{n=JSON.parse(e.value),u&&(a=new Ct(o,n))}catch(e){return void(r.value=e.toString())}try{var s=function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;return new Et(r,n,i,Object.keys(t)).search(e,t,kt({},n),i)}(u?o.data:n,{$form:a,$:{}},i,!0),c=null==s?s:s.valueOf();"object"===Dt(c)?r.value=JSON.stringify(c,null,2):r.value=c}catch(e){r.value=e.toString()}}i&&(t.value=i),e.addEventListener("blur",u),t.addEventListener("blur",u),u(),fetch("../antlr/JSONFormula.g4").then((function(e){e.text().then((function(e){document.getElementById("grammar-out").innerHTML=e}))}))})),JSONFormula=e})();
//# sourceMappingURL=tutorial.js.map