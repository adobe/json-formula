var JSONFormula;(()=>{"use strict";var e={};(e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})})(e);const t="UnquotedIdentifier",r="QuotedIdentifier",n="Rbracket",i="Rparen",u="Comma",o="Colon",a="Concatenate",c="Rbrace",s="Number",l="Current",f="Global",h="Expref",p="Pipe",y="Subtract",v="Multiply",d="Power",_="Union",g="Divide",b="Flatten",m="Star",w="Filter",S="Lbrace",O="Lbracket",E="Lparen",k="Literal";var j;function x(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function P(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var A=0,I=2,T=3,N=5,M=7,C=8,F=9,D=h,L=(P(j={},A,"number"),P(j,1,"any"),P(j,I,"string"),P(j,T,"array"),P(j,4,"object"),P(j,N,"boolean"),P(j,6,"expression"),P(j,M,"null"),P(j,C,"Array<number>"),P(j,F,"Array<string>"),P(j,10,"class"),P(j,11,"Array<array>"),j);function U(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(null===e)return M;var r=e;if(t){if("function"!=typeof e.valueOf)return 4;r=e.valueOf.call(e)}switch(Object.prototype.toString.call(r)){case"[object String]":return I;case"[object Number]":return A;case"[object Array]":return T;case"[object Boolean]":return N;case"[object Null]":return M;case"[object Object]":return r.jmespathType===D?6:4;default:return 4}}function R(e){return[U(e),U(e,!1)]}function H(e,t,r,n,i,u){var o=e[0];if(-1!==t.findIndex((function(e){return 1===e||o===e})))return r;var a=!1;if((4===o||1===t.length&&10===t[0])&&(a=!0),o===T&&1===t.length&&4===t[0]&&(a=!0),t.includes(11)){if(o===T&&(r.forEach((function(e){e instanceof Array||(a=!0)})),!a))return r;a=!0}if(a)throw new Error("TypeError: ".concat(n," expected argument to be type ").concat(L[t[0]]," but received type ").concat(L[o]," instead."));var c=-1;if(o===T&&t.includes(F)&&t.includes(C)&&(c=r.length>0&&"string"==typeof r[0]?F:C),-1===c&&[F,C,T].includes(o)&&(c=t.find((function(e){return[F,C,T].includes(e)}))),-1===c&&(c=function(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,i,u=[],o=!0,a=!1;try{for(r=r.call(e);!(o=(n=r.next()).done)&&(u.push(n.value),!t||u.length!==t);o=!0);}catch(e){a=!0,i=e}finally{try{o||null==r.return||r.return()}finally{if(a)throw i}}return u}}(e,t)||function(e,t){if(e){if("string"==typeof e)return x(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?x(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}(t,1)[0]),1===c)return r;if(c===F||c===C||c===T){if(c===T)return o===C||o===F?r:null===r?[]:[r];var s=c===C?A:I;if(o===T){for(var l=r.slice(),f=0;f<l.length;f+=1){var h=R(l[f]);l[f]=H(h,[s],l[f],n,i,u)}return l}if([A,I,M,N].includes(s))return[H(e,[s],r,n,i,u)]}else{if(c===A)return[I,N,M].includes(o)?i(r):0;if(c===I)return o===M||4===o?"":u(r);if(c===N)return!!r;if(4===c&&4===e[1])return r}throw new Error("unhandled argument")}function G(e){return null!==e&&"[object Array]"===Object.prototype.toString.call(e)}function $(e){return null!==e&&"[object Object]"===Object.prototype.toString.call(e)}function B(e){return null==e?e:G(e)?e.map((function(e){return B(e)})):"function"!=typeof e.valueOf?e:e.valueOf()}function q(e,t){var r=B(e),n=B(t);if(r===n)return!0;if(Object.prototype.toString.call(r)!==Object.prototype.toString.call(n))return!1;if(!0===G(r)){if(r.length!==n.length)return!1;for(var i=0;i<r.length;i+=1)if(!1===q(r[i],n[i]))return!1;return!0}if(!0===$(r)){var u={};for(var o in r)if(hasOwnProperty.call(r,o)){if(!1===q(r[o],n[o]))return!1;u[o]=!0}for(var a in n)if(hasOwnProperty.call(n,a)&&!0!==u[a])return!1;return!0}return!1}function J(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Q(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,i,u=[],o=!0,a=!1;try{for(r=r.call(e);!(o=(n=r.next()).done)&&(u.push(n.value),!t||u.length!==t);o=!0);}catch(e){a=!0,i=e}finally{try{o||null==r.return||r.return()}finally{if(a)throw i}}return u}}(e,t)||Y(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Y(e,t){if(e){if("string"==typeof e)return z(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?z(e,t):void 0}}function z(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function V(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Z(e){if(null===e)return!0;var t=B(e);if(""===t||!1===t||null===t)return!0;if(G(t)&&0===t.length)return!0;if($(t)){for(var r in t)if(Object.prototype.hasOwnProperty.call(t,r))return!1;return!0}return!t}var W=function(){function e(t,r,n,i,u,o){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.runtime=t,this.globals=r,this.toNumber=n,this.toString=i,this.debug=u,this.language=o}var t,r;return t=e,(r=[{key:"search",value:function(e,t){return this.visit(e,t)}},{key:"visit",value:function(e,t){var r,n=this,i=(J(r={Field:function(e,t){if(null!==t&&($(t)||G(t))){var r=t[e.name];if("function"==typeof r&&(r=void 0),void 0===r){try{n.debug.push("Failed to find: '".concat(e.name,"'"));var i=Object.keys(t).map((function(e){return"'".concat(e,"'")})).toString();i.length&&n.debug.push("Available fields: ".concat(i))}catch(e){}return null}return r}return null},Subexpression:function(e,t){for(var r=n.visit(e.children[0],t),i=1;i<e.children.length;i+=1)if(null===(r=n.visit(e.children[1],r)))return null;return r},IndexExpression:function(e,t){var r=n.visit(e.children[0],t);return n.visit(e.children[1],r)},Index:function(e,t){if(G(t)){var r=n.toNumber(n.visit(e.value,t));r<0&&(r=t.length+r);var i=t[r];return void 0===i?(n.debug.push("Index ".concat(r," out of range")),null):i}if($(t)){var u=n.toString(n.visit(e.value,t)),o=t[u];return void 0===o?(n.debug.push("Key ".concat(u," does not exist")),null):o}return n.debug.push("left side of index expression ".concat(t," is not an array or object.")),null},Slice:function(e,t){if(!G(t))return null;var r=e.children.slice(0).map((function(e){return null!=e?n.toNumber(n.visit(e,t)):null})),i=Q(n.computeSliceParams(t.length,r),3),u=i[0],o=i[1],a=i[2],c=[];if(a>0)for(var s=u;s<o;s+=a)c.push(t[s]);else for(var l=u;l>o;l+=a)c.push(t[l]);return c},Projection:function(e,t){var r=n.visit(e.children[0],t);if(!G(r))return null;var i=[];return r.forEach((function(t){var r=n.visit(e.children[1],t);null!==r&&i.push(r)})),i},ValueProjection:function(e,t){var r=n.visit(e.children[0],t);if(!$(B(r)))return null;var i,u=[];return(i=r,Object.values(i)).forEach((function(t){var r=n.visit(e.children[1],t);null!==r&&u.push(r)})),u},FilterProjection:function(e,t){var r=n.visit(e.children[0],t);if(!G(r))return null;var i=r.filter((function(t){return!Z(n.visit(e.children[2],t))})),u=[];return i.forEach((function(t){var r=n.visit(e.children[1],t);null!==r&&u.push(r)})),u},Comparator:function(e,t){var r=n.visit(e.children[0],t),i=n.visit(e.children[1],t);if("EQ"===e.name)return q(r,i);if("NE"===e.name)return!q(r,i);if("GT"===e.name)return r>i;if("GTE"===e.name)return r>=i;if("LT"===e.name)return r<i;if("LTE"===e.name)return r<=i;throw new Error("Unknown comparator: ".concat(e.name))}},"Flatten",(function(e,t){var r=n.visit(e.children[0],t);if(!G(r))return null;var i=[];return r.forEach((function(e){var t;G(e)?i.push.apply(i,function(e){if(Array.isArray(e))return z(e)}(t=e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(t)||Y(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()):i.push(e)})),i})),J(r,"Identity",(function(e,t){return t})),J(r,"MultiSelectList",(function(e,t){return null===t?null:e.children.map((function(e){return n.visit(e,t)}))})),J(r,"MultiSelectHash",(function(e,t){if(null===t)return null;var r={};return e.children.forEach((function(e){r[e.name]=n.visit(e.value,t)})),r})),J(r,"OrExpression",(function(e,t){var r=n.visit(e.children[0],t);return Z(r)&&(r=n.visit(e.children[1],t)),r})),J(r,"AndExpression",(function(e,t){var r=n.visit(e.children[0],t);return!0===Z(r)?r:n.visit(e.children[1],t)})),J(r,"AddExpression",(function(e,t){var r=n.visit(e.children[0],t),i=n.visit(e.children[1],t);return n.applyOperator(r,i,"+")})),J(r,"ConcatenateExpression",(function(e,t){var r=n.visit(e.children[0],t),i=n.visit(e.children[1],t);return r=H(R(r),[2,9],r,"concatenate",n.toNumber,n.toString),i=H(R(i),[2,9],i,"concatenate",n.toNumber,n.toString),n.applyOperator(r,i,"&")})),J(r,"UnionExpression",(function(e,t){var r=n.visit(e.children[0],t),i=n.visit(e.children[1],t);return r=H(R(r),[3],r,"union",n.toNumber,n.toString),i=H(R(i),[3],i,"union",n.toNumber,n.toString),r.concat(i)})),J(r,"SubtractExpression",(function(e,t){var r=n.visit(e.children[0],t),i=n.visit(e.children[1],t);return n.applyOperator(r,i,"-")})),J(r,"MultiplyExpression",(function(e,t){var r=n.visit(e.children[0],t),i=n.visit(e.children[1],t);return n.applyOperator(r,i,"*")})),J(r,"DivideExpression",(function(e,t){var r=n.visit(e.children[0],t),i=n.visit(e.children[1],t);return n.applyOperator(r,i,"/")})),J(r,"PowerExpression",(function(e,t){var r=n.visit(e.children[0],t),i=n.visit(e.children[1],t);return n.applyOperator(r,i,"^")})),J(r,"NotExpression",(function(e,t){return Z(n.visit(e.children[0],t))})),J(r,"Literal",(function(e){return e.value})),J(r,"Number",(function(e){return e.value})),J(r,"Pipe",(function(e,t){var r=n.visit(e.children[0],t);return n.visit(e.children[1],r)})),J(r,"Current",(function(e,t){return t})),J(r,"Global",(function(e){var t=n.globals[e.name];return void 0===t?null:t})),J(r,"Function",(function(e,t){if("if"===e.name)return n.runtime.callFunction(e.name,e.children,t,n,!1);var r=e.children.map((function(e){return n.visit(e,t)}));return n.runtime.callFunction(e.name,r,t,n)})),J(r,"ExpressionReference",(function(e){var t=Q(e.children,1)[0];return t.jmespathType="Expref",t})),r),u=e&&i[e.type];if(!u)throw new Error("Unknown/missing node type ".concat(e&&e.type||""));return u(e,t)}},{key:"computeSliceParams",value:function(e,t){function r(e,t,r){var n=t;return n<0?(n+=e)<0&&(n=r<0?-1:0):n>=e&&(n=r<0?e-1:e),n}var n=Q(t,3),i=n[0],u=n[1],o=n[2];if(null===o)o=1;else if(0===o){var a=new Error("Invalid slice, step cannot be 0");throw a.name="RuntimeError",a}var c=o<0;return[i=null===i?c?e-1:0:r(e,i,o),u=null===u?c?-1:e:r(e,u,o),o]}},{key:"applyOperator",value:function(e,t,r){var n=this;if(G(e)&&G(t)){var i=e.length<t.length?e:t,u=Math.abs(e.length-t.length);i.length+=u,i.fill(null,i.length-u);for(var o=[],a=0;a<e.length;a+=1)o.push(this.applyOperator(e[a],t[a],r));return o}if(G(e))return e.map((function(e){return n.applyOperator(e,t,r)}));if(G(t))return t.map((function(t){return n.applyOperator(e,t,r)}));if("*"===r)return this.toNumber(e)*this.toNumber(t);if("&"===r)return e+t;if("+"===r)return this.toNumber(e)+this.toNumber(t);if("-"===r)return this.toNumber(e)-this.toNumber(t);if("/"===r){var c=e/t;return Number.isFinite(c)?c:null}if("^"===r)return Math.pow(e,t);throw new Error("Unknown operator: ".concat(r))}}])&&V(t.prototype,r),Object.defineProperty(t,"prototype",{writable:!1}),e}();function K(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function X(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var ee=t,te=r,re=n,ne=i,ie=u,ue=o,oe=s,ae=l,ce=p,se="Or",le="And",fe="Dot",he=O,pe=E,ye=k,ve={".":fe,",":ie,":":ue,"{":S,"}":c,"]":re,"(":pe,")":ne,"@":ae},de={"<":!0,">":!0,"=":!0,"!":!0},_e={" ":!0,"\t":!0,"\n":!0};function ge(e,t){return e>="0"&&e<="9"||t&&"-"===e||"."===e}function be(e){return e>="a"&&e<="z"||e>="A"&&e<="Z"||e>="0"&&e<="9"||"_"===e}function me(e,t){var r=e[t];return"$"===r?e.length>t&&be(e[t+1]):r>="a"&&r<="z"||r>="A"&&r<="Z"||"_"===r}var we,Se=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];K(this,e),this._allowedGlobalNames=t,this.debug=r}var t,r;return t=e,(r=[{key:"tokenize",value:function(e){var t,r,n,i=[];for(this._current=0;this._current<e.length;){var u=i.length?i.slice(-1)[0].type:null;if(this._isGlobal(u,e,this._current))i.push(this._consumeGlobal(e));else if(me(e,this._current))t=this._current,r=this._consumeUnquotedIdentifier(e),i.push({type:ee,value:r,start:t});else if(void 0!==ve[e[this._current]])i.push({type:ve[e[this._current]],value:e[this._current],start:this._current}),this._current+=1;else if("-"===e[this._current]&&![ae,oe,ne,ee,te,re].includes(u)||ge(e[this._current],!1))n=this._consumeNumber(e),i.push(n);else if("["===e[this._current])n=this._consumeLBracket(e),i.push(n);else if('"'===e[this._current])t=this._current,r=this._consumeQuotedIdentifier(e),i.push({type:te,value:r,start:t});else if("'"===e[this._current])t=this._current,r=this._consumeRawStringLiteral(e),i.push({type:ye,value:r,start:t});else if("`"===e[this._current]){t=this._current;var o=this._consumeLiteral(e);i.push({type:ye,value:o,start:t})}else if(void 0!==de[e[this._current]])i.push(this._consumeOperator(e));else if(void 0!==_e[e[this._current]])this._current+=1;else if("&"===e[this._current])t=this._current,this._current+=1,"&"===e[this._current]?(this._current+=1,i.push({type:le,value:"&&",start:t})):u===ie||u===pe?i.push({type:"Expref",value:"&",start:t}):i.push({type:"Concatenate",value:"&",start:t});else if("~"===e[this._current])t=this._current,this._current+=1,i.push({type:"Union",value:"~",start:t});else if("+"===e[this._current])t=this._current,this._current+=1,i.push({type:"Add",value:"+",start:t});else if("-"===e[this._current])t=this._current,this._current+=1,i.push({type:"Subtract",value:"-",start:t});else if("*"===e[this._current]){t=this._current,this._current+=1;var a=i.length&&i.slice(-1)[0].type;0===i.length||[he,fe,ce,le,se,ie,ue].includes(a)?i.push({type:"Star",value:"*",start:t}):i.push({type:"Multiply",value:"*",start:t})}else if("/"===e[this._current])t=this._current,this._current+=1,i.push({type:"Divide",value:"/",start:t});else if("^"===e[this._current])t=this._current,this._current+=1,i.push({type:"Power",value:"^",start:t});else{if("|"!==e[this._current]){var c=new Error("Unknown character:".concat(e[this._current]));throw c.name="LexerError",c}t=this._current,this._current+=1,"|"===e[this._current]?(this._current+=1,i.push({type:se,value:"||",start:t})):i.push({type:ce,value:"|",start:t})}}return i}},{key:"_consumeUnquotedIdentifier",value:function(e){var t=this._current;for(this._current+=1;this._current<e.length&&be(e[this._current]);)this._current+=1;return e.slice(t,this._current)}},{key:"_consumeQuotedIdentifier",value:function(e){var t=this._current;this._current+=1;for(var r=e.length,n=!me(e,t+1);'"'!==e[this._current]&&this._current<r;){var i=this._current;be(e[i])||(n=!0),"\\"!==e[i]||"\\"!==e[i+1]&&'"'!==e[i+1]?i+=1:i+=2,this._current=i}this._current+=1;var u=e.slice(t,this._current);try{n&&!u.includes(" ")||(this.debug.push("Suspicious quotes: ".concat(u)),this.debug.push("Did you intend a literal? '".concat(u.replace(/"/g,""),"'?")))}catch(e){}return JSON.parse(u)}},{key:"_consumeRawStringLiteral",value:function(e){var t=this._current;this._current+=1;for(var r=e.length;"'"!==e[this._current]&&this._current<r;){var n=this._current;"\\"!==e[n]||"\\"!==e[n+1]&&"'"!==e[n+1]?n+=1:n+=2,this._current=n}return this._current+=1,e.slice(t+1,this._current-1).replaceAll("\\'","'")}},{key:"_consumeNumber",value:function(e){var t=this._current;this._current+=1;for(var r=e.length;ge(e[this._current],!1)&&this._current<r;)this._current+=1;var n,i=e.slice(t,this._current);return n=i.includes(".")?parseFloat(i):parseInt(i,10),{type:oe,value:n,start:t}}},{key:"_consumeLBracket",value:function(e){var t=this._current;return this._current+=1,"?"===e[this._current]?(this._current+=1,{type:"Filter",value:"[?",start:t}):"]"===e[this._current]?(this._current+=1,{type:"Flatten",value:"[]",start:t}):{type:he,value:"[",start:t}}},{key:"_isGlobal",value:function(e,t,r){if(null!==e&&e===fe)return!1;if("$"!==t[r])return!1;for(var n=r+1;n<t.length&&be(t[n]);)n+=1;var i=t.slice(r,n);return this._allowedGlobalNames.includes(i)}},{key:"_consumeGlobal",value:function(e){var t=this._current;for(this._current+=1;this._current<e.length&&be(e[this._current]);)this._current+=1;return{type:"Global",name:e.slice(t,this._current),start:t}}},{key:"_consumeOperator",value:function(e){var t=this._current,r=e[t];return this._current+=1,"!"===r?"="===e[this._current]?(this._current+=1,{type:"NE",value:"!=",start:t}):{type:"Not",value:"!",start:t}:"<"===r?"="===e[this._current]?(this._current+=1,{type:"LTE",value:"<=",start:t}):{type:"LT",value:"<",start:t}:">"===r?"="===e[this._current]?(this._current+=1,{type:"GTE",value:">=",start:t}):{type:"GT",value:">",start:t}:"="===e[this._current]?(this._current+=1,{type:"EQ",value:"==",start:t}):{type:"EQ",value:"=",start:t}}},{key:"_consumeLiteral",value:function(e){this._current+=1;for(var t,r=this._current,n=e.length,i=!1;(i||"`"!==e[this._current])&&this._current<n;){var u=this._current;i&&"\\"===e[u]&&'"'===e[u+1]?u+=2:('"'===e[u]&&(i=!i),i&&"`"===e[u+1]?u+=2:"\\"!==e[u]||"\\"!==e[u+1]&&"`"!==e[u+1]?u+=1:u+=2),this._current=u}var o=e.slice(r,this._current).trimStart();return t=function(e){if(""===e)return!1;if('[{"'.includes(e[0]))return!0;if(["true","false","null"].includes(e))return!0;if(!"-0123456789".includes(e[0]))return!1;try{return JSON.parse(e),!0}catch(e){return!1}}(o=o.replaceAll("\\`","`"))?JSON.parse(o):JSON.parse('"'.concat(o,'"')),this._current+=1,t}}])&&X(t.prototype,r),Object.defineProperty(t,"prototype",{writable:!1}),e}();function Oe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Ee(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function ke(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var je=o,xe="EOF",Pe=t,Ae=r,Ie=n,Te=i,Ne=u,Me=a,Ce=c,Fe=s,De=l,Le=f,Ue="Field",Re=h,He=p,Ge=y,$e=v,Be=d,qe=g,Je=_,Qe=b,Ye=m,ze=w,Ve="Dot",Ze=S,We=O,Ke=E,Xe=(ke(we={},xe,0),ke(we,Pe,0),ke(we,Ae,0),ke(we,Ie,0),ke(we,Te,0),ke(we,Ne,0),ke(we,Ce,0),ke(we,Fe,0),ke(we,De,0),ke(we,Le,0),ke(we,Ue,0),ke(we,Re,0),ke(we,He,1),ke(we,"Or",2),ke(we,"And",3),ke(we,"Add",6),ke(we,Ge,6),ke(we,Me,7),ke(we,$e,7),ke(we,qe,7),ke(we,Be,7),ke(we,Je,7),ke(we,"EQ",5),ke(we,"GT",5),ke(we,"LT",5),ke(we,"GTE",5),ke(we,"LTE",5),ke(we,"NE",5),ke(we,Qe,9),ke(we,Ye,20),ke(we,ze,21),ke(we,Ve,40),ke(we,"Not",45),ke(we,Ze,50),ke(we,We,55),ke(we,Ke,60),we),et=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];Oe(this,e),this._allowedGlobalNames=t}var t,r;return t=e,(r=[{key:"parse",value:function(e,t){this._loadTokens(e,t),this.index=0;var r=this.expression(0);if(this._lookahead(0)!==xe){var n=this._lookaheadToken(0),i=new Error("Unexpected token type: ".concat(n.type,", value: ").concat(n.value));throw i.name="ParserError",i}return r}},{key:"_loadTokens",value:function(e,t){var r=new Se(this._allowedGlobalNames,t).tokenize(e);r.push({type:xe,value:"",start:e.length}),this.tokens=r}},{key:"expression",value:function(e){var t=this._lookaheadToken(0);this._advance();for(var r=this.nud(t),n=this._lookahead(0);e<Xe[n];)this._advance(),r=this.led(n,r),n=this._lookahead(0);return r}},{key:"_lookahead",value:function(e){return this.tokens[this.index+e].type}},{key:"_lookaheadToken",value:function(e){return this.tokens[this.index+e]}},{key:"_advance",value:function(){this.index+=1}},{key:"_getIndex",value:function(){return this.index}},{key:"_setIndex",value:function(e){this.index=e}},{key:"nud",value:function(e){var t,r,n;switch(e.type){case"Literal":return{type:"Literal",value:e.value};case Fe:return{type:"Number",value:e.value};case Pe:return{type:"Field",name:e.value};case Ae:if(r={type:"Field",name:e.value},this._lookahead(0)===Ke)throw new Error("Quoted identifier not allowed for function names.");return r;case"Not":return{type:"NotExpression",children:[this.expression(Xe.Not)]};case Ye:return{type:"ValueProjection",children:[{type:"Identity"},this._lookahead(0)===Ie?{type:"Identity"}:this._parseProjectionRHS(Xe.Star)]};case ze:return this.led(e.type,{type:"Identity"});case Ze:return this._parseMultiselectHash();case Qe:return{type:"Projection",children:[{type:Qe,children:[{type:"Identity"}]},this._parseProjectionRHS(Xe.Flatten)]};case We:return this._lookahead(0)===Ye&&this._lookahead(1)===Ie?(this._advance(),this._advance(),{type:"Projection",children:[{type:"Identity"},this._parseProjectionRHS(Xe.Star)]}):this._parseUnchainedIndexExpression();case De:return{type:De};case Le:return{type:Le,name:e.name};case Ue:return{type:Ue};case Re:return{type:"ExpressionReference",children:[t=this.expression(Xe.Expref)]};case Ke:for(n=[];this._lookahead(0)!==Te;)t=this.expression(0),n.push(t);return this._match(Te),n[0];default:this._errorToken(e)}}},{key:"led",value:function(e,t){var r,n,i,u,o,a;switch(e){case Me:return{type:"ConcatenateExpression",children:[t,n=this.expression(Xe.Concatenate)]};case Ve:return a=Xe.Dot,this._lookahead(0)!==Ye?{type:"Subexpression",children:[t,n=this._parseDotRHS(a)]}:(this._advance(),{type:"ValueProjection",children:[t,n=this._parseProjectionRHS(a)]});case He:return n=this.expression(Xe.Pipe),{type:He,children:[t,n]};case"Or":return{type:"OrExpression",children:[t,n=this.expression(Xe.Or)]};case"And":return{type:"AndExpression",children:[t,n=this.expression(Xe.And)]};case"Add":return{type:"AddExpression",children:[t,n=this.expression(Xe.Add)]};case Ge:return{type:"SubtractExpression",children:[t,n=this.expression(Xe.Subtract)]};case $e:return{type:"MultiplyExpression",children:[t,n=this.expression(Xe.Multiply)]};case qe:return{type:"DivideExpression",children:[t,n=this.expression(Xe.Divide)]};case Be:return{type:"PowerExpression",children:[t,n=this.expression(Xe.Power)]};case Je:return{type:"UnionExpression",children:[t,n=this.expression(Xe.Power)]};case Ke:for(i=t.name,u=[];this._lookahead(0)!==Te;)o=this.expression(0),this._lookahead(0)===Ne&&this._match(Ne),u.push(o);return this._match(Te),{type:"Function",name:i,children:u};case ze:return r=this.expression(0),this._match(Ie),{type:"FilterProjection",children:[t,n=this._lookahead(0)===Qe?{type:"Identity"}:this._parseProjectionRHS(Xe.Filter),r]};case Qe:return{type:"Projection",children:[{type:Qe,children:[t]},this._parseProjectionRHS(Xe.Flatten)]};case"EQ":case"NE":case"GT":case"GTE":case"LT":case"LTE":return this._parseComparator(t,e);case We:return this._lookahead(0)===Ye&&this._lookahead(1)===Ie?(this._advance(),this._advance(),{type:"Projection",children:[t,n=this._parseProjectionRHS(Xe.Star)]}):(n=this._parseChainedIndexExpression(),this._projectIfSlice(t,n));default:this._errorToken(this._lookaheadToken(0))}}},{key:"_match",value:function(e){if(this._lookahead(0)!==e){var t=this._lookaheadToken(0),r=new Error("Expected ".concat(e,", got: ").concat(t.type));throw r.name="ParserError",r}this._advance()}},{key:"_errorToken",value:function(e){var t=new Error("Invalid token (".concat(e.type,'): "').concat(e.value,'"'));throw t.name="ParserError",t}},{key:"_parseChainedIndexExpression",value:function(){var e=this._getIndex();if(this._lookahead(0)===je)return this._parseSliceExpression();var t=this.expression(0);return this._lookahead(0)===je?(this._setIndex(e),this._parseSliceExpression()):(this._match(Ie),{type:"Index",value:t})}},{key:"_parseUnchainedIndexExpression",value:function(){var e=this._getIndex(),t=this._lookahead(0);if(t===je){var r=this._parseSliceExpression();return this._projectIfSlice({type:"Identity"},r)}var n=this.expression(0),i=this._lookahead(0);if(i===Ne)return this._setIndex(e),this._parseMultiselectList();if(i===je){this._setIndex(e);var u=this._parseSliceExpression();return this._projectIfSlice({type:"Identity"},u)}return t===Fe?(this._match(Ie),{type:"Index",value:n}):(this._setIndex(e),this._parseMultiselectList())}},{key:"_projectIfSlice",value:function(e,t){var r={type:"IndexExpression",children:[e,t]};return"Slice"===t.type?{type:"Projection",children:[r,this._parseProjectionRHS(Xe.Star)]}:r}},{key:"_parseSliceExpression",value:function(){for(var e=[null,null,null],t=0,r=this._lookahead(0);r!==Ie&&t<3;){if(r===je&&t<2)t+=1,this._advance();else{e[t]=this.expression(0);var n=this._lookahead(0);if(n!==je&&n!==Ie){var i=new Error("Syntax error, unexpected token: ".concat(n.value,"(").concat(n.type,")"));throw i.name="Parsererror",i}}r=this._lookahead(0)}return this._match(Ie),{type:"Slice",children:e}}},{key:"_parseComparator",value:function(e,t){return{type:"Comparator",name:t,children:[e,this.expression(Xe[t])]}}},{key:"_parseDotRHS",value:function(e){var t=this._lookahead(0);return[Pe,Ae,Ye].indexOf(t)>=0?this.expression(e):t===We?(this._match(We),this._parseMultiselectList()):t===Ze?(this._match(Ze),this._parseMultiselectHash()):void 0}},{key:"_parseProjectionRHS",value:function(e){var t;if(Xe[this._lookahead(0)]<10)t={type:"Identity"};else if(this._lookahead(0)===We)t=this.expression(e);else if(this._lookahead(0)===ze)t=this.expression(e);else{if(this._lookahead(0)!==Ve){var r=this._lookaheadToken(0),n=new Error("Sytanx error, unexpected token: ".concat(r.value,"(").concat(r.type,")"));throw n.name="ParserError",n}this._match(Ve),t=this._parseDotRHS(e)}return t}},{key:"_parseMultiselectList",value:function(){for(var e=[];this._lookahead(0)!==Ie;){var t=this.expression(0);if(e.push(t),this._lookahead(0)===Ne&&(this._match(Ne),this._lookahead(0)===Ie))throw new Error("Unexpected token Rbracket")}return this._match(Ie),{type:"MultiSelectList",children:e}}},{key:"_parseMultiselectHash",value:function(){var e,t,r,n=[],i=[Pe,Ae];if(this._lookahead(0)===Ce)return this._advance(),{type:"MultiSelectHash",children:[]};for(;;){if(e=this._lookaheadToken(0),i.indexOf(e.type)<0)throw new Error("Expecting an identifier token, got: ".concat(e.type));if(t=e.value,this._advance(),this._match(je),r={type:"KeyValuePair",name:t,value:this.expression(0)},n.push(r),this._lookahead(0)===Ne)this._match(Ne);else if(this._lookahead(0)===Ce){this._match(Ce);break}}return{type:"MultiSelectHash",children:n}}}])&&Ee(t.prototype,r),Object.defineProperty(t,"prototype",{writable:!1}),e}();function tt(e){return tt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},tt(e)}function rt(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,i,u=[],o=!0,a=!1;try{for(r=r.call(e);!(o=(n=r.next()).done)&&(u.push(n.value),!t||u.length!==t);o=!0);}catch(e){a=!0,i=e}finally{try{o||null==r.return||r.return()}finally{if(a)throw i}}return u}}(e,t)||function(e,t){if(e){if("string"==typeof e)return nt(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?nt(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function nt(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function it(e,t){var r=Math.pow(10,t);return Math.round(e*r)/r}var ut=864e5;function ot(e,t){if(null===e)return null;var r=Date.UTC(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes(),e.getSeconds(),e.getMilliseconds());return r+=function(e,t){var r=new Intl.DateTimeFormat("en-US",{timeZone:t,timeZoneName:"longOffset"}).format(e),n=/GMT([+\-−])?(\d{1,2}):?(\d{0,2})?/.exec(r);if(!n)return 0;var i=rt(n.slice(1),3),u=i[0],o=60*(60*(i[1]||0)+1*(i[2]||0))*1e3;return"-"===u?-1*o:o}(e,t),new Date(r)}function at(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[];return{and:{_func:function(t){var r=!!e(t[0]);return t.slice(1).forEach((function(t){r=r&&!!e(t)})),r},_signature:[{types:[1],variadic:!0}]},casefold:{_func:function(e,r,n){return t(e[0]).toLocaleUpperCase(n.language).toLocaleLowerCase(n.language)},_signature:[{types:[2]}]},datedif:{_func:function(e){var n=r(e[0]),i=r(e[1]),u=t(e[2]).toLowerCase();if(i===n)return 0;if(i<n)return null;if("d"===u)return Math.floor(i-n);var o=new Date(n*ut),a=new Date(i*ut),c=a.getFullYear()-o.getFullYear(),s=a.getMonth()-o.getMonth(),l=a.getDate()-o.getDate();if("y"===u){var f=c;return s<0&&(f-=1),0===s&&l<0&&(f-=1),f}if("m"===u)return 12*c+s+(l<0?-1:0);if("ym"===u)return l<0&&(s-=1),s<=0&&c>0?12+s:s;if("yd"===u)return l<0&&(s-=1),s<0?a.setFullYear(o.getFullYear()+1):a.setFullYear(o.getFullYear()),Math.floor((a.getTime()-o.getTime())/ut);throw new TypeError('Unrecognized unit parameter "'.concat(u,'" for datedif()'))},_signature:[{types:[0]},{types:[0]},{types:[2]}]},datetime:{_func:function(e){var n=r(e[0]),i=r(e[1]),u=r(e[2]),o=e.length>3?r(e[3]):0,a=e.length>4?r(e[4]):0,c=e.length>5?r(e[5]):0,s=e.length>6?r(e[6]):0,l=e.length>7?t(e[7]):null,f=new Date(n,i-1,u,o,a,c,s);return l&&(f=ot(f,l)),f.getTime()/ut},_signature:[{types:[0]},{types:[0]},{types:[0]},{types:[0],optional:!0},{types:[0],optional:!0},{types:[0],optional:!0},{types:[0],optional:!0},{types:[2],optional:!0}]},day:{_func:function(e){var t=r(e[0]);return new Date(t*ut).getDate()},_signature:[{types:[0]}]},deepScan:{_func:function(e){var t=rt(e,2),r=t[0],n=t[1].toString(),i=[];return null===r||function e(t){Object.entries(t).forEach((function(t){var r=rt(t,2),u=r[0],o=r[1];u===n&&i.push(o),"object"===tt(o)&&e(o)}))}(r),i},_signature:[{types:[4,3,7]},{types:[2,0]}]},entries:{_func:function(t){var r=e(t[0]);return Object.entries(r)},_signature:[{types:[0,2,3,4,5]}]},eomonth:{_func:function(e){var t=r(e[0]),n=r(e[1]),i=new Date(t*ut);return new Date(i.getFullYear(),i.getMonth()+n+1,0).getTime()/ut},_signature:[{types:[0]},{types:[0]}]},exp:{_func:function(e){var t=r(e[0]);return Math.exp(t)},_signature:[{types:[0]}]},false:{_func:function(){return!1},_signature:[]},find:{_func:function(e){var n=t(e[0]),i=t(e[1]),u=e.length>2?r(e[2]):0,o=i.indexOf(n,u);return-1===o?null:o},_signature:[{types:[2]},{types:[2]},{types:[0],optional:!0}]},fromEntries:{_func:function(e){var t=e[0];return Object.fromEntries(t)},_signature:[{types:[11]}]},hour:{_func:function(e){var t=r(e[0])%1;if(t<0)return null;var n=it(24*t,14);return Math.floor(n%24)},_signature:[{types:[0]}]},if:{_func:function(t,r,n){var i=t[0],u=t[1],o=t[2],a=n.visit(i,r);return e(a)?n.visit(u,r):n.visit(o,r)},_signature:[{types:[1]},{types:[1]},{types:[1]}]},left:{_func:function(e){var n=e.length>1?r(e[1]):1;return n<0?null:e[0]instanceof Array?e[0].slice(0,n):t(e[0]).substr(0,n)},_signature:[{types:[2,3]},{types:[0],optional:!0}]},lower:{_func:function(e){return t(e[0]).toLowerCase()},_signature:[{types:[2]}]},mid:{_func:function(e){var n=r(e[1]),i=r(e[2]);return n<0?null:e[0]instanceof Array?e[0].slice(n,n+i):t(e[0]).substr(n,i)},_signature:[{types:[2,3]},{types:[0]},{types:[0]}]},minute:{_func:function(e){var t=r(e[0])%1;if(t<0)return null;var n=Math.round(1440*t,10);return Math.floor(n%60)},_signature:[{types:[0]}]},mod:{_func:function(e){return r(e[0])%r(e[1])},_signature:[{types:[0]},{types:[0]}]},month:{_func:function(e){var t=r(e[0]);return new Date(t*ut).getMonth()+1},_signature:[{types:[0]}]},not:{_func:function(t){return!e(t[0])},_signature:[{types:[1]}]},now:{_func:function(){return Date.now()/ut},_signature:[]},null:{_func:function(){return null},_signature:[]},or:{_func:function(t){var r=!!e(t[0]);return t.slice(1).forEach((function(t){r=r||!!e(t)})),r},_signature:[{types:[1],variadic:!0}]},power:{_func:function(e){var t=r(e[0]),n=r(e[1]);return Math.pow(t,n)},_signature:[{types:[0]},{types:[0]}]},proper:{_func:function(e){return t(e[0]).split(" ").map((function(e){return e.charAt(0).toUpperCase()+e.slice(1).toLowerCase()})).join(" ")},_signature:[{types:[2]}]},replace:{_func:function(e){var n=t(e[0]),i=r(e[1]),u=r(e[2]),o=t(e[3]);return i<0?null:n.substr(0,i)+o+n.substr(i+u)},_signature:[{types:[2]},{types:[0]},{types:[0]},{types:[2]}]},rept:{_func:function(e){var n=t(e[0]),i=r(e[1]);return i<0?null:n.repeat(i)},_signature:[{types:[2]},{types:[0]}]},right:{_func:function(e){var n=e.length>1?r(e[1]):1;if(n<0)return null;if(e[0]instanceof Array)return 0===n?[]:e[0].slice(-1*n);var i=t(e[0]),u=i.length-n;return i.substr(u,n)},_signature:[{types:[2,3]},{types:[0],optional:!0}]},round:{_func:function(e){return it(r(e[0]),r(e[1]))},_signature:[{types:[0]},{types:[0]}]},second:{_func:function(e){var t=r(e[0])%1;if(t<0)return null;var n=it(86400*t,10);return Math.floor(n%60)},_signature:[{types:[0]}]},split:{_func:function(e){var r=t(e[0]),n=t(e[1]);return r.split(n)},_signature:[{types:[2]},{types:[2]}]},sqrt:{_func:function(e){var t=Math.sqrt(r(e[0]));return Number.isNaN(t)?null:t},_signature:[{types:[0]}]},stdev:{_func:function(e){var t=e[0]||[];if(t.length<=1)return null;var n=t.map((function(e){return r(e)})),i=n.reduce((function(e,t){return e+t}),0)/t.length,u=n.reduce((function(e,t){return e+t*t}),0),o=Math.sqrt((u-t.length*i*i)/(t.length-1));return Number.isNaN(o)?null:o},_signature:[{types:[8]}]},stdevp:{_func:function(e){var t=e[0]||[];if(0===t.length)return null;var n=t.map((function(e){return r(e)})),i=n.reduce((function(e,t){return e+t}),0)/t.length,u=n.reduce((function(e,t){return e+t*t}),0)/t.length,o=Math.sqrt(u-i*i);return Number.isNaN(o)?null:o},_signature:[{types:[8]}]},substitute:{_func:function(e){var n=t(e[0]),i=t(e[1]),u=t(e[2]);if(e.length<=3)return n.replaceAll(i,u);var o=r(e[3]);if(o<1)return n;for(var a=-1,c=0;c<o;c+=1){a+=1;var s=n.slice(a).indexOf(i);if(-1===s)return n;a+=s}return n.slice(0,a)+n.slice(a).replace(i,u)},_signature:[{types:[2]},{types:[2]},{types:[2]},{types:[0],optional:!0}]},time:{_func:function(e){var t=(3600*r(e[0])+60*r(e[1])+r(e[2]))/86400;return t<0?null:t-Math.floor(t)},_signature:[{types:[0]},{types:[0]},{types:[0]}]},today:{_func:function(){return Math.floor(Date.now()/ut)},_signature:[]},trim:{_func:function(e){return t(e[0]).split(" ").filter((function(e){return e})).join(" ")},_signature:[{types:[2]}]},true:{_func:function(){return!0},_signature:[]},trunc:{_func:function(e){var t=r(e[0]),n=e.length>1?r(e[1]):0;return(t>=0?Math.floor:Math.ceil)(t*Math.pow(10,n))/Math.pow(10,n)},_signature:[{types:[0]},{types:[0],optional:!0}]},unique:{_func:function(t){var r=t[0].map((function(t){return e(t)}));return t[0].filter((function(t,n){return r.indexOf(e(t))===n}))},_signature:[{types:[3]}]},upper:{_func:function(e){return t(e[0]).toUpperCase()},_signature:[{types:[2]}]},value:{_func:function(e){var t=e[0]||{},r=e[1],i=t[r];if(void 0===i){n.push("Failed to find: '".concat(r,"'"));var u=Object.keys(t).map((function(e){return"'".concat(e,"'")})).toString();return u.length&&n.push("Available fields: ".concat(u)),null}return i},_signature:[{types:[4,3,7]},{types:[2,0]}]},weekday:{_func:function(e){var t=r(e[0]),n=e.length>1?r(e[1]):1,i=new Date(t*ut).getDay();switch(n){case 1:return i+1;case 2:return(i+6)%7+1;case 3:return(i+6)%7;default:return null}},_signature:[{types:[0]},{types:[0],optional:!0}]},year:{_func:function(e){var t=r(e[0]);return new Date(t*ut).getFullYear()},_signature:[{types:[0]}]},charCode:{_func:function(e){var t=r(e[0]);return Number.isInteger(t)?String.fromCharCode(t):null},_signature:[{types:[0]}]},codePoint:{_func:function(e){var r=t(e[0]);return 0===r.length?null:r.codePointAt(0)},_signature:[{types:[2]}]},encodeUrlComponent:{_func:function(e){return encodeURIComponent(e[0])},_signature:[{types:[2]}]},encodeUrl:{_func:function(e){return encodeURI(e[0])},_signature:[{types:[2]}]},decodeUrlComponent:{_func:function(e){return decodeURIComponent(e[0])},_signature:[{types:[2]}]},decodeUrl:{_func:function(e){return decodeURI(e[0])},_signature:[{types:[2]}]}}}function ct(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function st(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,i,u=[],o=!0,a=!1;try{for(r=r.call(e);!(o=(n=r.next()).done)&&(u.push(n.value),!t||u.length!==t);o=!0);}catch(e){a=!0,i=e}finally{try{o||null==r.return||r.return()}finally{if(a)throw i}}return u}}(e,t)||function(e,t){if(e){if("string"==typeof e)return lt(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?lt(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function lt(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function ft(e,t,r,n,i,u,o){var a=0,c=2;function s(t,r){return function(n){var u=e.visit(t,n);if(r.indexOf(i(u))<0){var o="TypeError: expected one of ".concat(r,", received ").concat(i(u));throw new Error(o)}return u}}return{abs:{_func:function(e){return Math.abs(e[0])},_signature:[{types:[a]}]},avg:{_func:function(e){var t=0,r=e[0];return r.forEach((function(e){t+=e})),t/r.length},_signature:[{types:[8]}]},ceil:{_func:function(e){return Math.ceil(e[0])},_signature:[{types:[a]}]},contains:{_func:function(e){return u(e[0]).indexOf(u(e[1]))>=0},_signature:[{types:[c,3]},{types:[1]}]},endsWith:{_func:function(e){var t=u(e[0]),r=u(e[1]);return-1!==t.indexOf(r,t.length-r.length)},_signature:[{types:[c]},{types:[c]}]},floor:{_func:function(e){return Math.floor(e[0])},_signature:[{types:[a]}]},join:{_func:function(e){var t=e[0];return e[1].join(t)},_signature:[{types:[c]},{types:[9]}]},keys:{_func:function(e){return null===e[0]?[]:Object.keys(e[0])},_signature:[{types:[1]}]},length:{_func:function(e){var n=u(e[0]);return t(n)?Object.keys(n).length:r(n)?n.length:o(n).length},_signature:[{types:[c,3,4]}]},map:{_func:function(t){var r=t[0];return t[1].map((function(t){return e.visit(r,t)}))},_signature:[{types:[6]},{types:[3]}]},max:{_func:function(e){return e[0].length>0?i(e[0][0])===a?e[0].reduce((function(e,t){return n(e)>=n(t)?e:t}),e[0][0]):e[0].reduce((function(e,t){return o(t).localeCompare(o(e))<0?e:t}),e[0][0]):null},_signature:[{types:[3,8,9]}]},maxBy:{_func:function(e){var t,r,n=e[1],i=e[0],u=s(n,[a,c]),o=-1/0;return i.forEach((function(e){(r=u(e))>o&&(o=r,t=e)})),t},_signature:[{types:[3]},{types:[6]}]},merge:{_func:function(e){var t={};return e.forEach((function(e){Object.entries(e).forEach((function(e){var r=st(e,2),n=r[0],i=r[1];t[n]=i}))})),t},_signature:[{types:[4],variadic:!0}]},min:{_func:function(e){if(e[0].length>0){if(i(e[0][0])===a)return e[0].reduce((function(e,t){return n(e)<=n(t)?e:t}),e[0][0]);for(var t=e[0],r=t[0],u=1;u<t.length;u+=1)o(t[u]).localeCompare(o(r))<0&&(r=t[u]);return r}return null},_signature:[{types:[3,8,9]}]},minBy:{_func:function(e){var t,r,n=e[1],i=e[0],u=s(n,[a,c]),o=1/0;return i.forEach((function(e){(r=u(e))<o&&(o=r,t=e)})),t},_signature:[{types:[3]},{types:[6]}]},notNull:{_func:function(e){return e.find((function(e){return 7!==i(e)}))||null},_signature:[{types:[1],variadic:!0}]},reduce:{_func:function(t){var r=t[0];return t[1].reduce((function(t,n,i,u){return e.visit(r,{accumulated:t,current:n,index:i,array:u})}),3===t.length?t[2]:null)},_signature:[{types:[6]},{types:[3]},{types:[1],optional:!0}]},reverse:{_func:function(e){var t=u(e[0]);if(i(t)===c){for(var r="",n=t.length-1;n>=0;n-=1)r+=t[n];return r}var o=e[0].slice(0);return o.reverse(),o},_signature:[{types:[c,3]}]},sort:{_func:function(e){var t=e[0].slice(0);if(t.length>0){var r=i(e[0][0])===a?n:o;t.sort((function(e,t){var n=r(e),i=r(t);return n<i?-1:n>i?1:0}))}return t},_signature:[{types:[3,9,8]}]},sortBy:{_func:function(t){var r=t[0].slice(0);if(0===r.length)return r;var n=t[1],u=i(e.visit(n,r[0]));if([a,c].indexOf(u)<0)throw new Error("TypeError");for(var o=[],s=0;s<r.length;s+=1)o.push([s,r[s]]);o.sort((function(t,r){var o=e.visit(n,t[1]),a=e.visit(n,r[1]);if(i(o)!==u)throw new Error("TypeError: expected ".concat(u,", received ").concat(i(o)));if(i(a)!==u)throw new Error("TypeError: expected ".concat(u,", received ").concat(i(a)));return o>a?1:o<a?-1:t[0]-r[0]}));for(var l=0;l<o.length;l+=1){var f=st(o[l],2);r[l]=f[1]}return r},_signature:[{types:[3]},{types:[6]}]},startsWith:{_func:function(e){return u(e[0]).startsWith(u(e[1]))},_signature:[{types:[c]},{types:[c]}]},sum:{_func:function(e){var t=0;return e[0].forEach((function(e){t+=1*e})),t},_signature:[{types:[8]}]},toArray:{_func:function(e){return 3===i(e[0])?e[0]:[e[0]]},_signature:[{types:[1]}]},toNumber:{_func:function(e){var t=i(e[0]);return t===a?e[0]:t===c?n(e[0]):null},_signature:[{types:[1]}]},toString:{_func:function(e){return i(e[0])===c?e[0]:JSON.stringify(e[0])},_signature:[{types:[1]}]},type:{_func:function(e){var t;return(t={},ct(t,a,"number"),ct(t,c,"string"),ct(t,3,"array"),ct(t,4,"object"),ct(t,5,"boolean"),ct(t,6,"expref"),ct(t,7,"null"),t)[i(e[0])]},_signature:[{types:[1]}]},values:{_func:function(e){var t=u(e[0]);return null===t?[]:Object.values(t)},_signature:[{types:[1]}]},zip:{_func:function(e){for(var t=e.reduce((function(e,t){return Math.min(e,t.length)}),e[0].length),r=new Array(t),n=function(t){r[t]=[],e.forEach((function(e){r[t].push(e[t])}))},i=0;i<t;i+=1)n(i);return r},_signature:[{types:[3],variadic:!0}]}}}function ht(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function pt(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ht(Object(r),!0).forEach((function(t){yt(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ht(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function yt(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function vt(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function dt(e){return dt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},dt(e)}const _t=new function(){var e;function t(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return function(r){var n=B(r);if(null===n)return null;if(n instanceof Array)return t.push("Converted array to zero"),0;var i=dt(n);return"number"===i?n:"string"===i?e(n,t):"boolean"===i?n?1:0:(t.push("Converted object to zero"),0)}}function r(e){return null==e?"":e.toString()}var n=function(){function t(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t)}var n,i;return n=t,i=[{key:"addFunctions",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.functionTable=pt(pt(pt({},ft(this._interpreter,$,G,e,U,B,r)),at(B,r,e,t)),n)}},{key:"_validateArgs",value:function(t,n,i,u){if(0!==i.length){var o,a=i.filter((function(e){return!e.optional})).length;if(i[i.length-1].variadic){if(n.length<i.length)throw o=1===i.length?" argument":" arguments",new Error("ArgumentError: ".concat(t,"() ")+"takes at least".concat(i.length).concat(o," but received ").concat(n.length))}else if(n.length<a||n.length>i.length)throw o=1===i.length?" argument":" arguments",new Error("ArgumentError: ".concat(t,"() ")+"takes ".concat(i.length).concat(o," but received ").concat(n.length));if(u)for(var c,s,l=Math.min(i.length,n.length),f=0;f<l;f+=1)c=i[f].types,h=n[f],p=void 0,c.includes(10)&&null!==(p=h)&&!Array.isArray(p)&&"Object"!==p.constructor.name||c.includes(1)||(s=R(n[f]),n[f]=H(s,c,n[f],t,e,r))}var h,p}},{key:"callFunction",value:function(e,t,r,n){var i=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];if(!Object.prototype.hasOwnProperty.call(this.functionTable,e))throw new Error("Unknown function: ".concat(e,"()"));var u=this.functionTable[e];return this._validateArgs(e,t,u._signature,i),u._func.call(this,t,r,n)}}],i&&vt(n.prototype,i),Object.defineProperty(n,"prototype",{writable:!1}),t}();this.compile=function(e){var t,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];try{var i=new et(r);t=i.parse(e,n)}catch(e){throw n.push(e.toString()),e}return t},this.search=function(i,u,o,a,c){var s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[],l=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"en-US",f=new n(a);f.debug=s;var h=function(e){var t=+e;return Number.isNaN(t)?0:t};e=t(c||h,s);var p=new W(f,o,e,r,s,l);f._interpreter=p,f.addFunctions(s,a);try{return p.search(i,u)}catch(e){throw s.push(e.message||e.toString()),e}},this.strictDeepEqual=q};function gt(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function bt(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?gt(Object(r),!0).forEach((function(t){mt(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):gt(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function mt(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function wt(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function St(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var Ot=function(){function e(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],u=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[],o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"en-US";wt(this,e),this.expression=t,this.customFunctions=r,this.stringToNumber=n,this.node=_t.compile(t,i,u),this.debug=u,this.language=o}var t,r;return t=e,(r=[{key:"search",value:function(e,t){return _t.search(this.node,e,t,bt({},this.customFunctions),this.stringToNumber,this.debug,this.language)}}])&&St(t.prototype,r),Object.defineProperty(t,"prototype",{writable:!1}),e}();function Et(e){return Et="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Et(e)}function kt(e){return function(e){if(Array.isArray(e))return xt(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||jt(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function jt(e,t){if(e){if("string"==typeof e)return xt(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?xt(e,t):void 0}}function xt(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function Pt(e,t){if(t&&("object"===Et(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function At(e){var t="function"==typeof Map?new Map:void 0;return At=function(e){if(null===e||(r=e,-1===Function.toString.call(r).indexOf("[native code]")))return e;var r;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,n)}function n(){return It(e,arguments,Mt(this).constructor)}return n.prototype=Object.create(e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),Nt(n,e)},At(e)}function It(e,t,r){return It=Tt()?Reflect.construct.bind():function(e,t,r){var n=[null];n.push.apply(n,t);var i=new(Function.bind.apply(e,n));return r&&Nt(i,r.prototype),i},It.apply(null,arguments)}function Tt(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function Nt(e,t){return Nt=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Nt(e,t)}function Mt(e){return Mt=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Mt(e)}function Ct(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Ft(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Dt(e,t,r){return t&&Ft(e.prototype,t),r&&Ft(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function Lt(e,t,r){var n=function(){function t(){Ct(this,t)}return Dt(t,[{key:"$name",get:function(){return e}},{key:"$fields",get:function(){return r}},{key:"_add",value:function(e,t){this[e]=t}}]),t}(),i=function(t){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Nt(e,t)}(o,t);var n,i,u=(n=o,i=Tt(),function(){var e,t=Mt(n);if(i){var r=Mt(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return Pt(this,e)});function o(){return Ct(this,o),u.apply(this,arguments)}return Dt(o,[{key:"$name",get:function(){return e}},{key:"$fields",get:function(){return r}},{key:"_add",value:function(e,t){this[e]=t}}]),o}(At(Array));return t?new n:new i}function Ut(e,t,r){var n=[];if(r instanceof Array)e._add(t,Lt(t,!1,n)),r.forEach((function(r,i){var u=Ut(e[t],i,r);n.push.apply(n,kt(u))}));else if(null!==r&&"object"===Et(r))e._add(t,Lt(t,!0,n)),Object.keys(r).forEach((function(i){var u=Ut(e[t],i,r[i]);n.push.apply(n,kt(u))}));else{var i=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];return new(function(){function i(){Ct(this,i)}return Dt(i,[{key:"valueOf",value:function(){return t}},{key:"toString",value:function(){return t.toString()}},{key:"toJSON",value:function(){return t}},{key:"$value",get:function(){return t}},{key:"$name",get:function(){return e}},{key:"$readonly",get:function(){return r}},{key:"$required",get:function(){return n}}]),i}())}(t,r);e[t]=i,n.push(i)}return n}function Rt(e,t){var r=+e.replace(/\$/,"");return Number.isNaN(r)?(t&&t.push("Failed to convert ".concat(e," to number")),0):r}function Ht(e){return Ht="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ht(e)}window.addEventListener("load",(function(){var e=document.getElementById("data"),t=document.getElementById("expression"),r=document.getElementById("result"),n=document.getElementById("debug"),i=window.localStorage.getItem("data");i&&(e.value=i);var u=window.localStorage.getItem("expression");function o(){window.localStorage.setItem("data",e.value),window.localStorage.setItem("expression",t.value);var i,u=t.value,o=document.getElementById("use-fields").checked;try{i=JSON.parse(e.value),o&&(i=function(e){if(null===e||"object"!==Et(e))return e;var t=[],r=Lt("",!Array.isArray(e),t);return Object.entries(e).forEach((function(e){var n,i,u=(i=2,function(e){if(Array.isArray(e))return e}(n=e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,i,u=[],o=!0,a=!1;try{for(r=r.call(e);!(o=(n=r.next()).done)&&(u.push(n.value),!t||u.length!==t);o=!0);}catch(e){a=!0,i=e}finally{try{o||null==r.return||r.return()}finally{if(a)throw i}}return u}}(n,i)||jt(n,i)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),o=u[0],a=u[1];t.push.apply(t,kt(Ut(r,o,a)))})),r}(i))}catch(e){return void(r.value=e.toString())}var a=[];try{var c=function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,u=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[],o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"en-US";return new Ot(r,n,i,Object.keys(t),u,o).search(e,t,bt({},n),i,u,o)}(i,{$form:i,$:{}},u,!0,Rt,a);n.innerHTML=a.join("\n");var s=c;null!=c&&(s=c.valueOf.call(c)),"object"===Ht(s)?r.value=JSON.stringify(s,null,2):r.value=s}catch(e){r.value=e.toString(),n.innerHTML=a.join("\n")}}u&&(t.value=u),e.addEventListener("blur",o),t.addEventListener("blur",o),document.getElementById("canned").addEventListener("change",(function(e){t.value=e.target.value,o()})),o(),fetch("../antlr/JSONFormula.g4").then((function(e){e.text().then((function(e){document.getElementById("grammar-out").innerHTML=e}))}))})),JSONFormula=e})();
//# sourceMappingURL=tutorial.js.map