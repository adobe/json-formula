var JSONFormula;(()=>{"use strict";var t={};(t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})})(t);function e(t,e,r){return{and:{_func:function(t){return!!e(t[0])&&!!e(t[1])},_signature:[{types:[1]},{types:[1]}]},or:{_func:function(t){return!!e(t[0])||!!e(t[1])},_signature:[{types:[1]},{types:[1]}]},not:{_func:function(t){return!e(t[0])},_signature:[{types:[1]}]},true:{_func:function(){return!0},_signature:[]},false:{_func:function(){return!1},_signature:[]},if:{_func:function(r,n){var i=r[0],u=r[1],o=r[2],s=t.visit(i,n);return e(s)?t.visit(u,n):t.visit(o,n)},_signature:[{types:[1]},{types:[1]},{types:[1]}]},substitute:{_func:function(t){var e=t[0].toString(),r=t[1].toString(),n=t[2].toString();if(t.length<=3)return e.replace(new RegExp(r,"g"),n);for(var i=t[3].valueOf(),u=-1,o=0;o<i;o+=1){u+=1;var s=e.slice(u).indexOf(r);if(-1===s)return e;u+=s}return e.slice(0,u)+e.slice(u).replace(r,n)},_signature:[{types:[2]},{types:[2]},{types:[2]},{types:[0],optional:!0}]},value:{_func:function(t){var e=(t[0]||{})[t[1]];return void 0===e?null:e},_signature:[{types:[4,3,7]},{types:[2,0]}]},lower:{_func:function(t){return r(t[0]).toLowerCase()},_signature:[{types:[2]}]},upper:{_func:function(t){return r(t[0]).toUpperCase()},_signature:[{types:[2]}]},exp:{_func:function(t){var e=t[0];return Math.exp(e)},_signature:[{types:[0]}]},power:{_func:function(t){var e=t[0],r=t[1];return Math.pow(e,r)},_signature:[{types:[0]},{types:[0]}]},find:{_func:function(t){var e=t[0],r=t[1],n=t.length>2?t[2]:0;return e.indexOf(r,n)},_signature:[{types:[2]},{types:[2]},{types:[0],optional:!0}]},left:{_func:function(t){var e=t[0],r=t.length>1?t[1]:1;return r<0?null:e.substr(0,r)},_signature:[{types:[2]},{types:[0],optional:!0}]},right:{_func:function(t){var e=t[0],r=t.length>1?t[1]:1;if(r<0)return null;var n=e.length-r;return e.substr(n,r)},_signature:[{types:[2]},{types:[0],optional:!0}]},mid:{_func:function(t){var e=t[0],r=t[1];if(r<0)return null;var n=t[2];return e.substr(r,n)},_signature:[{types:[2]},{types:[0]},{types:[0]}]},proper:{_func:function(t){return t[0].split(" ").map((function(t){return t.charAt(0).toUpperCase()+t.slice(1).toLowerCase()})).join(" ")},_signature:[{types:[2]}]},rept:{_func:function(t){var e=t[0],r=t[1];return r<0?null:e.repeat(r)},_signature:[{types:[2]},{types:[0]}]},replace:{_func:function(t){var e=t[0],r=t[1],n=t[2],i=t[3];return r<0?null:e.substr(0,r)+i+e.substr(r+n)},_signature:[{types:[2]},{types:[0]},{types:[0]},{types:[2]}]},round:{_func:function(t){var e=t[0],r=t[1];return Math.round(e*Math.pow(10,r))/Math.pow(10,r)},_signature:[{types:[0]},{types:[0]}]},sqrt:{_func:function(t){var e=Math.sqrt(t[0]);return Number.isNaN(e)?null:e},_signature:[{types:[0]}]},stdevp:{_func:function(t){var e=t[0];if(0===e.length)return null;var r=e.reduce((function(t,e){return t+e}),0)/e.length,n=e.reduce((function(t,e){return t+e*e}),0)/e.length,i=Math.sqrt(n-r*r);return Number.isNaN(i)?null:i},_signature:[{types:[8]}]},stdev:{_func:function(t){var e=t[0];if(e.length<=1)return null;var r=e.reduce((function(t,e){return t+e}),0)/e.length,n=e.reduce((function(t,e){return t+e*e}),0),i=Math.sqrt((n-e.length*r*r)/(e.length-1));return Number.isNaN(i)?null:i},_signature:[{types:[8]}]},trim:{_func:function(t){return t[0].split(" ").filter((function(t){return t})).join(" ")},_signature:[{types:[2]}]},trunc:{_func:function(t){var e=t[0],r=t.length>1?t[1]:0;return(e>=0?Math.floor:Math.ceil)(e*Math.pow(10,r))/Math.pow(10,r)},_signature:[{types:[0]},{types:[0],optional:!0}]},charCode:{_func:function(t){var e=t[0];return Number.isInteger(e)?String.fromCharCode(e):null},_signature:[{types:[0]}]},codePoint:{_func:function(t){var e=t[0];return 0===e.length?null:e.codePointAt(0)},_signature:[{types:[2]}]}}}function r(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var r=t&&("undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"]);if(null!=r){var n,i,u=[],o=!0,s=!1;try{for(r=r.call(t);!(o=(n=r.next()).done)&&(u.push(n.value),!e||u.length!==e);o=!0);}catch(t){s=!0,i=t}finally{try{o||null==r.return||r.return()}finally{if(s)throw i}}return u}}(t,e)||function(t,e){if(t){if("string"==typeof t)return n(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?n(t,e):void 0}}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function n(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function i(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function u(t,e,n,u,o,s,a){var c=0,l=2;function h(e,r){return function(n){var i=t.visit(e,n);if(r.indexOf(o(i))<0){var u="TypeError: expected one of ".concat(r,", received ").concat(o(i));throw new Error(u)}return i}}return{abs:{_func:function(t){return Math.abs(t[0])},_signature:[{types:[c]}]},avg:{_func:function(t){for(var e=0,r=t[0],n=0;n<r.length;n+=1)e+=r[n];return e/r.length},_signature:[{types:[8]}]},ceil:{_func:function(t){return Math.ceil(t[0])},_signature:[{types:[c]}]},contains:{_func:function(t){return s(t[0]).indexOf(s(t[1]))>=0},_signature:[{types:[l,3]},{types:[1]}]},endsWith:{_func:function(t){var e=s(t[0]),r=s(t[1]);return-1!==e.indexOf(r,e.length-r.length)},_signature:[{types:[l]},{types:[l]}]},floor:{_func:function(t){return Math.floor(t[0])},_signature:[{types:[c]}]},length:{_func:function(t){var r=s(t[0]);return e(r)?Object.keys(r).length:n(r)?r.length:a(r).length},_signature:[{types:[l,3,4]}]},map:{_func:function(e){for(var r=[],n=e[0],i=e[1],u=0;u<i.length;u+=1)r.push(t.visit(n,i[u]));return r},_signature:[{types:[6]},{types:[3]}]},max:{_func:function(t){return t[0].length>0?o(t[0][0])===c?t[0].reduce((function(t,e){return u(t)>=u(e)?t:e}),t[0][0]):t[0].reduce((function(t,e){return a(e).localeCompare(a(t))<0?t:e}),t[0][0]):null},_signature:[{types:[3,8,9]}]},merge:{_func:function(t){for(var e={},r=function(r){var n=t[r];Object.keys(n).forEach((function(t){e[t]=n[t]}))},n=0;n<t.length;n+=1)r(n);return e},_signature:[{types:[4],variadic:!0}]},maxBy:{_func:function(t){for(var e,r,n=t[1],i=t[0],u=h(n,[c,l]),o=-1/0,s=0;s<i.length;s+=1)(r=u(i[s]))>o&&(o=r,e=i[s]);return e},_signature:[{types:[3]},{types:[6]}]},sum:{_func:function(t){for(var e=0,r=t[0],n=0;n<r.length;n+=1)e+=1*r[n];return e},_signature:[{types:[8]}]},startsWith:{_func:function(t){return 0===s(t[0]).lastIndexOf(s(t[1]))},_signature:[{types:[l]},{types:[l]}]},min:{_func:function(t){if(t[0].length>0){if(o(t[0][0])===c)return t[0].reduce((function(t,e){return u(t)<=u(e)?t:e}),t[0][0]);for(var e=t[0],r=e[0],n=1;n<e.length;n+=1)a(e[n]).localeCompare(a(r))<0&&(r=e[n]);return r}return null},_signature:[{types:[3,8,9]}]},minBy:{_func:function(t){for(var e,r,n=t[1],i=t[0],u=h(n,[c,l]),o=1/0,s=0;s<i.length;s+=1)(r=u(i[s]))<o&&(o=r,e=i[s]);return e},_signature:[{types:[3]},{types:[6]}]},type:{_func:function(t){var e;return(e={},i(e,c,"number"),i(e,l,"string"),i(e,3,"array"),i(e,4,"object"),i(e,5,"boolean"),i(e,6,"expref"),i(e,7,"null"),e)[o(t[0])]},_signature:[{types:[1]}]},keys:{_func:function(t){return Object.keys(t[0])},_signature:[{types:[1]}]},values:{_func:function(t){return Object.values(t[0])},_signature:[{types:[1]}]},sort:{_func:function(t){var e=t[0].slice(0);if(e.length>0){var r=o(t[0][0])===c?u:a;e.sort((function(t,e){var n=r(t),i=r(e);return n<i?-1:n>i?1:0}))}return e},_signature:[{types:[3,9,8]}]},sortBy:{_func:function(e){var n=e[0].slice(0);if(0===n.length)return n;var i=e[1],u=o(t.visit(i,n[0]));if([c,l].indexOf(u)<0)throw new Error("TypeError");for(var s=[],a=0;a<n.length;a+=1)s.push([a,n[a]]);s.sort((function(e,r){var n=t.visit(i,e[1]),s=t.visit(i,r[1]);if(o(n)!==u)throw new Error("TypeError: expected ".concat(u,", received ").concat(o(n)));if(o(s)!==u)throw new Error("TypeError: expected ".concat(u,", received ").concat(o(s)));return n>s?1:n<s?-1:e[0]-r[0]}));for(var h=0;h<s.length;h+=1){var f=r(s[h],2);n[h]=f[1]}return n},_signature:[{types:[3]},{types:[6]}]},join:{_func:function(t){var e=t[0];return t[1].join(e)},_signature:[{types:[l]},{types:[9]}]},reverse:{_func:function(t){var e=s(t[0]);if(o(e)===l){for(var r="",n=e.length-1;n>=0;n-=1)r+=e[n];return r}var i=t[0].slice(0);return i.reverse(),i},_signature:[{types:[l,3]}]},toArray:{_func:function(t){return 3===o(t[0])?t[0]:[t[0]]},_signature:[{types:[1]}]},toString:{_func:function(t){return o(t[0])===l?t[0]:JSON.stringify(t[0])},_signature:[{types:[1]}]},toNumber:{_func:function(t){var e=o(t[0]);return e===c?t[0]:e===l?u(t[0]):null},_signature:[{types:[1]}]},notNull:{_func:function(t){for(var e=0;e<t.length;e+=1)if(7!==o(t[e]))return t[e];return null},_signature:[{types:[1],variadic:!0}]}}}function o(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function s(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?o(Object(r),!0).forEach((function(e){a(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):o(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function a(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function c(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var r=t&&("undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"]);if(null!=r){var n,i,u=[],o=!0,s=!1;try{for(r=r.call(t);!(o=(n=r.next()).done)&&(u.push(n.value),!e||u.length!==e);o=!0);}catch(t){s=!0,i=t}finally{try{o||null==r.return||r.return()}finally{if(s)throw i}}return u}}(t,e)||l(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function l(t,e){if(t){if("string"==typeof t)return h(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?h(t,e):void 0}}function h(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function f(t){return f="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},f(t)}var p=0,y=2,d=3,v=5,_=7,g=8,m=9;const b=new function(){var t,r="UnquotedIdentifier",n="QuotedIdentifier",i="Rbracket",o="Rparen",a="Comma",b="Colon",w="Concatenate",S="Rbrace",k="Number",O="Current",x="Global",E="Field",j="Expref",P="Pipe",I="Or",A="And",N="Add",M="Subtract",T="Multiply",L="Power",F="Divide",R="EQ",C="GT",D="LT",H="GTE",U="LTE",J="NE",$="Flatten",B="Star",q="Filter",z="Dot",G="Lbrace",Q="Lbracket",V="Lparen",W="Literal",Z={0:"number",1:"any",2:"string",3:"array",4:"object",5:"boolean",6:"expression",7:"null",8:"Array<number>",9:"Array<string>"},K={};function X(t,e){return t>="0"&&t<="9"||e&&"-"===t||"."===t}function Y(t){return t>="a"&&t<="z"||t>="A"&&t<="Z"||t>="0"&&t<="9"||"_"===t}function tt(t){return null!==t&&"[object Array]"===Object.prototype.toString.call(t)}function et(t){return null==t?t:tt(t)?t.map((function(t){return et(t)})):t.valueOf()}function rt(t){return null==t?"":t.toString()}function nt(t){return null!==t&&"[object Object]"===Object.prototype.toString.call(t)}function it(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(null===t)return _;var r=e?t.valueOf():t;switch(Object.prototype.toString.call(r)){case"[object String]":return y;case"[object Number]":return p;case"[object Array]":return d;case"[object Boolean]":return v;case"[object Null]":return _;case"[object Object]":return r.jmespathType===j?6:4;default:return 4}}function ut(t){return[it(t),it(t,!1)]}function ot(t,e){var r=et(t),n=et(e);if(r===n)return!0;if(Object.prototype.toString.call(r)!==Object.prototype.toString.call(n))return!1;if(!0===tt(r)){if(r.length!==n.length)return!1;for(var i=0;i<r.length;i+=1)if(!1===ot(r[i],n[i]))return!1;return!0}if(!0===nt(r)){var u={};for(var o in r)if(hasOwnProperty.call(r,o)){if(!1===ot(r[o],n[o]))return!1;u[o]=!0}for(var s in n)if(hasOwnProperty.call(n,s)&&!0!==u[s])return!1;return!0}return!1}function st(t){if(null===t)return!0;var e=et(t);if(""===e||!1===e||null===e)return!0;if(tt(e)&&0===e.length)return!0;if(nt(e)){for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r))return!1;return!0}return!e}function at(t){var e=et(t);if(null===e)return null;if(e instanceof Array)return 0;if("number"==typeof e)return e;if("string"==typeof e){var r=parseFloat(e);return Number.isNaN(r)?0:r}if("boolean"==typeof e)return e?1:0;throw new Error("need to coerce number")}function ct(t,e,r){if(tt(t)&&tt(e)){var n,i=Math.min(t.length,e.length),u=[];for(n=0;n<i;n+=1)if(tt(t[n])||tt(e[n]))u.push(ct(t[n],e[n],r));else if("*"===r)u.push(t[n]*e[n]);else{if("&"!==r)throw new Error("unimplemented");u.push(t[n]+e[n])}for(n=i;n<Math.max(t.length,e.length);n+=1)"&"===r?u.push(""):"*"===r&&u.push(0);return u}if(tt(t)||tt(e)){var o=c(tt(t)?[t,e]:[e,t],2),s=o[0],a=o[1];if("*"===r)return s.map((function(t){return at(t)*at(a)}));if("&"===r)return s.map((function(t){return t+a}))}if("*"===r)return at(t)*at(e);if("&"===r)return t+e;throw new Error("unimplemented array operator: ".concat(r))}function lt(t,e,r,n){var i=t[0];if(-1!==e.findIndex((function(t){return 1===t||i===t})))return r;if(4===i)throw new Error("TypeError: ".concat(n," expected argument to be type ").concat(Z[e[0]]," but received type ").concat(Z[i]," instead."));var u=-1;if(i===d&&e.includes(m)&&e.includes(g)&&(u=r.length>0&&"string"==typeof r[0]?m:g),-1===u&&[m,g,d].includes(i)&&(u=e.find((function(t){return[m,g,d].includes(t)}))),-1===u&&(u=c(e,1)[0]),1===u)return r;if(u===m||u===g||u===d){if(u===d)return i===g||i===m?r:null===r?[]:[r];var o=u===g?p:y;if(i===d){for(var s=r.slice(),a=0;a<s.length;a+=1){var l=ut(s[a]);s[a]=lt(l,[o],s[a],n)}return s}if([p,y,_,v].includes(o))return[lt(t,[o],r,n)]}else{if(u===p)return[y,v,_].includes(i)?at(r):0;if(u===y)return i===_||4===i?"":r.toString();if(u===v)return!!r;if(4===u&&4===t[1])return r}throw new Error("unhandled argument")}t="function"==typeof String.prototype.trimLeft?function(t){return t.trimLeft()}:function(t){return t.match(/^\s*(.*)/)[1]};var ht={".":z,",":a,":":b,"{":G,"}":S,"]":i,"(":V,")":o,"@":O},ft={"<":!0,">":!0,"=":!0,"!":!0},pt={" ":!0,"\t":!0,"\n":!0};function yt(t,e){var r=t[e];return"$"===r?t.length>e&&Y(t[e+1]):r>="a"&&r<="z"||r>="A"&&r<="Z"||"_"===r}function dt(t,e,r){if(null!==t&&t===z)return!1;if("$"!==e[r])return!1;for(var n=r+1;n<e.length&&Y(e[n]);)n+=1;var i=e.slice(r,n);return!!K[i]}function vt(){}vt.prototype={tokenize:function(t){var e,i,u,s=[];for(this._current=0;this._current<t.length;){var c=s.length?s.slice(-1)[0].type:null;if(dt(c,t,this._current))s.push(this._consumeGlobal(t));else if(yt(t,this._current))e=this._current,i=this._consumeUnquotedIdentifier(t),s.push({type:r,value:i,start:e});else if(void 0!==ht[t[this._current]])s.push({type:ht[t[this._current]],value:t[this._current],start:this._current}),this._current+=1;else if("-"===t[this._current]&&c!==k&&c!==o||X(t[this._current],!1))u=this._consumeNumber(t),s.push(u);else if("["===t[this._current])u=this._consumeLBracket(t),s.push(u);else if('"'===t[this._current])e=this._current,i=this._consumeQuotedIdentifier(t),s.push({type:n,value:i,start:e});else if("'"===t[this._current])e=this._current,i=this._consumeRawStringLiteral(t),s.push({type:W,value:i,start:e});else if("`"===t[this._current]){e=this._current;var l=this._consumeLiteral(t);s.push({type:W,value:l,start:e})}else if(void 0!==ft[t[this._current]])s.push(this._consumeOperator(t));else if(void 0!==pt[t[this._current]])this._current+=1;else if("&"===t[this._current])e=this._current,this._current+=1,"&"===t[this._current]?(this._current+=1,s.push({type:A,value:"&&",start:e})):c===a||c===V?s.push({type:j,value:"&",start:e}):s.push({type:w,value:"&",start:e});else if("+"===t[this._current])e=this._current,this._current+=1,s.push({type:N,value:"+",start:e});else if("-"===t[this._current])e=this._current,this._current+=1,s.push({type:M,value:"-",start:e});else if("*"===t[this._current]){e=this._current,this._current+=1;var h=s.length&&s.slice(-1)[0].type;0===s.length||[Q,z,P,A,I,a,b].includes(h)?s.push({type:B,value:"*",start:e}):s.push({type:T,value:"*",start:e})}else if("/"===t[this._current])e=this._current,this._current+=1,s.push({type:F,value:"/",start:e});else if("^"===t[this._current])e=this._current,this._current+=1,s.push({type:L,value:"^",start:e});else{if("|"!==t[this._current]){var f=new Error("Unknown character:".concat(t[this._current]));throw f.name="LexerError",f}e=this._current,this._current+=1,"|"===t[this._current]?(this._current+=1,s.push({type:I,value:"||",start:e})):s.push({type:P,value:"|",start:e})}}return s},_consumeUnquotedIdentifier:function(t){var e=this._current;for(this._current+=1;this._current<t.length&&Y(t[this._current]);)this._current+=1;return t.slice(e,this._current)},_consumeQuotedIdentifier:function(t){var e=this._current;this._current+=1;for(var r=t.length;'"'!==t[this._current]&&this._current<r;){var n=this._current;"\\"!==t[n]||"\\"!==t[n+1]&&'"'!==t[n+1]?n+=1:n+=2,this._current=n}return this._current+=1,JSON.parse(t.slice(e,this._current))},_consumeRawStringLiteral:function(t){var e=this._current;this._current+=1;for(var r=t.length;"'"!==t[this._current]&&this._current<r;){var n=this._current;"\\"!==t[n]||"\\"!==t[n+1]&&"'"!==t[n+1]?n+=1:n+=2,this._current=n}return this._current+=1,t.slice(e+1,this._current-1).replace("\\'","'")},_consumeNumber:function(t){var e=this._current;this._current+=1;for(var r=t.length;X(t[this._current],!1)&&this._current<r;)this._current+=1;var n,i=t.slice(e,this._current);return n=i.includes(".")?parseFloat(i):parseInt(i,10),{type:k,value:n,start:e}},_consumeLBracket:function(t){var e=this._current;return this._current+=1,"?"===t[this._current]?(this._current+=1,{type:q,value:"[?",start:e}):"]"===t[this._current]?(this._current+=1,{type:$,value:"[]",start:e}):{type:Q,value:"[",start:e}},_consumeGlobal:function(t){var e=this._current;for(this._current+=1;this._current<t.length&&Y(t[this._current]);)this._current+=1;var r=t.slice(e,this._current);return{type:x,value:K[r],start:e}},_consumeOperator:function(t){var e=this._current,r=t[e];return this._current+=1,"!"===r?"="===t[this._current]?(this._current+=1,{type:J,value:"!=",start:e}):{type:"Not",value:"!",start:e}:"<"===r?"="===t[this._current]?(this._current+=1,{type:U,value:"<=",start:e}):{type:D,value:"<",start:e}:">"===r?"="===t[this._current]?(this._current+=1,{type:H,value:">=",start:e}):{type:C,value:">",start:e}:"="===t[this._current]?(this._current+=1,{type:R,value:"==",start:e}):{type:R,value:"=",start:e}},_consumeLiteral:function(e){this._current+=1;for(var r,n=this._current,i=e.length;"`"!==e[this._current]&&this._current<i;){var u=this._current;"\\"!==e[u]||"\\"!==e[u+1]&&"`"!==e[u+1]?u+=1:u+=2,this._current=u}var o=t(e.slice(n,this._current));return o=o.replace("\\`","`"),r=this._looksLikeJSON(o)?JSON.parse(o):JSON.parse('"'.concat(o,'"')),this._current+=1,r},_looksLikeJSON:function(t){if(""===t)return!1;if('[{"'.indexOf(t[0])>=0)return!0;if(["true","false","null"].indexOf(t)>=0)return!0;if(!("-0123456789".indexOf(t[0])>=0))return!1;try{return JSON.parse(t),!0}catch(t){return!1}}};var _t={};function gt(){}function mt(t){this.runtime=t}function bt(){}_t.EOF=0,_t.UnquotedIdentifier=0,_t.QuotedIdentifier=0,_t.Rbracket=0,_t.Rparen=0,_t[a]=0,_t.Rbrace=0,_t.Number=0,_t.Current=0,_t.Global=0,_t.Field=0,_t.Expref=0,_t[P]=1,_t[I]=2,_t[A]=3,_t[N]=6,_t[M]=6,_t[w]=7,_t[T]=7,_t[F]=7,_t[L]=7,_t[R]=5,_t[C]=5,_t[D]=5,_t[H]=5,_t[U]=5,_t[J]=5,_t.Flatten=9,_t.Star=20,_t.Filter=21,_t[z]=40,_t.Not=45,_t.Lbrace=50,_t[Q]=55,_t.Lparen=60,gt.prototype={parse:function(t){this._loadTokens(t),this.index=0;var e=this.expression(0);if("EOF"!==this._lookahead(0)){var r=this._lookaheadToken(0),n=new Error("Unexpected token type: ".concat(r.type,", value: ").concat(r.value));throw n.name="ParserError",n}return e},_loadTokens:function(t){var e=(new vt).tokenize(t);e.push({type:"EOF",value:"",start:t.length}),this.tokens=e},expression:function(t){var e=this._lookaheadToken(0);this._advance();for(var r=this.nud(e),n=this._lookahead(0);t<_t[n];)this._advance(),r=this.led(n,r),n=this._lookahead(0);return r},_lookahead:function(t){return this.tokens[this.index+t].type},_lookaheadToken:function(t){return this.tokens[this.index+t]},_advance:function(){this.index+=1},nud:function(t){var e,u,s,c,l;switch(t.type){case W:return{type:"Literal",value:t.value};case k:return{type:"Number",value:t.value};case r:return{type:"Field",name:t.value};case n:if(s={type:"Field",name:t.value},this._lookahead(0)===V)throw new Error("Quoted identifier not allowed for function names.");return s;case"Not":return{type:"NotExpression",children:[e=this.expression(_t.Not)]};case B:return{type:"ValueProjection",children:[{type:"Identity"},e=this._lookahead(0)===i?{type:"Identity"}:this._parseProjectionRHS(_t.Star)]};case q:return this.led(t.type,{type:"Identity"});case G:return this._parseMultiselectHash();case $:return{type:"Projection",children:[{type:$,children:[{type:"Identity"}]},e=this._parseProjectionRHS(_t.Flatten)]};case Q:return this._lookahead(1)===a||(l=this._lookahead(1),[w,I,A,N,M,T,L,F,R,C,D,H,U,J].includes(l))?this._parseMultiselectList():this._lookahead(0)===k||this._lookahead(0)===b?(e=this._parseIndexExpression(),this._projectIfSlice({type:"Identity"},e)):this._lookahead(0)===B&&this._lookahead(1)===i?(this._advance(),this._advance(),{type:"Projection",children:[{type:"Identity"},e=this._parseProjectionRHS(_t.Star)]}):this._parseMultiselectList();case O:return{type:O};case x:return{type:x,value:t.value};case E:return{type:E};case j:return{type:"ExpressionReference",children:[u=this.expression(_t.Expref)]};case V:for(c=[];this._lookahead(0)!==o;)this._lookahead(0)===O?(u={type:O},this._advance()):u=this.expression(0),c.push(u);return this._match(o),c[0];default:this._errorToken(t)}},led:function(t,e){var r,n,u,s,c,l,h;switch(t){case w:return{type:"ConcatenateExpression",children:[e,n=this.expression(_t.Concatenate)]};case z:return l=_t.Dot,this._lookahead(0)!==B?{type:"Subexpression",children:[e,n=this._parseDotRHS(l)]}:(this._advance(),{type:"ValueProjection",children:[e,n=this._parseProjectionRHS(l)]});case P:return n=this.expression(_t.Pipe),{type:P,children:[e,n]};case I:return{type:"OrExpression",children:[e,n=this.expression(_t.Or)]};case A:return{type:"AndExpression",children:[e,n=this.expression(_t.And)]};case N:return{type:"AddExpression",children:[e,n=this.expression(_t.Add)]};case M:return{type:"SubtractExpression",children:[e,n=this.expression(_t.Subtract)]};case T:return{type:"MultiplyExpression",children:[e,n=this.expression(_t.Multiply)]};case F:return{type:"DivideExpression",children:[e,n=this.expression(_t.Divide)]};case L:return{type:"PowerExpression",children:[e,n=this.expression(_t.Power)]};case V:for(u=e.name,s=[];this._lookahead(0)!==o;)this._lookahead(0)===O?(c={type:O},this._advance()):c=this.expression(0),this._lookahead(0)===a&&this._match(a),s.push(c);return this._match(o),{type:"Function",name:u,children:s};case q:return r=this.expression(0),this._match(i),{type:"FilterProjection",children:[e,n=this._lookahead(0)===$?{type:"Identity"}:this._parseProjectionRHS(_t.Filter),r]};case $:return{type:"Projection",children:[{type:$,children:[e]},this._parseProjectionRHS(_t.Flatten)]};case R:case J:case C:case H:case D:case U:return this._parseComparator(e,t);case Q:return(h=this._lookaheadToken(0)).type===k||h.type===b?(n=this._parseIndexExpression(),this._projectIfSlice(e,n)):(this._match(B),this._match(i),{type:"Projection",children:[e,n=this._parseProjectionRHS(_t.Star)]});default:this._errorToken(this._lookaheadToken(0))}},_match:function(t){if(this._lookahead(0)!==t){var e=this._lookaheadToken(0),r=new Error("Expected ".concat(t,", got: ").concat(e.type));throw r.name="ParserError",r}this._advance()},_errorToken:function(t){var e=new Error("Invalid token (".concat(t.type,'): "').concat(t.value,'"'));throw e.name="ParserError",e},_parseIndexExpression:function(){if(this._lookahead(0)===b||this._lookahead(1)===b)return this._parseSliceExpression();var t={type:"Index",value:this._lookaheadToken(0).value};return this._advance(),this._match(i),t},_projectIfSlice:function(t,e){var r={type:"IndexExpression",children:[t,e]};return"Slice"===e.type?{type:"Projection",children:[r,this._parseProjectionRHS(_t.Star)]}:r},_parseSliceExpression:function(){for(var t=[null,null,null],e=0,r=this._lookahead(0);r!==i&&e<3;){if(r===b)e+=1,this._advance();else{if(r!==k){var n=this._lookahead(0),u=new Error("Syntax error, unexpected token: ".concat(n.value,"(").concat(n.type,")"));throw u.name="Parsererror",u}t[e]=this._lookaheadToken(0).value,this._advance()}r=this._lookahead(0)}return this._match(i),{type:"Slice",children:t}},_parseComparator:function(t,e){return{type:"Comparator",name:e,children:[t,this.expression(_t[e])]}},_parseDotRHS:function(t){var e=this._lookahead(0);return[r,n,B].indexOf(e)>=0?this.expression(t):e===Q?(this._match(Q),this._parseMultiselectList()):e===G?(this._match(G),this._parseMultiselectHash()):void 0},_parseProjectionRHS:function(t){var e;if(_t[this._lookahead(0)]<10)e={type:"Identity"};else if(this._lookahead(0)===Q)e=this.expression(t);else if(this._lookahead(0)===q)e=this.expression(t);else{if(this._lookahead(0)!==z){var r=this._lookaheadToken(0),n=new Error("Sytanx error, unexpected token: ".concat(r.value,"(").concat(r.type,")"));throw n.name="ParserError",n}this._match(z),e=this._parseDotRHS(t)}return e},_parseMultiselectList:function(){for(var t=[];this._lookahead(0)!==i;){var e=this.expression(0);if(t.push(e),this._lookahead(0)===a&&(this._match(a),this._lookahead(0)===i))throw new Error("Unexpected token Rbracket")}return this._match(i),{type:"MultiSelectList",children:t}},_parseMultiselectHash:function(){for(var t,e,i,u=[],o=[r,n];;){if(t=this._lookaheadToken(0),o.indexOf(t.type)<0)throw new Error("Expecting an identifier token, got: ".concat(t.type));if(e=t.value,this._advance(),this._match(b),i={type:"KeyValuePair",name:e,value:this.expression(0)},u.push(i),this._lookahead(0)===a)this._match(a);else if(this._lookahead(0)===S){this._match(S);break}}return{type:"MultiSelectHash",children:u}}},mt.prototype={search:function(t,e){return this.visit(t,e)},visit:function(t,e){var r,n,i,u,o,s,a,f,p,d,v,_,g,b,w,S,k,E,I,A,N,M,T,L;switch(t.type){case"Field":return null!==e&&nt(e)?void 0===(s=e[t.name])?null:s:null;case"Subexpression":for(i=this.visit(t.children[0],e),p=1;p<t.children.length;p+=1)if(null===(i=this.visit(t.children[1],i)))return null;return i;case"IndexExpression":case P:return a=this.visit(t.children[0],e),this.visit(t.children[1],a);case"Index":return tt(e)?((_=t.value)<0&&(_=e.length+_),void 0===(i=e[_])&&(i=null),i):null;case"Slice":if(!tt(e))return null;g=t.children.slice(0);var F=c(this.computeSliceParams(e.length,g),3);if(b=F[0],w=F[1],i=[],(S=F[2])>0)for(p=b;p<w;p+=S)i.push(e[p]);else for(p=b;p>w;p+=S)i.push(e[p]);return i;case"Projection":if(!tt(v=this.visit(t.children[0],e)))return null;for(f=[],p=0;p<v.length;p+=1)null!==(n=this.visit(t.children[1],v[p]))&&f.push(n);return f;case"ValueProjection":if(!nt(et(v=this.visit(t.children[0],e))))return null;for(f=[],k=function(t){for(var e=Object.keys(t),r=[],n=0;n<e.length;n+=1)r.push(t[e[n]]);return r}(v),p=0;p<k.length;p+=1)null!==(n=this.visit(t.children[1],k[p]))&&f.push(n);return f;case"FilterProjection":if(!tt(v=this.visit(t.children[0],e)))return null;for(E=[],I=[],p=0;p<v.length;p+=1)st(r=this.visit(t.children[2],v[p]))||E.push(v[p]);for(var B=0;B<E.length;B+=1)null!==(n=this.visit(t.children[1],E[B]))&&I.push(n);return I;case"Comparator":switch(u=this.visit(t.children[0],e),o=this.visit(t.children[1],e),t.name){case R:i=ot(u,o);break;case J:i=!ot(u,o);break;case C:i=u>o;break;case H:i=u>=o;break;case D:i=u<o;break;case U:i=u<=o;break;default:throw new Error("Unknown comparator: ".concat(t.name))}return i;case $:if(!tt(A=this.visit(t.children[0],e)))return null;for(N=[],p=0;p<A.length;p+=1){var q;tt(n=A[p])?(q=N).push.apply(q,function(t){if(Array.isArray(t))return h(t)}(L=n)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(L)||l(L)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()):N.push(n)}return N;case"Identity":case O:return e;case"MultiSelectList":if(null===e)return null;for(f=[],p=0;p<t.children.length;p+=1)f.push(this.visit(t.children[p],e));return f;case"MultiSelectHash":if(null===e)return null;for(f={},p=0;p<t.children.length;p+=1)f[(d=t.children[p]).name]=this.visit(d.value,e);return f;case"OrExpression":return st(r=this.visit(t.children[0],e))&&(r=this.visit(t.children[1],e)),r;case"AndExpression":return!0===st(u=this.visit(t.children[0],e))?u:this.visit(t.children[1],e);case"AddExpression":return at(u=this.visit(t.children[0],e))+at(this.visit(t.children[1],e));case"ConcatenateExpression":return u=this.visit(t.children[0],e),o=this.visit(t.children[1],e),ct(u=lt(ut(u),[y,m],u,"concatenate"),o=lt(ut(o),[y,m],o,"concatenate"),"&");case"SubtractExpression":return(u=this.visit(t.children[0],e))-this.visit(t.children[1],e);case"MultiplyExpression":return ct(u=this.visit(t.children[0],e),o=this.visit(t.children[1],e),"*");case"DivideExpression":return(u=this.visit(t.children[0],e))/this.visit(t.children[1],e);case"PowerExpression":return u=this.visit(t.children[0],e),Math.pow(u,this.visit(t.children[1],e));case"NotExpression":return st(u=this.visit(t.children[0],e));case"Literal":case"Number":case x:return t.value;case"Function":if("if"===t.name)return this.runtime.callFunction(t.name,t.children,e);for(M=[],p=0;p<t.children.length;p+=1)M.push(this.visit(t.children[p],e));return this.runtime.callFunction(t.name,M);case"ExpressionReference":return(T=c(t.children,1)[0]).jmespathType=j,T;default:throw new Error("Unknown node type: ".concat(t.type))}},computeSliceParams:function(t,e){var r=e[0],n=e[1],i=e[2],u=[null,null,null];if(null===i)i=1;else if(0===i){var o=new Error("Invalid slice, step cannot be 0");throw o.name="RuntimeError",o}var s=i<0;return r=null===r?s?t-1:0:this.capSliceRange(t,r,i),n=null===n?s?-1:t:this.capSliceRange(t,n,i),u[0]=r,u[1]=n,u[2]=i,u},capSliceRange:function(t,e,r){return e<0?(e+=t)<0&&(e=r<0?-1:0):e>=t&&(e=r<0?t-1:t),e}},bt.prototype={addFunctions:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.functionTable=s(s(s({},u(this._interpreter,nt,tt,at,it,et,rt)),e(this._interpreter,et,rt)),t)},callFunction:function(t,e,r){var n=this.functionTable[t];if(void 0===n)throw new Error("Unknown function: ".concat(t,"()"));return this._validateArgs(t,e,n._signature),n._func.call(this,e,r)},_validateArgs:function(t,e,r){if(0!==r.length){var n,i,u;if(r[r.length-1].variadic){if(e.length<r.length)throw n=1===r.length?" argument":" arguments",new Error("ArgumentError: ".concat(t,"() ")+"takes at least".concat(r.length).concat(n," but received ").concat(e.length))}else if(e.length!==r.length&&!r[r.length-1].optional)throw n=1===r.length?" argument":" arguments",new Error("ArgumentError: ".concat(t,"() ")+"takes ".concat(r.length).concat(n," but received ").concat(e.length));for(var o=Math.min(r.length,e.length),s=0;s<o;s+=1)i=r[s].types,a=e[s],c=i,l=void 0,null!==(l=a)&&!Array.isArray(l)&&"object"===f(l)&&"Object"!==l.constructor.name&&c.includes(10)||(u=ut(e[s]),e[s]=lt(u,i,e[s],t))}var a,c,l}},this.tokenize=function(t){return(new vt).tokenize(t)},this.compile=function(t){return(new gt).parse(t)},this.search=function(t,e,r,n){var i=new gt,u=new bt(n),o=new mt(u);u._interpreter=o,u.addFunctions(n),e&&(K=e);var s=i.parse(r);return o.search(s,t)},this.strictDeepEqual=ot};function w(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function S(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?w(Object(r),!0).forEach((function(e){k(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):w(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function k(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function O(t){return O="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},O(t)}function x(t){return function(t){if(Array.isArray(t))return E(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(t){if("string"==typeof t)return E(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?E(t,e):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function E(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function j(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function P(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function I(t,e,r){return e&&P(t.prototype,e),r&&P(t,r),t}function A(t,e,r){var n=[];if(r instanceof Array)t[e]=[],r.forEach((function(r,i){var u=A(t[e],i,r);n.push.apply(n,x(u))}));else if(null!==r&&"object"===O(r))t[e]={},Object.keys(r).forEach((function(i){var u=A(t[e],i,r[i]);n.push.apply(n,x(u))}));else{var i=function(t,e){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];return new(function(){function i(){j(this,i)}return I(i,[{key:"valueOf",value:function(){return e}},{key:"toString",value:function(){return e.toString()}},{key:"toJSON",value:function(){return e}},{key:"$value",get:function(){return e}},{key:"$name",get:function(){return t}},{key:"$readonly",get:function(){return r}},{key:"$required",get:function(){return n}}]),i}())}(e,r);t[e]=i,n.push(i)}return n}var N=function(){function t(e,r){var n=this;j(this,t),this.fieldData=e,this.allFields=A(e,"data",r),Object.keys(e.data).forEach((function(t){n[t]=e.data[t]}))}return I(t,[{key:"valueOf",value:function(){return this.fieldData}},{key:"stringify",value:function(){return JSON.stringify(this.fieldData.data,null,2)}},{key:"$fields",get:function(){return this.allFields}}]),t}();function M(t){return M="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},M(t)}window.addEventListener("load",(function(){var t=document.getElementById("data"),e=document.getElementById("expression"),r=document.getElementById("result"),n=window.localStorage.getItem("data");n&&(t.value=n);var i=window.localStorage.getItem("expression");function u(){window.localStorage.setItem("data",t.value),window.localStorage.setItem("expression",e.value);var n,i=e.value,u=document.getElementById("use-fields").checked,o=null,s={};try{n=JSON.parse(t.value),u&&(o=new N(s,n))}catch(t){return void(r.value=t.toString())}try{var a=function(t,e,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return b.search(t,e,r,S({},n))}(u?s.data:n,{$form:o,$:{}},i,!0),c=null==a?a:a.valueOf();"object"===M(c)?r.value=JSON.stringify(c,null,2):r.value=c}catch(t){r.value=t.toString()}}i&&(e.value=i),t.addEventListener("blur",u),e.addEventListener("blur",u),u(),fetch("../antlr/JSONFormula.g4").then((function(t){t.text().then((function(t){document.getElementById("grammar-out").innerHTML=t}))}))})),JSONFormula=t})();
//# sourceMappingURL=tutorial.js.map